<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
<meta name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">

    <meta name="author" content="qing-wq">



    <meta name="description" content="Qing's Blog">



<title>Goè¯­è¨€åŸºç¡€ | Qing&#39;s Blog</title>



    <link rel="icon" href="/favicon.ico">




    <!-- stylesheets list from _config.yml -->
    
    <link rel="stylesheet" href="/css/style.css">
    



    <!-- scripts list from _config.yml -->
    
    <script src="/js/script.js"></script>
    
    <script src="/js/tocbot.min.js"></script>
    



    
    
        
    


<!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.3.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
</head>

<body>
    <script>
        // this function is used to check current theme before page loaded.
        (() => {
            const currentTheme = window.localStorage && window.localStorage.getItem('theme') || '';
            const isDark = currentTheme === 'dark';
            const pagebody = document.getElementsByTagName('body')[0]
            if (isDark) {
                pagebody.classList.add('dark-theme');
                // mobile
                document.getElementById("mobile-toggle-theme").innerText = "Â· Dark"
            } else {
                pagebody.classList.remove('dark-theme');
                // mobile
                document.getElementById("mobile-toggle-theme").innerText = "Â· Light"
            }
        })();
    </script>

    <div class="wrapper">
        <header>
    <nav class="navbar">
        <div class="container">
            <div class="navbar-header header-logo"><a href="/">Qing&#39;s Blog</a></div>
            <div class="menu navbar-right">
                
                    <a class="menu-item" href="/archives">Posts</a>
                
                    <a class="menu-item" href="/categories">Categories</a>
                
                    <a class="menu-item" href="/tags">Tags</a>
                
                    <a class="menu-item" href="/about">About</a>
                
                <input id="switch_default" type="checkbox" class="switch_default">
                <label for="switch_default" class="toggleBtn"></label>
            </div>
        </div>
    </nav>

    
    <nav class="navbar-mobile" id="nav-mobile">
        <div class="container">
            <div class="navbar-header">
                <div>
                    <a href="/">Qing&#39;s Blog</a><a id="mobile-toggle-theme">Â·&nbsp;Light</a>
                </div>
                <div class="menu-toggle" onclick="mobileBtn()">&#9776; Menu</div>
            </div>
            <div class="menu" id="mobile-menu">
                
                    <a class="menu-item" href="/archives">Posts</a>
                
                    <a class="menu-item" href="/categories">Categories</a>
                
                    <a class="menu-item" href="/tags">Tags</a>
                
                    <a class="menu-item" href="/about">About</a>
                
            </div>
        </div>
    </nav>

</header>
<script>
    var mobileBtn = function f() {
        var toggleMenu = document.getElementsByClassName("menu-toggle")[0];
        var mobileMenu = document.getElementById("mobile-menu");
        if(toggleMenu.classList.contains("active")){
           toggleMenu.classList.remove("active")
            mobileMenu.classList.remove("active")
        }else{
            toggleMenu.classList.add("active")
            mobileMenu.classList.add("active")
        }
    }
</script>
            <div class="main">
                <div class="container">
    
    
        <div class="post-toc">
    <div class="tocbot-list">
    </div>
    <div class="tocbot-list-menu">
        <a class="tocbot-toc-expand" onclick="expand_toc()">Expand all</a>
        <a onclick="go_top()">Back to top</a>
        <a onclick="go_bottom()">Go to bottom</a>
    </div>
</div>

<script>
    var tocbot_timer;
    var DEPTH_MAX = 6; // ä¸º 6 æ—¶å±•å¼€æ‰€æœ‰
    var tocbot_default_config = {
        tocSelector: '.tocbot-list',
        contentSelector: '.post-content',
        headingSelector: 'h1, h2, h3, h4, h5',
        orderedList: false,
        scrollSmooth: true,
        onClick: extend_click,
    };

    function extend_click() {
        clearTimeout(tocbot_timer);
        tocbot_timer = setTimeout(function() {
            tocbot.refresh(obj_merge(tocbot_default_config, {
                hasInnerContainers: true
            }));
        }, 420); // è¿™ä¸ªå€¼æ˜¯ç”± tocbot æºç é‡Œå®šä¹‰çš„ scrollSmoothDuration å¾—æ¥çš„
    }

    document.ready(function() {
        tocbot.init(obj_merge(tocbot_default_config, {
            collapseDepth: 1
        }));
    });

    function expand_toc() {
        var b = document.querySelector('.tocbot-toc-expand');
        var expanded = b.getAttribute('data-expanded');
        expanded ? b.removeAttribute('data-expanded') : b.setAttribute('data-expanded', true);
        tocbot.refresh(obj_merge(tocbot_default_config, {
            collapseDepth: expanded ? 1 : DEPTH_MAX
        }));
        b.innerText = expanded ? 'Expand all' : 'Collapse all';
    }

    function go_top() {
        window.scrollTo(0, 0);
    }

    function go_bottom() {
        window.scrollTo(0, document.body.scrollHeight);
    }

    function obj_merge(target, source) {
        for (var item in source) {
            if (source.hasOwnProperty(item)) {
                target[item] = source[item];
            }
        }
        return target;
    }
</script>
    

    
    <article class="post-wrap">
        <header class="post-header">
            <h1 class="post-title">Goè¯­è¨€åŸºç¡€</h1>
            
                <div class="post-meta">
                    
                        ğŸ‘¨â€ğŸ“Author: <a itemprop="author" rel="author" href="/">qing-wq</a>
                    

                    
                        <span class="post-time">
                        ğŸ“…Date: <a href="#">ä¹æœˆ 1, 2023</a>
                        </span>
                    
                    <br/>
                    
                        <span class="post-category">
                            ğŸ“šCategory:
                            
                                <a href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">å­¦ä¹ ç¬”è®°</a>
                            
                        </span>
                    
                    
                    
                        <span class="post-count">
                            ğŸ“‘Words:
                            <a href="">6k</a> 
                        </span>
                    
                    
                        <span class="post-count">
                            â±ï¸Time:
                            <a href="">23min</a> 
                        </span>
                                            
                </div>
            
        </header>

        <div class="post-content">
            <h2 id="ç¯å¢ƒæ­å»º"><a href="#ç¯å¢ƒæ­å»º" class="headerlink" title="ç¯å¢ƒæ­å»º"></a>ç¯å¢ƒæ­å»º</h2><ul>
<li><strong>GOPATH</strong>ï¼šä»£è¡¨ Go è¯­è¨€é¡¹ç›®çš„å·¥ä½œç›®å½•ï¼Œåœ¨ Go Module æ¨¡å¼ä¹‹å‰éå¸¸é‡è¦ï¼Œç°åœ¨åŸºæœ¬ä¸Šç”¨æ¥å­˜æ”¾ä½¿ç”¨ go get å‘½ä»¤è·å–çš„é¡¹ç›®ã€‚</li>
<li><strong>GOBIN</strong>ï¼šä»£è¡¨ Go ç¼–è¯‘ç”Ÿæˆçš„ç¨‹åºçš„å®‰è£…ç›®å½•ï¼Œæ¯”å¦‚é€šè¿‡ go install å‘½ä»¤ï¼Œä¼šæŠŠç”Ÿæˆçš„ Go ç¨‹åºå®‰è£…åˆ° GOBIN ç›®å½•ä¸‹ï¼Œä»¥ä¾›ä½ åœ¨ç»ˆç«¯ä½¿ç”¨ã€‚</li>
<li>Goä»£ç†ï¼š<code>GOPROXY=https://goproxy.cn</code></li>
</ul>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> GOROOT=/usr/local/go </span><br><span class="line"><span class="built_in">export</span> GOPATH=<span class="variable">$HOME</span>/MyDoucument/code/goProject</span><br><span class="line"><span class="built_in">export</span> GOBIN=<span class="variable">$GOPATH</span>/bin</span><br><span class="line"><span class="built_in">export</span> GO111MODULE=on</span><br></pre></td></tr></tbody></table></figure>

<h3 id="ç¼–è¯‘å‘å¸ƒ"><a href="#ç¼–è¯‘å‘å¸ƒ" class="headerlink" title="ç¼–è¯‘å‘å¸ƒ"></a>ç¼–è¯‘å‘å¸ƒ</h3><p><code>go build</code>ç¼–è¯‘ç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶</p>
<p><code>go install</code>æŠŠå®ƒå®‰è£…åˆ° <code>$GOBIN</code> ç›®å½•æˆ–è€…ä»»æ„ä½ç½®</p>
<h3 id="è·¨å¹³å°ç¼–è¯‘"><a href="#è·¨å¹³å°ç¼–è¯‘" class="headerlink" title="è·¨å¹³å°ç¼–è¯‘"></a>è·¨å¹³å°ç¼–è¯‘</h3><p>Go è¯­è¨€é€šè¿‡ä¸¤ä¸ªç¯å¢ƒå˜é‡æ¥æ§åˆ¶è·¨å¹³å°ç¼–è¯‘ï¼Œå®ƒä»¬åˆ†åˆ«æ˜¯ <code>GOOS</code> å’Œ <code>GOARCH</code> ã€‚</p>
<ul>
<li><strong>GOOS</strong>ï¼šä»£è¡¨è¦ç¼–è¯‘çš„ç›®æ ‡æ“ä½œç³»ç»Ÿï¼Œå¸¸è§çš„æœ‰ Linuxã€Windowsã€Darwin ç­‰ã€‚</li>
<li><strong>GOARCH</strong>ï¼šä»£è¡¨è¦ç¼–è¯‘çš„ç›®æ ‡å¤„ç†å™¨æ¶æ„ï¼Œå¸¸è§çš„æœ‰ 386ã€AMD64ã€ARM64 ç­‰ã€‚</li>
</ul>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GOOS=linux GOARCH=amd64 go build ./ch01/main.go</span><br></pre></td></tr></tbody></table></figure>

<h1 id="åŸºæœ¬æ•°æ®ç±»å‹"><a href="#åŸºæœ¬æ•°æ®ç±»å‹" class="headerlink" title="åŸºæœ¬æ•°æ®ç±»å‹"></a>åŸºæœ¬æ•°æ®ç±»å‹</h1><h3 id="æ•´å‹"><a href="#æ•´å‹" class="headerlink" title="æ•´å‹"></a>æ•´å‹</h3><ul>
<li><strong>æœ‰ç¬¦å·æ•´å‹</strong>ï¼šå¦‚ <code>int</code>ã€<code>int8</code>ã€<code>int16</code>ã€<code>int32</code> å’Œ <code>int64</code>ã€‚</li>
<li><strong>æ— ç¬¦å·æ•´å‹</strong>ï¼šå¦‚ <code>uint</code>ã€<code>uint8</code>ã€<code>uint16</code>ã€<code>uint32</code> å’Œ <code>uint64</code>ã€‚</li>
</ul>
<p>é™¤äº†æœ‰ç”¨â€œä½â€ï¼ˆbitï¼‰å¤§å°è¡¨ç¤ºçš„æ•´å‹å¤–ï¼Œè¿˜æœ‰ int å’Œ uint è¿™ä¸¤ä¸ªæ²¡æœ‰å…·ä½“ bit å¤§å°çš„æ•´å‹ï¼Œå®ƒä»¬çš„å¤§å°å¯èƒ½æ˜¯ 32bitï¼Œä¹Ÿå¯èƒ½æ˜¯ 64bitï¼Œå’Œç¡¬ä»¶è®¾å¤‡ CPU æœ‰å…³ã€‚</p>
<h3 id="æµ®ç‚¹æ•°"><a href="#æµ®ç‚¹æ•°" class="headerlink" title="æµ®ç‚¹æ•°"></a>æµ®ç‚¹æ•°</h3><ul>
<li><code>float32</code> </li>
<li><code>float64</code></li>
</ul>
<h3 id="å¤æ•°"><a href="#å¤æ•°" class="headerlink" title="å¤æ•°"></a>å¤æ•°</h3><ul>
<li><code>complex64</code></li>
<li><code>complex128</code></li>
</ul>
<p>å¤æ•°æœ‰å®éƒ¨å’Œè™šéƒ¨ï¼Œ<code>complex64</code>çš„å®éƒ¨å’Œè™šéƒ¨ä¸º32ä½ï¼Œ<code>complex128</code>çš„å®éƒ¨å’Œè™šéƒ¨ä¸º64ä½</p>
<h3 id="å¸ƒå°”å€¼"><a href="#å¸ƒå°”å€¼" class="headerlink" title="å¸ƒå°”å€¼"></a>å¸ƒå°”å€¼</h3><p><code>bool</code></p>
<ul>
<li>å¸ƒå°”ç±»å‹å˜é‡çš„é»˜è®¤å€¼ä¸ºfalseã€‚</li>
<li>Go è¯­è¨€ä¸­ä¸å…è®¸å°†æ•´å‹å¼ºåˆ¶è½¬æ¢ä¸ºå¸ƒå°”å‹.</li>
<li>å¸ƒå°”å‹æ— æ³•å‚ä¸æ•°å€¼è¿ç®—ï¼Œä¹Ÿæ— æ³•ä¸å…¶ä»–ç±»å‹è¿›è¡Œè½¬æ¢</li>
</ul>
<h3 id="å­—ç¬¦ä¸²"><a href="#å­—ç¬¦ä¸²" class="headerlink" title="å­—ç¬¦ä¸²"></a>å­—ç¬¦ä¸²</h3><p>*** Go è¯­è¨€é‡Œçš„å­—ç¬¦ä¸²çš„å†…éƒ¨å®ç°ä½¿ç”¨UTF-8ç¼–ç ï¼Œæ¯ä¸ªå­—ç¬¦ä¸²çš„åº•å±‚éƒ½æ˜¯byteæ•°ç»„***</p>
<ul>
<li><em><strong>byteï¼šç›¸å½“äºuint8</strong></em></li>
<li><em><strong>runeï¼šç›¸å½“äºint32</strong></em><ul>
<li>Go ä½¿ç”¨äº†ç‰¹æ®Š <code>rune</code> ç±»å‹æ¥å¤„ç† <code>Unicode</code>ï¼ˆå¤åˆå­—ç¬¦ï¼ŒåŒ…æ‹¬ä¸­æ–‡ã€æ—¥æ–‡ç­‰ç”¨å¤šå­—èŠ‚è¡¨ç¤ºå­—ç¬¦ï¼‰</li>
</ul>
</li>
</ul>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//utf-8éå†</span></span><br><span class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="built_in">len</span>(str); i++ {</span><br><span class="line">    ch := str[i]</span><br><span class="line">    fmt.Printf(<span class="string">"%c \n"</span>, ch)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//Unicodeéå†</span></span><br><span class="line"><span class="keyword">for</span> _, ch1 := <span class="keyword">range</span> str {</span><br><span class="line">    fmt.Printf(<span class="string">"%c \n"</span>, ch1)</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<hr>
<h2 id="Arrayã€Sliceã€Map"><a href="#Arrayã€Sliceã€Map" class="headerlink" title="Arrayã€Sliceã€Map"></a>Arrayã€Sliceã€Map</h2><p><img src="/../images/Go%E8%AF%AD%E8%A8%80%E5%9F%BA%E7%A1%80/image_MkJ3W3cuce.png"></p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">array1:=[<span class="number">5</span>]<span class="type">string</span>{<span class="number">1</span>:<span class="string">"b"</span>,<span class="number">3</span>:<span class="string">"d"</span>}</span><br><span class="line"></span><br><span class="line">slice:=array[start:end]</span><br><span class="line"></span><br><span class="line">slice1:=<span class="built_in">make</span>([]<span class="type">string</span>,<span class="number">4</span>,<span class="number">8</span>)</span><br><span class="line"></span><br><span class="line">slice2:=<span class="built_in">append</span>(slice1,<span class="string">"f"</span>)</span><br><span class="line"></span><br><span class="line">nameAgeMap:=<span class="built_in">make</span>(<span class="keyword">map</span>[<span class="type">string</span>]<span class="type">int</span>)</span><br><span class="line"></span><br><span class="line">nameAgeMap:=<span class="keyword">map</span>[<span class="type">string</span>]<span class="type">int</span>{<span class="string">"é£é›ªæ— æƒ…"</span>:<span class="number">20</span>}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<p>ğŸ“Œæç¤º</p>
<p>åœ¨åˆ›å»ºæ–°åˆ‡ç‰‡çš„æ—¶å€™ï¼Œæœ€å¥½è¦è®©æ–°åˆ‡ç‰‡çš„é•¿åº¦å’Œå®¹é‡ä¸€æ ·ï¼Œè¿™æ ·åœ¨è¿½åŠ æ“ä½œçš„æ—¶å€™å°±ä¼šç”Ÿæˆæ–°çš„åº•å±‚æ•°ç»„ï¼Œä»è€Œå’ŒåŸæœ‰æ•°ç»„åˆ†ç¦»ï¼Œå°±ä¸ä¼šå› ä¸ºå…±ç”¨åº•å±‚æ•°ç»„å¯¼è‡´ä¿®æ”¹å†…å®¹çš„æ—¶å€™å½±å“å¤šä¸ªåˆ‡ç‰‡ã€‚</p>
</blockquote>
<h2 id="å‡½æ•°å’Œæ–¹æ³•"><a href="#å‡½æ•°å’Œæ–¹æ³•" class="headerlink" title="å‡½æ•°å’Œæ–¹æ³•"></a>å‡½æ•°å’Œæ–¹æ³•</h2><p>åœ¨ Go è¯­è¨€ä¸­ï¼Œæ–¹æ³•å’Œå‡½æ•°æ˜¯ä¸¤ä¸ªæ¦‚å¿µï¼Œä½†åˆéå¸¸ç›¸ä¼¼ï¼Œä¸åŒç‚¹åœ¨äºæ–¹æ³•å¿…é¡»è¦æœ‰ä¸€ä¸ªæ¥æ”¶è€…ï¼Œè¿™ä¸ªæ¥æ”¶è€…æ˜¯ä¸€ä¸ªç±»å‹ï¼Œè¿™æ ·æ–¹æ³•å°±å’Œè¿™ä¸ªç±»å‹ç»‘å®šåœ¨ä¸€èµ·ï¼Œç§°ä¸ºè¿™ä¸ªç±»å‹çš„æ–¹æ³•ã€‚</p>
<ul>
<li>å‡½æ•°ï¼šæ­£å¸¸çš„ä»£ç é€»è¾‘</li>
<li>æ–¹æ³•ï¼šç‰¹å®šç±»å‹æ‰æœ‰ï¼Œç›¸å½“äºå¯¹è±¡çš„æ–¹æ³•</li>
</ul>
<h3 id="å€¼ç±»å‹æ¥æ”¶è€…å’ŒæŒ‡é’ˆç±»å‹æ¥æ”¶è€…"><a href="#å€¼ç±»å‹æ¥æ”¶è€…å’ŒæŒ‡é’ˆç±»å‹æ¥æ”¶è€…" class="headerlink" title="å€¼ç±»å‹æ¥æ”¶è€…å’ŒæŒ‡é’ˆç±»å‹æ¥æ”¶è€…"></a>å€¼ç±»å‹æ¥æ”¶è€…å’ŒæŒ‡é’ˆç±»å‹æ¥æ”¶è€…</h3><ul>
<li>å€¼ç±»å‹æ¥æ”¶è€…ï¼šä¸ä¼šæ”¹å˜åŸæ¥çš„å¯¹è±¡ï¼Œç›¸å½“äºæ“ä½œå¯¹è±¡çš„æ‹·è´</li>
<li>æŒ‡é’ˆç±»å‹æ¥æ”¶è€…ï¼šé€šè¿‡æŒ‡é’ˆå¯ä»¥è·å–å¯¹è±¡åœ°å€ï¼Œå¯ä»¥ç›´æ¥æ”¹å˜åŸæ¥çš„å¯¹è±¡</li>
</ul>
<blockquote>
<p>æç¤ºï¼šåœ¨è°ƒç”¨æ–¹æ³•çš„æ—¶å€™ï¼Œä¼ é€’çš„æ¥æ”¶è€…æœ¬è´¨ä¸Šéƒ½æ˜¯å‰¯æœ¬ï¼Œåªä¸è¿‡ä¸€ä¸ªæ˜¯è¿™ä¸ªå€¼çš„å‰¯æœ¬ï¼Œä¸€æ˜¯æŒ‡å‘è¿™ä¸ªå€¼æŒ‡é’ˆçš„å‰¯æœ¬ã€‚æŒ‡é’ˆå…·æœ‰æŒ‡å‘åŸæœ‰å€¼çš„ç‰¹æ€§ï¼Œæ‰€ä»¥ä¿®æ”¹äº†æŒ‡é’ˆæŒ‡å‘çš„å€¼ï¼Œä¹Ÿå°±ä¿®æ”¹äº†åŸæœ‰çš„å€¼ã€‚<em><strong>æˆ‘ä»¬å¯ä»¥ç®€å•åœ°ç†è§£ä¸ºå€¼æ¥æ”¶è€…ä½¿ç”¨çš„æ˜¯å€¼çš„å‰¯æœ¬æ¥è°ƒç”¨æ–¹æ³•ï¼Œè€ŒæŒ‡é’ˆæ¥æ”¶è€…ä½¿ç”¨å®é™…çš„å€¼æ¥è°ƒç”¨æ–¹æ³•ã€‚</strong></em></p>
</blockquote>
<blockquote>
<p>ğŸ“Œå€¼æ¥å—è€…æ–¹æ³•ä¸ä¼šæ”¹å˜åŸå§‹ç»“æ„ä½“å®ä¾‹</p>
</blockquote>
<ul>
<li>å¦‚æœä½¿ç”¨ä¸€ä¸ªå€¼ç±»å‹å˜é‡è°ƒç”¨æŒ‡é’ˆç±»å‹æ¥æ”¶è€…çš„æ–¹æ³•ï¼ŒGo è¯­è¨€ç¼–è¯‘å™¨ä¼šè‡ªåŠ¨å¸®æˆ‘ä»¬å–æŒ‡é’ˆè°ƒç”¨ï¼Œä»¥æ»¡è¶³æŒ‡é’ˆæ¥æ”¶è€…çš„è¦æ±‚ã€‚</li>
<li>åŒæ ·çš„åŸç†ï¼Œå¦‚æœä½¿ç”¨ä¸€ä¸ªæŒ‡é’ˆç±»å‹å˜é‡è°ƒç”¨å€¼ç±»å‹æ¥æ”¶è€…çš„æ–¹æ³•ï¼ŒGo è¯­è¨€ç¼–è¯‘å™¨ä¼šè‡ªåŠ¨å¸®æˆ‘ä»¬è§£å¼•ç”¨è°ƒç”¨ï¼Œä»¥æ»¡è¶³å€¼ç±»å‹æ¥æ”¶è€…çš„è¦æ±‚ã€‚</li>
</ul>
<h3 id="å€¼ç±»å‹è°ƒç”¨è€…å’ŒæŒ‡é’ˆç±»å‹è°ƒç”¨è€…"><a href="#å€¼ç±»å‹è°ƒç”¨è€…å’ŒæŒ‡é’ˆç±»å‹è°ƒç”¨è€…" class="headerlink" title="å€¼ç±»å‹è°ƒç”¨è€…å’ŒæŒ‡é’ˆç±»å‹è°ƒç”¨è€…"></a>å€¼ç±»å‹è°ƒç”¨è€…å’ŒæŒ‡é’ˆç±»å‹è°ƒç”¨è€…</h3><p>åœ¨å®˜æ–¹effective goæ–‡æ¡£ä¸­ï¼Œå¯¹ä¸¤è€…åŒºåˆ«æè¿°å¦‚ä¸‹ï¼š</p>
<ul>
<li><em><strong>å€¼æ–¹æ³•ï¼ˆvalue methodsï¼‰å¯ä»¥é€šè¿‡æŒ‡é’ˆå’Œå€¼è°ƒç”¨ï¼Œä½†æ˜¯æŒ‡é’ˆæ–¹æ³•ï¼ˆpointer methodsï¼‰åªèƒ½é€šè¿‡æŒ‡é’ˆæ¥è°ƒç”¨</strong></em><em><strong>ã€‚</strong></em></li>
<li>ä½†æœ‰ä¸€ä¸ªä¾‹å¤–ï¼Œå¦‚æœæŸä¸ªå€¼æ˜¯å¯å¯»å€çš„ï¼ˆaddressableï¼Œæˆ–è€…è¯´<em>å·¦å€¼</em>ï¼‰ï¼Œé‚£ä¹ˆç¼–è¯‘å™¨ä¼šåœ¨å€¼è°ƒç”¨æŒ‡é’ˆæ–¹æ³•æ—¶è‡ªåŠ¨æ’å…¥å–åœ°å€ç¬¦ï¼Œä½¿å¾—åœ¨æ­¤æƒ…å½¢ä¸‹çœ‹èµ·æ¥åƒæŒ‡é’ˆæ–¹æ³•ä¹Ÿå¯ä»¥é€šè¿‡å€¼æ¥è°ƒç”¨ã€‚</li>
</ul>
<hr>
<p>æ€»ç»“ï¼š</p>
<ul>
<li>ä¸ç®¡æ˜¯æ™®é€šå¯¹è±¡è¿˜æ˜¯æŒ‡é’ˆï¼Œéƒ½å¯ä»¥è°ƒç”¨ä»–ä»¬çš„å€¼æ–¹æ³•å’ŒæŒ‡é’ˆæ–¹æ³•ï¼Œå› ä¸ºç¼–è¯‘å™¨ä¼šè‡ªè¡Œå¤„ç†ï¼ˆè¯­æ³•ç³–</li>
<li><strong>é‡äº‹ä¸å†³è¯·ç”¨pointer methodï¼ï¼ï¼</strong></li>
</ul>
<h3 id="é€šè¿‡å˜é‡è°ƒç”¨æ–¹æ³•"><a href="#é€šè¿‡å˜é‡è°ƒç”¨æ–¹æ³•" class="headerlink" title="é€šè¿‡å˜é‡è°ƒç”¨æ–¹æ³•"></a>é€šè¿‡å˜é‡è°ƒç”¨æ–¹æ³•</h3><figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">student := Student(<span class="string">"my name is xiaoming, I am "</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ–¹æ³•èµ‹å€¼ç»™å˜é‡</span></span><br><span class="line">sm := Student.stu</span><br><span class="line">sm2 := (*Student).stu2</span><br><span class="line">sm(student, <span class="number">2</span>)</span><br><span class="line">sm2(&amp;student)</span><br><span class="line">student.stu(<span class="number">1</span>)</span><br></pre></td></tr></tbody></table></figure>

<h2 id="ç»“æ„ä½“å’Œæ¥å£"><a href="#ç»“æ„ä½“å’Œæ¥å£" class="headerlink" title="ç»“æ„ä½“å’Œæ¥å£"></a>ç»“æ„ä½“å’Œæ¥å£</h2><p>ç»“æ„ä½“å®šä¹‰ï¼š</p>
<figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">type Stu <span class="class"><span class="keyword">struct</span>{</span></span><br><span class="line">  name <span class="built_in">string</span></span><br><span class="line">  age <span class="type">int</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// åŒ¿åç»“æ„ä½“ å˜é‡ </span></span><br><span class="line">var stu <span class="class"><span class="keyword">struct</span> {</span></span><br><span class="line">  name <span class="built_in">string</span></span><br><span class="line">  age <span class="type">int</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// åŒ¿åç»“æ„ä½“å˜é‡å¦ä¸€ç§å†™æ³•</span></span><br><span class="line">newCar := <span class="keyword">struct</span> {</span><br><span class="line">  Make    <span class="built_in">string</span> `json:<span class="string">"make"</span>`</span><br><span class="line">  Model   <span class="built_in">string</span> `json:<span class="string">"model"</span>`</span><br><span class="line">  Mileage <span class="type">int</span>    `json:<span class="string">"mileage"</span>`</span><br><span class="line">}{}</span><br><span class="line"></span><br><span class="line"><span class="comment">// MyStringer interface</span></span><br><span class="line">type MyStringer interface{</span><br><span class="line">  myString() <span class="built_in">string</span></span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p><em><strong>ä»¥æŒ‡é’ˆç±»å‹æ¥æ”¶è€…å®ç°æ¥å£çš„æ—¶å€™ï¼Œåªæœ‰å¯¹åº”çš„æŒ‡é’ˆç±»å‹å®ä¾‹æ‰è¢«è®¤ä¸ºå®ç°äº†è¯¥æ¥å£ã€‚</strong></em></p>
<p><img src="/../images/Go%E8%AF%AD%E8%A8%80%E5%9F%BA%E7%A1%80/Ciqc1F-yPMSAZ4k7AABU_GW4VxE080_qJvRefMHb8.png"></p>
<h3 id="å·¥å‚å‡½æ•°ï¼ˆæ„é€ å‡½æ•°ï¼‰"><a href="#å·¥å‚å‡½æ•°ï¼ˆæ„é€ å‡½æ•°ï¼‰" class="headerlink" title="å·¥å‚å‡½æ•°ï¼ˆæ„é€ å‡½æ•°ï¼‰"></a>å·¥å‚å‡½æ•°ï¼ˆæ„é€ å‡½æ•°ï¼‰</h3><p>å·¥å‚å‡½æ•°ä¸€èˆ¬ç”¨äºåˆ›å»ºè‡ªå®šä¹‰çš„ç»“æ„ä½“ï¼Œä¾¿äºä½¿ç”¨è€…è°ƒç”¨</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewPerson</span><span class="params">(name <span class="type">string</span>)</span></span> *person {</span><br><span class="line">    <span class="keyword">return</span> &amp;person{name:name}</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<h3 id="ç»§æ‰¿å’Œç»„åˆ"><a href="#ç»§æ‰¿å’Œç»„åˆ" class="headerlink" title="ç»§æ‰¿å’Œç»„åˆ"></a>ç»§æ‰¿å’Œç»„åˆ</h3><p>åœ¨ Go è¯­è¨€ä¸­æ²¡æœ‰ç»§æ‰¿çš„æ¦‚å¿µï¼Œæ‰€ä»¥ç»“æ„ã€æ¥å£ä¹‹é—´ä¹Ÿæ²¡æœ‰çˆ¶å­å…³ç³»ï¼ŒGo è¯­è¨€æå€¡çš„æ˜¯ç»„åˆï¼Œåˆ©ç”¨ç»„åˆè¾¾åˆ°ä»£ç å¤ç”¨çš„ç›®çš„ï¼Œè¿™ä¹Ÿæ›´çµæ´»ã€‚</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç»„åˆ</span></span><br><span class="line">p:=person{</span><br><span class="line">    age:<span class="number">30</span>,</span><br><span class="line">    name:<span class="string">"é£é›ªæ— æƒ…"</span>,</span><br><span class="line">    address:address{</span><br><span class="line">        province: <span class="string">"åŒ—äº¬"</span>,</span><br><span class="line">        city:     <span class="string">"åŒ—äº¬"</span>,</span><br><span class="line">    },</span><br><span class="line">}</span><br><span class="line"><span class="comment">//åƒä½¿ç”¨è‡ªå·±çš„å­—æ®µä¸€æ ·ï¼Œç›´æ¥ä½¿ç”¨</span></span><br><span class="line">fmt.Println(p.province)</span><br></pre></td></tr></tbody></table></figure>

<p>ç±»å‹ç»„åˆåï¼Œå¤–éƒ¨ç±»å‹ä¸ä»…å¯ä»¥ä½¿ç”¨å†…éƒ¨ç±»å‹çš„å­—æ®µï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å†…éƒ¨ç±»å‹çš„æ–¹æ³•ï¼Œå°±åƒä½¿ç”¨è‡ªå·±çš„æ–¹æ³•ä¸€æ ·ã€‚<br><strong>æ–¹æ³•è¦†å†™</strong>ï¼šå¦‚æœå¤–éƒ¨ç±»å‹å®šä¹‰äº†å’Œå†…éƒ¨ç±»å‹åŒæ ·çš„æ–¹æ³•ï¼Œé‚£ä¹ˆå¤–éƒ¨ç±»å‹çš„ä¼šè¦†ç›–å†…éƒ¨ç±»å‹ï¼Œè¿™å°±æ˜¯ã€‚</p>
<h3 id="ç±»å‹æ–­è¨€"><a href="#ç±»å‹æ–­è¨€" class="headerlink" title="ç±»å‹æ–­è¨€"></a>ç±»å‹æ–­è¨€</h3><p>ç±»å‹æ–­è¨€ç”¨æ¥åˆ¤æ–­ä¸€ä¸ªæ¥å£çš„å€¼æ˜¯å¦æ˜¯å®ç°è¯¥æ¥å£çš„æŸä¸ªå…·ä½“ç±»å‹ã€‚</p>
<p>æ¥å£å¼•ç”¨æ‹¥æœ‰æ–­è¨€èƒ½åŠ›ï¼Œç”¨äºåˆ¤æ–­å½“å‰å¼•ç”¨æ˜¯å¦å±äºæŸä¸ªå¯¹è±¡çš„å®ä¾‹</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ¥å£å¼•ç”¨æŒ‡å‘å­ç±»å®ä¾‹</span></span><br><span class="line"><span class="keyword">var</span> myInterface MyInterface = NewTest(<span class="string">"test"</span>, <span class="number">18</span>, <span class="string">"test"</span>)</span><br><span class="line"><span class="comment">// åˆ¤æ–­myInterfaceæ˜¯å¦æ˜¯Testç±»å‹</span></span><br><span class="line"><span class="keyword">if</span> _, ok := myInterface.(*Test);!ok {</span><br><span class="line">  <span class="built_in">panic</span>(<span class="string">"myInterface ä¸æ˜¯ Testå®ä¾‹"</span>)</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p><strong>åœ¨ç±»å‹æ–­è¨€çš„æ—¶å€™ï¼ŒåŒæ—¶å®Œæˆäº†ç±»å‹è½¬æ¢</strong></p>
<h2 id="Error"><a href="#Error" class="headerlink" title="Error"></a>Error</h2><p>åœ¨ Go è¯­è¨€ä¸­ï¼Œé”™è¯¯æ˜¯é€šè¿‡å†…ç½®çš„ error æ¥å£è¡¨ç¤ºçš„ï¼š</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// error å®šä¹‰</span></span><br><span class="line"><span class="keyword">type</span> <span class="type">error</span> <span class="keyword">interface</span> {</span><br><span class="line">   Error() <span class="type">string</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// å·¥å‚å‡½æ•°</span></span><br><span class="line">errors.New(<span class="string">"error"</span>)</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p><strong>è‡ªå®šä¹‰å¼‚å¸¸</strong></p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> commonError <span class="keyword">struct</span> {</span><br><span class="line">  errorCode <span class="type">int</span>    <span class="comment">//é”™è¯¯ç </span></span><br><span class="line">  errorMsg  <span class="type">string</span> <span class="comment">//é”™è¯¯ä¿¡æ¯</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"> <span class="comment">// å®ç°äº†Error()å°±æ˜¯è‡ªå®šä¹‰å¼‚å¸¸ </span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(ce *commonError)</span></span> Error() <span class="type">string</span> {</span><br><span class="line">  <span class="keyword">return</span> ce.errorMsg</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h3 id="Error-Wrapping"><a href="#Error-Wrapping" class="headerlink" title="Error Wrapping"></a>Error Wrapping</h3><p>ä¸Šè¿°è‡ªå®šä¹‰å¼‚å¸¸å¯ä»¥æ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚ï¼Œä½†æ˜¯éå¸¸çƒ¦çï¼Œå› ä¸ºæ—¢è¦å®šä¹‰æ–°çš„ç±»å‹è¿˜è¦å®ç° error æ¥å£ã€‚</p>
<p> Go è¯­è¨€ 1.13 ç‰ˆæœ¬å¼€å§‹ï¼ŒGo æ ‡å‡†åº“æ–°å¢äº† Error Wrapping åŠŸèƒ½ï¼Œè®©æˆ‘ä»¬å¯ä»¥åŸºäºä¸€ä¸ªå­˜åœ¨çš„ error ç”Ÿæˆæ–°çš„ errorï¼Œå¹¶ä¸”å¯ä»¥ä¿ç•™åŸ error ä¿¡æ¯ã€‚</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// wrap</span></span><br><span class="line">e := errors.New(<span class="string">"åŸå§‹é”™è¯¯e"</span>)</span><br><span class="line">w := fmt.Errorf(<span class="string">"Wrapäº†ä¸€ä¸ªé”™è¯¯:%w"</span>, e)</span><br><span class="line">fmt.Println(w)   <span class="comment">// wrapäº†ä¸€ä¸ªé”™è¯¯:åŸå§‹é”™è¯¯e</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Unwrap</span></span><br><span class="line">fmt.Println(errors.Unwrap(w))   <span class="comment">// åŸå§‹é”™è¯¯e</span></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<h3 id="errors-Is"><a href="#errors-Is" class="headerlink" title="errors.Is"></a>errors.Is</h3><p>æœ‰äº† Error Wrapping åï¼Œä½ ä¼šå‘ç°åŸæ¥ç”¨çš„åˆ¤æ–­ä¸¤ä¸ª error æ˜¯ä¸æ˜¯åŒä¸€ä¸ª error çš„æ–¹æ³•å¤±æ•ˆäº†ï¼Œæ¯”å¦‚ Go è¯­è¨€æ ‡å‡†åº“ç»å¸¸ç”¨åˆ°çš„å¦‚ä¸‹ä»£ç ä¸­çš„æ–¹å¼ï¼š</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">fmt.Println(errors.Is(w, e))  <span class="comment">// true</span></span><br><span class="line">fmt.Println(e == os.ErrExist) <span class="comment">// false</span></span><br></pre></td></tr></tbody></table></figure>

<p><code>errors.ls</code></p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Is</span><span class="params">(err, target <span class="type">error</span>)</span></span> <span class="type">bool</span></span><br></pre></td></tr></tbody></table></figure>

<p>ä»¥ä¸Šå°±æ˜¯errors.Is å‡½æ•°çš„å®šä¹‰ï¼Œå¯ä»¥è§£é‡Šä¸ºï¼š</p>
<ul>
<li>å¦‚æœ err å’Œ target æ˜¯åŒä¸€ä¸ªï¼Œé‚£ä¹ˆè¿”å› trueã€‚</li>
<li>å¦‚æœ err æ˜¯ä¸€ä¸ª wrapping errorï¼Œtarget ä¹ŸåŒ…å«åœ¨è¿™ä¸ªåµŒå¥— error é“¾ä¸­çš„è¯ï¼Œä¹Ÿè¿”å› trueã€‚</li>
</ul>
<blockquote>
<p>ğŸ“Œå¯ä»¥ç®€å•åœ°æ¦‚æ‹¬ä¸ºï¼Œä¸¤ä¸ª error ç›¸ç­‰æˆ– err åŒ…å« target çš„æƒ…å†µä¸‹è¿”å› trueï¼Œå…¶ä½™è¿”å› falseã€‚</p>
</blockquote>
<h3 id="errors-As"><a href="#errors-As" class="headerlink" title="errors.As"></a>errors.As</h3><p>åŒæ ·çš„åŸå› ï¼Œæœ‰äº† error åµŒå¥—åï¼Œerror æ–­è¨€ä¹Ÿä¸èƒ½ç”¨äº†ï¼Œå› ä¸ºä½ ä¸çŸ¥é“ä¸€ä¸ª error æ˜¯å¦è¢«åµŒå¥—ï¼ŒåˆåµŒå¥—äº†å‡ å±‚ã€‚æ‰€ä»¥ Go è¯­è¨€ä¸ºè§£å†³è¿™ä¸ªé—®é¢˜æä¾›äº† errors.As å‡½æ•°ï¼Œæ¯”å¦‚å‰é¢ error æ–­è¨€çš„ä¾‹å­ï¼Œå¯ä»¥ä½¿ç”¨  errors.As å‡½æ•°é‡å†™ï¼Œæ•ˆæœæ˜¯ä¸€æ ·çš„ï¼Œå¦‚ä¸‹é¢çš„ä»£ç æ‰€ç¤ºï¼š</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> cm *commonError</span><br><span class="line"><span class="keyword">if</span> errors.As(err,&amp;cm){</span><br><span class="line">   fmt.Println(<span class="string">"é”™è¯¯ä»£ç ä¸º:"</span>,cm.errorCode,<span class="string">"ï¼Œé”™è¯¯ä¿¡æ¯ä¸ºï¼š"</span>,cm.errorMsg)</span><br><span class="line">} <span class="keyword">else</span> {</span><br><span class="line">   fmt.Println(sum)</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h3 id="Deferred"><a href="#Deferred" class="headerlink" title="Deferred"></a>Deferred</h3><p>defer è¯­å¥å¸¸è¢«ç”¨äºæˆå¯¹çš„æ“ä½œï¼Œå¦‚æ–‡ä»¶çš„æ‰“å¼€å’Œå…³é—­ï¼ŒåŠ é”å’Œé‡Šæ”¾é”ï¼Œè¿æ¥çš„å»ºç«‹å’Œæ–­å¼€ç­‰ã€‚ä¸ç®¡å¤šä¹ˆå¤æ‚çš„æ“ä½œï¼Œéƒ½å¯ä»¥ä¿è¯èµ„æºè¢«æ­£ç¡®åœ°é‡Šæ”¾ã€‚</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">ReadFile</span><span class="params">(filename <span class="type">string</span>)</span></span> ([]<span class="type">byte</span>, <span class="type">error</span>) {</span><br><span class="line">   f, err := os.Open(filename)</span><br><span class="line">   <span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">   }</span><br><span class="line">   <span class="keyword">defer</span> f.Close()</span><br><span class="line">   <span class="comment">//çœç•¥æ— å…³ä»£ç </span></span><br><span class="line">   <span class="keyword">return</span> readAll(f, n)</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<ol>
<li>åœ¨ä¸€ä¸ªæ–¹æ³•æˆ–è€…å‡½æ•°ä¸­ï¼Œå¯ä»¥æœ‰å¤šä¸ª defer è¯­å¥ï¼›</li>
<li>defer æœ‰ä¸€ä¸ªè°ƒç”¨æ ˆï¼Œå¤šä¸ª defer è¯­å¥çš„æ‰§è¡Œé¡ºåºä¾ç…§<strong>åè¿›å…ˆå‡º</strong>çš„åŸåˆ™ã€‚</li>
</ol>
<h3 id="Panic"><a href="#Panic" class="headerlink" title="Panic"></a>Panic</h3><p>Go è¯­è¨€æ˜¯ä¸€é—¨é™æ€çš„å¼ºç±»å‹è¯­è¨€ï¼Œå¾ˆå¤šé—®é¢˜éƒ½å°½å¯èƒ½åœ°åœ¨ç¼–è¯‘æ—¶æ•è·ï¼Œä½†æ˜¯æœ‰ä¸€äº›åªèƒ½åœ¨è¿è¡Œæ—¶æ£€æŸ¥ï¼Œæ¯”å¦‚æ•°ç»„è¶Šç•Œè®¿é—®ã€ä¸ç›¸åŒçš„ç±»å‹å¼ºåˆ¶è½¬æ¢ç­‰ï¼Œè¿™ç±»è¿è¡Œæ—¶çš„é—®é¢˜ä¼šå¼•èµ· panic å¼‚å¸¸ã€‚é™¤äº†è¿è¡Œæ—¶å¯ä»¥äº§ç”Ÿ panic å¤–ï¼Œæˆ‘ä»¬è‡ªå·±ä¹Ÿå¯ä»¥æŠ›å‡º panic å¼‚å¸¸ã€‚</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">panic</span><span class="params">(v <span class="keyword">interface</span>{})</span></span></span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<p><code>interface{}</code> æ˜¯ç©ºæ¥å£çš„æ„æ€ï¼Œåœ¨ Go è¯­è¨€ä¸­ä»£è¡¨ä»»æ„ç±»å‹ã€‚</p>
</blockquote>
<p>panic å¼‚å¸¸æ˜¯ä¸€ç§éå¸¸ä¸¥é‡çš„æƒ…å†µï¼Œä¼šè®©ç¨‹åºä¸­æ–­è¿è¡Œï¼Œä½¿ç¨‹åºå´©æºƒï¼Œæ‰€ä»¥<strong>å¦‚æœæ˜¯ä¸å½±å“ç¨‹åºè¿è¡Œçš„é”™è¯¯ï¼Œä¸è¦ä½¿ç”¨ panicï¼Œä½¿ç”¨æ™®é€šé”™è¯¯ error å³å¯ã€‚</strong></p>
<h4 id="Recover-æ•è·-Panic-å¼‚å¸¸"><a href="#Recover-æ•è·-Panic-å¼‚å¸¸" class="headerlink" title="Recover æ•è· Panic å¼‚å¸¸"></a>Recover æ•è· Panic å¼‚å¸¸</h4><p>é€šå¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¸å¯¹ panic å¼‚å¸¸åšä»»ä½•å¤„ç†ï¼Œå› ä¸ºæ—¢ç„¶å®ƒæ˜¯å½±å“ç¨‹åºè¿è¡Œçš„å¼‚å¸¸ï¼Œå°±è®©å®ƒç›´æ¥å´©æºƒå³å¯ã€‚ä½†æ˜¯ä¹Ÿçš„ç¡®æœ‰ä¸€äº›ç‰¹ä¾‹ï¼Œæ¯”å¦‚<strong>åœ¨****ç¨‹åºå´©æºƒå‰åšä¸€äº›èµ„æºé‡Šæ”¾çš„å¤„ç†</strong>ï¼Œè¿™æ—¶å€™å°±éœ€è¦ä» panic å¼‚å¸¸ä¸­æ¢å¤ï¼Œæ‰èƒ½å®Œæˆå¤„ç†ã€‚</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">connectMySQL</span><span class="params">(ip, username, password <span class="type">string</span>)</span></span> {</span><br><span class="line">  <span class="keyword">if</span> ip == <span class="string">""</span> {</span><br><span class="line">    <span class="built_in">panic</span>(<span class="string">"ipä¸èƒ½ä¸ºç©º"</span>)</span><br><span class="line">  }</span><br><span class="line">  <span class="comment">//çœç•¥å…¶ä»–ä»£ç </span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">  <span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> {</span><br><span class="line">    <span class="keyword">if</span> p := <span class="built_in">recover</span>(); p != <span class="literal">nil</span> {</span><br><span class="line">      fmt.Println(p)</span><br><span class="line">    }</span><br><span class="line">  }()</span><br><span class="line">  connectMySQL(<span class="string">""</span>, <span class="string">"root"</span>, <span class="string">"123456"</span>)</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h1 id="å¹¶å‘åŸºç¡€"><a href="#å¹¶å‘åŸºç¡€" class="headerlink" title="å¹¶å‘åŸºç¡€"></a>å¹¶å‘åŸºç¡€</h1><h2 id="åç¨‹ï¼ˆGoroutineï¼‰"><a href="#åç¨‹ï¼ˆGoroutineï¼‰" class="headerlink" title="åç¨‹ï¼ˆGoroutineï¼‰"></a>åç¨‹ï¼ˆGoroutineï¼‰</h2><p>Go è¯­è¨€ä¸­æ²¡æœ‰çº¿ç¨‹çš„æ¦‚å¿µï¼Œåªæœ‰åç¨‹ï¼Œä¹Ÿç§°ä¸º goroutineã€‚</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">go</span> function()</span><br></pre></td></tr></tbody></table></figure>

<h2 id="Channel"><a href="#Channel" class="headerlink" title="Channel"></a>Channel</h2><figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ch:=<span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">string</span>)</span><br></pre></td></tr></tbody></table></figure>

<ol>
<li>æ¥æ”¶ï¼šè·å– chan ä¸­çš„å€¼ï¼Œæ“ä½œç¬¦ä¸º<code> &lt;- chan</code>ã€‚</li>
<li>å‘é€ï¼šå‘ chan å‘é€å€¼ï¼ŒæŠŠå€¼æ”¾åœ¨ chan ä¸­ï¼Œæ“ä½œç¬¦ä¸º <code>chan &lt;-</code>ã€‚</li>
</ol>
<h3 id="æ— ç¼“å†²-channel"><a href="#æ— ç¼“å†²-channel" class="headerlink" title="æ— ç¼“å†² channel"></a><strong>æ— ç¼“å†² channel</strong></h3><p>æ— ç¼“å†² channelï¼Œå®ƒçš„å®¹é‡æ˜¯ 0ï¼Œä¸èƒ½å­˜å‚¨ä»»ä½•æ•°æ®ã€‚æ‰€ä»¥æ— ç¼“å†² channel åªèµ·åˆ°ä¼ è¾“æ•°æ®çš„ä½œç”¨ï¼Œæ•°æ®å¹¶ä¸ä¼šåœ¨ channel ä¸­åšä»»ä½•åœç•™ã€‚è¿™ä¹Ÿæ„å‘³ç€ï¼Œæ— ç¼“å†² channel çš„å‘é€å’Œæ¥æ”¶æ“ä½œæ˜¯åŒæ—¶è¿›è¡Œçš„ï¼Œå®ƒä¹Ÿå¯ä»¥ç§°ä¸ºåŒæ­¥ channelã€‚</p>
<h3 id="æœ‰ç¼“å†²-channel"><a href="#æœ‰ç¼“å†²-channel" class="headerlink" title="æœ‰ç¼“å†² channel"></a>æœ‰ç¼“å†² channel</h3><p>æœ‰ç¼“å†² channel ç±»ä¼¼ä¸€ä¸ªå¯é˜»å¡çš„é˜Ÿåˆ—ï¼Œå†…éƒ¨çš„å…ƒç´ <em><strong>å…ˆè¿›å…ˆå‡º</strong></em>ã€‚é€šè¿‡ make å‡½æ•°çš„ç¬¬äºŒä¸ªå‚æ•°å¯ä»¥æŒ‡å®š channel å®¹é‡çš„å¤§å°ï¼Œè¿›è€Œåˆ›å»ºä¸€ä¸ªæœ‰ç¼“å†² channelã€‚</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cacheCh:=<span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">int</span>,<span class="number">5</span>)</span><br></pre></td></tr></tbody></table></figure>

<p><img src="/../images/Go%E8%AF%AD%E8%A8%80%E5%9F%BA%E7%A1%80/CgqCHl-7fzmAVLu0AACSjW-neAE188_bGrO7t8IpW.png"></p>
<p>ä¸€ä¸ªæœ‰ç¼“å†² channel å…·å¤‡ä»¥ä¸‹ç‰¹ç‚¹ï¼š</p>
<ol>
<li>æœ‰ç¼“å†² channel çš„å†…éƒ¨æœ‰ä¸€ä¸ªç¼“å†²é˜Ÿåˆ—ï¼›</li>
<li>å‘é€æ“ä½œæ˜¯å‘é˜Ÿåˆ—çš„å°¾éƒ¨æ’å…¥å…ƒç´ ï¼Œå¦‚æœé˜Ÿåˆ—å·²æ»¡ï¼Œåˆ™é˜»å¡ç­‰å¾…ï¼Œç›´åˆ°å¦ä¸€ä¸ª goroutine æ‰§è¡Œï¼Œæ¥æ”¶æ“ä½œé‡Šæ”¾é˜Ÿåˆ—çš„ç©ºé—´ï¼›</li>
<li>æ¥æ”¶æ“ä½œæ˜¯ä»é˜Ÿåˆ—çš„å¤´éƒ¨è·å–å…ƒç´ å¹¶æŠŠå®ƒä»é˜Ÿåˆ—ä¸­åˆ é™¤ï¼Œå¦‚æœé˜Ÿåˆ—ä¸ºç©ºï¼Œåˆ™é˜»å¡ç­‰å¾…ï¼Œç›´åˆ°å¦ä¸€ä¸ª goroutine æ‰§è¡Œï¼Œå‘é€æ“ä½œæ’å…¥æ–°çš„å…ƒç´ ã€‚</li>
</ol>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è·å–é˜Ÿåˆ—å®¹é‡å’Œå…ƒç´ ä¸ªæ•°ï¼š</span></span><br><span class="line">fmt.Println(<span class="string">"cacheChå®¹é‡ä¸º:"</span>,<span class="built_in">cap</span>(cacheCh),<span class="string">",å…ƒç´ ä¸ªæ•°ä¸ºï¼š"</span>,<span class="built_in">len</span>(cacheCh))</span><br><span class="line"></span><br><span class="line"><span class="comment">// å…³é—­ channel</span></span><br><span class="line"><span class="built_in">close</span>(cacheCh)</span><br></pre></td></tr></tbody></table></figure>

<p>å¦‚æœä¸€ä¸ª channel è¢«å…³é—­äº†ï¼Œå°±ä¸èƒ½å‘é‡Œé¢å‘é€æ•°æ®äº†ï¼Œå¦‚æœå‘é€çš„è¯ï¼Œä¼šå¼•èµ· painc å¼‚å¸¸ã€‚ä½†æ˜¯è¿˜å¯ä»¥æ¥æ”¶ channel é‡Œçš„æ•°æ®ï¼Œå¦‚æœ channel é‡Œæ²¡æœ‰æ•°æ®çš„è¯ï¼Œæ¥æ”¶çš„æ•°æ®æ˜¯å…ƒç´ ç±»å‹çš„é›¶å€¼ã€‚</p>
<h3 id="å•å‘-channel"><a href="#å•å‘-channel" class="headerlink" title="å•å‘ channel"></a>å•å‘ channel</h3><p>æœ‰æ—¶å€™ï¼Œæˆ‘ä»¬æœ‰ä¸€äº›ç‰¹æ®Šçš„ä¸šåŠ¡éœ€æ±‚ï¼Œæ¯”å¦‚é™åˆ¶ä¸€ä¸ª channel åªå¯ä»¥æ¥æ”¶ä½†æ˜¯ä¸èƒ½å‘é€ï¼Œæˆ–è€…é™åˆ¶ä¸€ä¸ª channel åªèƒ½å‘é€ä½†ä¸èƒ½æ¥æ”¶ï¼Œè¿™ç§ channel ç§°ä¸ºå•å‘ channelã€‚</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">onlySend := <span class="built_in">make</span>(<span class="keyword">chan</span>&lt;- <span class="type">int</span>)</span><br><span class="line">onlyReceive:=<span class="built_in">make</span>(&lt;-<span class="keyword">chan</span> <span class="type">int</span>)</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<h3 id="select-å¤šè·¯å¤ç”¨"><a href="#select-å¤šè·¯å¤ç”¨" class="headerlink" title="select å¤šè·¯å¤ç”¨"></a>select å¤šè·¯å¤ç”¨</h3><blockquote>
<p>å°æç¤ºï¼šå¤šè·¯å¤ç”¨å¯ä»¥ç®€å•åœ°ç†è§£ä¸ºï¼ŒN ä¸ª channel ä¸­ï¼Œä»»æ„ä¸€ä¸ª channel æœ‰æ•°æ®äº§ç”Ÿï¼Œselect éƒ½å¯ä»¥ç›‘å¬åˆ°ï¼Œç„¶åæ‰§è¡Œç›¸åº”çš„åˆ†æ”¯ï¼Œæ¥æ”¶æ•°æ®å¹¶å¤„ç†ã€‚</p>
</blockquote>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> {</span><br><span class="line">   <span class="keyword">case</span> i1 = &lt;-c1:</span><br><span class="line">     <span class="comment">//todo</span></span><br><span class="line">   <span class="keyword">case</span> c2 &lt;- i2:</span><br><span class="line">     <span class="comment">//todo</span></span><br><span class="line">   <span class="keyword">default</span>:</span><br><span class="line">     <span class="comment">// default todo</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h2 id="sync-åŒ…"><a href="#sync-åŒ…" class="headerlink" title="sync åŒ…"></a>sync åŒ…</h2><blockquote>
<p>å°æŠ€å·§ï¼šä½¿ç”¨ go buildã€go runã€go test è¿™äº› Go è¯­è¨€å·¥å…·é“¾æä¾›çš„å‘½ä»¤æ—¶ï¼Œæ·»åŠ  <code>-race</code> æ ‡è¯†å¯ä»¥å¸®ä½ æ£€æŸ¥ Go è¯­è¨€ä»£ç æ˜¯å¦å­˜åœ¨èµ„æºç«äº‰ã€‚</p>
</blockquote>
<h3 id="sync-Mutex"><a href="#sync-Mutex" class="headerlink" title="sync.Mutex"></a><strong>sync.Mutex</strong></h3><p>äº’æ–¥é”ï¼Œé¡¾åæ€ä¹‰ï¼ŒæŒ‡çš„æ˜¯åœ¨åŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªåç¨‹æ‰§è¡ŒæŸæ®µä»£ç ï¼Œå…¶ä»–åç¨‹éƒ½è¦ç­‰å¾…è¯¥åç¨‹æ‰§è¡Œå®Œæ¯•åæ‰èƒ½ç»§ç»­æ‰§è¡Œã€‚</p>
<p>Mutex çš„ <code>Lock</code> å’Œ <code>Unlock</code> æ–¹æ³•æ€»æ˜¯æˆå¯¹å‡ºç°ï¼Œè€Œä¸”è¦ç¡®ä¿ Lock è·å¾—é”åï¼Œä¸€å®šæ‰§è¡Œ UnLock é‡Šæ”¾é”</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span>(</span><br><span class="line">   sum <span class="type">int</span></span><br><span class="line">   mutex sync.Mutex</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">add</span><span class="params">(i <span class="type">int</span>)</span></span> {</span><br><span class="line">   mutex.Lock()</span><br><span class="line">   sum += i</span><br><span class="line">   mutex.Unlock()</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<p>å°æç¤ºï¼šä»¥ä¸Šè¢«åŠ é”ä¿æŠ¤çš„ sum+=i ä»£ç ç‰‡æ®µåˆç§°ä¸º<strong>ä¸´ç•ŒåŒº</strong>ã€‚åœ¨åŒæ­¥çš„ç¨‹åºè®¾è®¡ä¸­ï¼Œä¸´ç•ŒåŒºæ®µæŒ‡çš„æ˜¯ä¸€ä¸ªè®¿é—®å…±äº«èµ„æºçš„ç¨‹åºç‰‡æ®µï¼Œè€Œè¿™äº›å…±äº«èµ„æºåˆæœ‰æ— æ³•åŒæ—¶è¢«å¤šä¸ªåç¨‹è®¿é—®çš„ç‰¹æ€§ã€‚</p>
</blockquote>
<h3 id="sync-RWMutex"><a href="#sync-RWMutex" class="headerlink" title="sync.RWMutex"></a>sync.RWMutex</h3><p>goä¸­çš„è¯»å†™é”ã€‚ä½¿ç”¨ï¼š</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> mutex sync.RWMutex</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">readSum</span><span class="params">()</span></span> <span class="type">int</span> {</span><br><span class="line"></span><br><span class="line">   <span class="comment">//åªè·å–è¯»é”</span></span><br><span class="line">   mutex.RLock()</span><br><span class="line">   <span class="keyword">defer</span> mutex.RUnlock()</span><br><span class="line">   b:=sum</span><br><span class="line"></span><br><span class="line">   <span class="keyword">return</span> b</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h3 id="sync-WaitGroup"><a href="#sync-WaitGroup" class="headerlink" title="sync.WaitGroup"></a>sync.WaitGroup</h3><p>ç›¸å½“äºJavaä¸­çš„***<code>CountDownLatch</code>***ï¼Œç”¨äºæœ€ç»ˆå®Œæˆçš„åœºæ™¯ï¼Œå…³é”®ç‚¹åœ¨äºä¸€å®šè¦ç­‰å¾…æ‰€æœ‰åç¨‹éƒ½æ‰§è¡Œå®Œæ¯•ã€‚</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">run</span><span class="params">()</span></span>{</span><br><span class="line"></span><br><span class="line">   <span class="keyword">var</span> wg sync.WaitGroup</span><br><span class="line"></span><br><span class="line">   <span class="comment">//å› ä¸ºè¦ç›‘æ§110ä¸ªåç¨‹ï¼Œæ‰€ä»¥è®¾ç½®è®¡æ•°å™¨ä¸º110</span></span><br><span class="line">   wg.Add(<span class="number">110</span>)</span><br><span class="line">   <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">100</span>; i++ {</span><br><span class="line">      <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> {</span><br><span class="line">         <span class="comment">//è®¡æ•°å™¨å€¼å‡1</span></span><br><span class="line">         <span class="keyword">defer</span> wg.Done()</span><br><span class="line">         add(<span class="number">10</span>)</span><br><span class="line">      }()</span><br><span class="line">   }</span><br><span class="line"></span><br><span class="line">   <span class="keyword">for</span> i:=<span class="number">0</span>; i&lt;<span class="number">10</span>;i++ {</span><br><span class="line">      <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> {</span><br><span class="line">         <span class="comment">//è®¡æ•°å™¨å€¼å‡1</span></span><br><span class="line">         <span class="keyword">defer</span> wg.Done()</span><br><span class="line">         fmt.Println(<span class="string">"å’Œä¸º:"</span>,readSum())</span><br><span class="line">      }()</span><br><span class="line">   }</span><br><span class="line"></span><br><span class="line">   <span class="comment">//ä¸€ç›´ç­‰å¾…ï¼Œç›´åˆ°è®¡æ•°å™¨å€¼ä¸º0</span></span><br><span class="line">   wg.Wait()</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h3 id="sync-Once"><a href="#sync-Once" class="headerlink" title="sync.Once"></a>sync.Once</h3><p>è®©ä»£ç åªæ‰§è¡Œä¸€æ¬¡ï¼Œå“ªæ€•æ˜¯åœ¨é«˜å¹¶å‘çš„æƒ…å†µä¸‹ï¼Œæ¯”å¦‚åˆ›å»ºä¸€ä¸ªå•ä¾‹ã€‚</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">   doOnce()</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">doOnce</span><span class="params">()</span></span> {</span><br><span class="line">   <span class="keyword">var</span> once sync.Once</span><br><span class="line">   onceBody := <span class="function"><span class="keyword">func</span><span class="params">()</span></span> {</span><br><span class="line">      fmt.Println(<span class="string">"Only once"</span>)</span><br><span class="line">   }</span><br><span class="line"></span><br><span class="line">   <span class="comment">//ç”¨äºç­‰å¾…åç¨‹æ‰§è¡Œå®Œæ¯•</span></span><br><span class="line">   done := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">bool</span>)</span><br><span class="line"></span><br><span class="line">   <span class="comment">//å¯åŠ¨10ä¸ªåç¨‹æ‰§è¡Œonce.Do(onceBody)</span></span><br><span class="line">   <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10</span>; i++ {</span><br><span class="line">      <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> {</span><br><span class="line">         <span class="comment">//æŠŠè¦æ‰§è¡Œçš„å‡½æ•°(æ–¹æ³•)ä½œä¸ºå‚æ•°ä¼ ç»™once.Doæ–¹æ³•å³å¯</span></span><br><span class="line">         once.Do(onceBody)</span><br><span class="line">         done &lt;- <span class="literal">true</span></span><br><span class="line">      }()</span><br><span class="line">   }</span><br><span class="line"></span><br><span class="line">   <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10</span>; i++ {</span><br><span class="line">      &lt;-done</span><br><span class="line">   }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h3 id="sync-Cond"><a href="#sync-Cond" class="headerlink" title="sync.Cond"></a>sync.Cond</h3><p>sync.Cond å¯ä»¥ç”¨äºå‘å·æ–½ä»¤ï¼Œä¸€å£°ä»¤ä¸‹æ‰€æœ‰åç¨‹éƒ½å¯ä»¥å¼€å§‹æ‰§è¡Œï¼Œå…³é”®ç‚¹åœ¨äºåç¨‹å¼€å§‹çš„æ—¶å€™æ˜¯ç­‰å¾…çš„ï¼Œè¦ç­‰å¾… sync.Cond å”¤é†’æ‰èƒ½æ‰§è¡Œã€‚</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//10ä¸ªäººèµ›è·‘ï¼Œ1ä¸ªè£åˆ¤å‘å·æ–½ä»¤</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">race</span><span class="params">()</span></span>{</span><br><span class="line"></span><br><span class="line">   cond :=sync.NewCond(&amp;sync.Mutex{})</span><br><span class="line">   <span class="keyword">var</span> wg sync.WaitGroup</span><br><span class="line">   wg.Add(<span class="number">11</span>)</span><br><span class="line"></span><br><span class="line">   <span class="keyword">for</span> i:=<span class="number">0</span>;i&lt;<span class="number">10</span>; i++ {</span><br><span class="line">      <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">(num <span class="type">int</span>)</span></span> {</span><br><span class="line">         <span class="keyword">defer</span>  wg.Done()</span><br><span class="line">         fmt.Println(num,<span class="string">"å·å·²ç»å°±ä½"</span>)</span><br><span class="line">         cond.L.Lock()</span><br><span class="line">         cond.Wait()<span class="comment">//ç­‰å¾…å‘ä»¤æªå“</span></span><br><span class="line">         fmt.Println(num,<span class="string">"å·å¼€å§‹è·‘â€¦â€¦"</span>)</span><br><span class="line">         cond.L.Unlock()</span><br><span class="line">      }(i)</span><br><span class="line">   }</span><br><span class="line"></span><br><span class="line">   <span class="comment">//ç­‰å¾…æ‰€æœ‰goroutineéƒ½è¿›å…¥waitçŠ¶æ€</span></span><br><span class="line">   time.Sleep(<span class="number">2</span>*time.Second)</span><br><span class="line"></span><br><span class="line">   <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> {</span><br><span class="line">      <span class="keyword">defer</span>  wg.Done()</span><br><span class="line">      fmt.Println(<span class="string">"è£åˆ¤å·²ç»å°±ä½ï¼Œå‡†å¤‡å‘ä»¤æª"</span>)</span><br><span class="line">      fmt.Println(<span class="string">"æ¯”èµ›å¼€å§‹ï¼Œå¤§å®¶å‡†å¤‡è·‘"</span>)</span><br><span class="line">      cond.Broadcast()<span class="comment">//å‘ä»¤æªå“</span></span><br><span class="line">   }()</span><br><span class="line">   <span class="comment">//é˜²æ­¢å‡½æ•°æå‰è¿”å›é€€å‡º</span></span><br><span class="line">   wg.Wait()</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<ol>
<li><strong>Wait</strong>ï¼Œé˜»å¡å½“å‰åç¨‹ï¼Œç›´åˆ°è¢«å…¶ä»–åç¨‹è°ƒç”¨ Broadcast æˆ–è€… Signal æ–¹æ³•å”¤é†’ï¼Œä½¿ç”¨çš„æ—¶å€™éœ€è¦åŠ é”ï¼Œä½¿ç”¨ sync.Cond ä¸­çš„é”å³å¯ï¼Œä¹Ÿå°±æ˜¯ L å­—æ®µã€‚</li>
<li><strong>Signal</strong>ï¼Œå”¤é†’ä¸€ä¸ªç­‰å¾…æ—¶é—´æœ€é•¿çš„åç¨‹ã€‚</li>
<li><strong>Broadcast</strong>ï¼Œå”¤é†’æ‰€æœ‰ç­‰å¾…çš„åç¨‹ã€‚</li>
</ol>
<blockquote>
<p>æ³¨æ„ï¼šåœ¨è°ƒç”¨ Signal æˆ–è€… Broadcast ä¹‹å‰ï¼Œè¦ç¡®ä¿ç›®æ ‡åç¨‹å¤„äº Wait é˜»å¡çŠ¶æ€ï¼Œä¸ç„¶ä¼šå‡ºç°æ­»é”é—®é¢˜ã€‚</p>
</blockquote>
<p>å¦‚æœä½ ä»¥å‰å­¦è¿‡ Javaï¼Œä¼šå‘ç° sync.Cond å’Œ Java çš„ç­‰å¾…å”¤é†’æœºåˆ¶å¾ˆåƒï¼Œå®ƒçš„ä¸‰ä¸ªæ–¹æ³• Waitã€Signalã€Broadcast å°±åˆ†åˆ«å¯¹åº” Java ä¸­çš„ waitã€notifyã€notifyAllã€‚</p>
<h2 id="Context"><a href="#Context" class="headerlink" title="Context"></a>Context</h2><blockquote>
<p>ä¸€ä¸ªä»»åŠ¡ä¼šæœ‰å¾ˆå¤šä¸ªåç¨‹åä½œå®Œæˆï¼Œä¸€æ¬¡ HTTP è¯·æ±‚ä¹Ÿä¼šè§¦å‘å¾ˆå¤šä¸ªåç¨‹çš„å¯åŠ¨ï¼Œè€Œè¿™äº›åç¨‹æœ‰å¯èƒ½ä¼šå¯åŠ¨æ›´å¤šçš„å­åç¨‹ï¼Œå¹¶ä¸”æ— æ³•é¢„çŸ¥æœ‰å¤šå°‘å±‚åç¨‹ã€æ¯ä¸€å±‚æœ‰å¤šå°‘ä¸ªåç¨‹ã€‚</p>
<p>å¦‚æœå› ä¸ºæŸäº›åŸå› å¯¼è‡´ä»»åŠ¡ç»ˆæ­¢äº†ï¼ŒHTTP è¯·æ±‚å–æ¶ˆäº†ï¼Œé‚£ä¹ˆå®ƒä»¬å¯åŠ¨çš„åç¨‹æ€ä¹ˆåŠï¼Ÿè¯¥å¦‚ä½•å–æ¶ˆå‘¢ï¼Ÿå› ä¸ºå–æ¶ˆè¿™äº›åç¨‹å¯ä»¥èŠ‚çº¦å†…å­˜ï¼Œæå‡æ€§èƒ½ï¼ŒåŒæ—¶é¿å…ä¸å¯é¢„æ–™çš„ Bugã€‚</p>
<p>Context å°±æ˜¯ç”¨æ¥ç®€åŒ–è§£å†³è¿™äº›é—®é¢˜çš„ï¼Œå¹¶ä¸”æ˜¯å¹¶å‘å®‰å…¨çš„ã€‚Context æ˜¯ä¸€ä¸ªæ¥å£ï¼Œå®ƒå…·å¤‡æ‰‹åŠ¨ã€å®šæ—¶ã€è¶…æ—¶å‘å‡ºå–æ¶ˆä¿¡å·ã€ä¼ å€¼ç­‰åŠŸèƒ½ï¼Œä¸»è¦ç”¨äºæ§åˆ¶å¤šä¸ªåç¨‹ä¹‹é—´çš„åä½œï¼Œå°¤å…¶æ˜¯å–æ¶ˆæ“ä½œã€‚ä¸€æ—¦å–æ¶ˆæŒ‡ä»¤ä¸‹è¾¾ï¼Œé‚£ä¹ˆè¢« Context è·Ÿè¸ªçš„è¿™äº›åç¨‹éƒ½ä¼šæ”¶åˆ°å–æ¶ˆä¿¡å·ï¼Œå°±å¯ä»¥åšæ¸…ç†å’Œé€€å‡ºæ“ä½œã€‚</p>
</blockquote>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Context <span class="keyword">interface</span> {</span><br><span class="line"></span><br><span class="line">   Deadline() (deadline time.Time, ok <span class="type">bool</span>)</span><br><span class="line">   Done() &lt;-<span class="keyword">chan</span> <span class="keyword">struct</span>{}</span><br><span class="line">   Err() <span class="type">error</span></span><br><span class="line">   Value(key <span class="keyword">interface</span>{}) <span class="keyword">interface</span>{}</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h3 id="Context-æ ‘"><a href="#Context-æ ‘" class="headerlink" title="Context æ ‘"></a>Context æ ‘</h3><p>Go è¯­è¨€æä¾›äº†å‡½æ•°å¯ä»¥å¸®åŠ©æˆ‘ä»¬ç”Ÿæˆä¸åŒçš„ Contextï¼Œé€šè¿‡è¿™äº›å‡½æ•°å¯ä»¥ç”Ÿæˆä¸€é¢— Context æ ‘ï¼Œè¿™æ · Context æ‰å¯ä»¥å…³è”èµ·æ¥ï¼Œçˆ¶ Context å‘å‡ºå–æ¶ˆä¿¡å·çš„æ—¶å€™ï¼Œå­ Context ä¹Ÿä¼šå‘å‡ºï¼Œè¿™æ ·å°±å¯ä»¥æ§åˆ¶ä¸åŒå±‚çº§çš„åç¨‹é€€å‡ºã€‚</p>
<p>ä»ä½¿ç”¨åŠŸèƒ½ä¸Šåˆ†ï¼Œæœ‰å››ç§å®ç°å¥½çš„ Contextã€‚</p>
<ol>
<li><strong>ç©º Context</strong>ï¼šä¸å¯å–æ¶ˆï¼Œæ²¡æœ‰æˆªæ­¢æ—¶é—´ï¼Œä¸»è¦ç”¨äº Context æ ‘çš„æ ¹èŠ‚ç‚¹ã€‚</li>
<li><strong>å¯å–æ¶ˆçš„ Context</strong>ï¼šç”¨äºå‘å‡ºå–æ¶ˆä¿¡å·ï¼Œå½“å–æ¶ˆçš„æ—¶å€™ï¼Œå®ƒçš„å­ Context ä¹Ÿä¼šå–æ¶ˆã€‚</li>
<li><strong>å¯å®šæ—¶å–æ¶ˆçš„ Context</strong>ï¼šå¤šäº†ä¸€ä¸ªå®šæ—¶çš„åŠŸèƒ½ã€‚</li>
<li><strong>å€¼ Context</strong>ï¼šç”¨äºå­˜å‚¨ä¸€ä¸ª key-value é”®å€¼å¯¹ã€‚</li>
</ol>
<p><img src="/../images/Go%E8%AF%AD%E8%A8%80%E5%9F%BA%E7%A1%80/CgqCHl_EyHOARbBqAAKzKmhclWo807_j9j7DgBnzy.png"></p>
<p><code> context.Background()</code>è·å–ä¸€ä¸ªæ ¹èŠ‚ç‚¹ Contextã€‚</p>
<hr>
<p> Context æ ‘è¦æ€ä¹ˆç”Ÿæˆå‘¢ï¼Ÿ</p>
<ol>
<li>**<code>WithCancel(parent Context)</code>**ï¼šç”Ÿæˆä¸€ä¸ªå¯å–æ¶ˆçš„ Contextã€‚<ol>
<li>**<code>WithDeadline(parent Context, d time.Time)</code>**ï¼šç”Ÿæˆä¸€ä¸ªå¯å®šæ—¶å–æ¶ˆçš„ Contextï¼Œå‚æ•° d ä¸ºå®šæ—¶å–æ¶ˆçš„å…·ä½“æ—¶é—´ã€‚<ol>
<li>**<code>WithTimeout(parent Context, timeout time.Duration)</code>**ï¼šç”Ÿæˆä¸€ä¸ªå¯è¶…æ—¶å–æ¶ˆçš„ Contextï¼Œå‚æ•° timeout ç”¨äºè®¾ç½®å¤šä¹…åå–æ¶ˆ</li>
</ol>
</li>
</ol>
</li>
<li>**<code>WithValue(parent Context, key, val interface{})</code>**ï¼šç”Ÿæˆä¸€ä¸ªå¯æºå¸¦ key-value é”®å€¼å¯¹çš„ Contextã€‚</li>
</ol>
<p>ä»¥ä¸Šå››ä¸ªç”Ÿæˆ Context çš„å‡½æ•°ä¸­ï¼Œå‰ä¸‰ä¸ªéƒ½å±äºå¯å–æ¶ˆçš„ Contextï¼Œå®ƒä»¬æ˜¯ä¸€ç±»å‡½æ•°ï¼Œæœ€åä¸€ä¸ªæ˜¯å€¼ Contextï¼Œç”¨äºå­˜å‚¨ä¸€ä¸ª key-value é”®å€¼å¯¹ã€‚</p>
<h1 id="æŒ‡é’ˆ"><a href="#æŒ‡é’ˆ" class="headerlink" title="æŒ‡é’ˆ"></a>æŒ‡é’ˆ</h1><figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">    name:=<span class="string">"xiaoming"</span></span><br><span class="line">    <span class="keyword">var</span> nameP *<span class="type">string</span> = &amp;name</span><br><span class="line">    fmt.Println(*nameP)</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<ul>
<li><p>è·å–ä¸€ä¸ªå˜é‡çš„æŒ‡é’ˆéå¸¸å®¹æ˜“ï¼Œä½¿ç”¨å–åœ°å€ç¬¦ &amp; å°±å¯ä»¥</p>
</li>
<li><p>æŒ‡é’ˆç±»å‹å°±æ˜¯åœ¨å¯¹åº”çš„ç±»å‹å‰åŠ  * å·</p>
</li>
<li><p>æŒ‡é’ˆç±»å‹éå¸¸å»‰ä»·ï¼Œåªå ç”¨ 4 ä¸ªæˆ–è€… 8 ä¸ªå­—èŠ‚çš„å†…å­˜å¤§å°ã€‚</p>
</li>
<li><p><em><strong>é€šè¿‡ var å£°æ˜çš„æŒ‡é’ˆå˜é‡è¿˜æ²¡æœ‰åˆ†é…å†…å­˜</strong></em>ï¼Œå› ä¸ºè¿™æ—¶å€™å®ƒä»…ä»…æ˜¯ä¸ªå˜é‡ï¼Œæ˜¯ä¸èƒ½ç›´æ¥èµ‹å€¼å’Œå–å€¼çš„ï¼Œå®ƒçš„å€¼æ˜¯ nil </p>
<p><img src="/../images/Go%E8%AF%AD%E8%A8%80%E5%9F%BA%E7%A1%80/image_xouftL6NE6.png" alt="ç›´æ¥èµ‹å€¼å’Œå–å€¼" title="ç›´æ¥èµ‹å€¼å’Œå–å€¼"></p>
<p>è§£å†³æ–¹æ³•ï¼šå°†ä¸€å—å†…å­˜åœ°å€<code>&amp;m</code>èµ‹å€¼ç»™æŒ‡é’ˆå˜é‡<code>*p</code></p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> p *<span class="type">int</span></span><br><span class="line"><span class="keyword">var</span> m <span class="type">int</span></span><br><span class="line">p = &amp;m</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>é€šè¿‡newåˆ›å»ºçš„æŒ‡é’ˆæ˜¯å­˜åœ¨å†…å­˜åœ°å€çš„ï¼Œå¯ä»¥ç›´æ¥èµ‹å€¼</p>
<ul>
<li><code>var intP *int = new(int)</code></li>
</ul>
</li>
</ul>
<h1 id="å‚æ•°ä¼ é€’"><a href="#å‚æ•°ä¼ é€’" class="headerlink" title="å‚æ•°ä¼ é€’"></a>å‚æ•°ä¼ é€’</h1><p><strong>ä¸¥æ ¼æ¥è¯´ï¼ŒGo è¯­è¨€æ²¡æœ‰å¼•ç”¨ç±»å‹</strong>ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥æŠŠ mapã€chan ç§°ä¸ºå¼•ç”¨ç±»å‹ï¼Œè¿™æ ·ä¾¿äºç†è§£ã€‚é™¤äº† mapã€chan ä¹‹å¤–ï¼ŒGo è¯­è¨€ä¸­çš„å‡½æ•°ã€æ¥å£ã€slice åˆ‡ç‰‡ã€æŒ‡é’ˆéƒ½å¯ä»¥ç§°ä¸ºå¼•ç”¨ç±»å‹ã€‚</p>
<p><img src="/../images/Go%E8%AF%AD%E8%A8%80%E5%9F%BA%E7%A1%80/image_B8036E8m0p.png"></p>
<p>æ€»ç»“ï¼š</p>
<p>åœ¨ Go è¯­è¨€ä¸­ï¼Œ<strong>å‡½æ•°çš„å‚æ•°ä¼ é€’åªæœ‰å€¼ä¼ é€’</strong>ï¼Œè€Œä¸”ä¼ é€’çš„å®å‚éƒ½æ˜¯åŸå§‹æ•°æ®çš„ä¸€ä»½æ‹·è´ã€‚</p>
<p>å¦‚æœæ‹·è´çš„å†…å®¹æ˜¯å€¼ç±»å‹çš„ï¼Œé‚£ä¹ˆåœ¨å‡½æ•°ä¸­å°±æ— æ³•ä¿®æ”¹åŸå§‹æ•°æ®ï¼›</p>
<p>å¦‚æœæ‹·è´çš„å†…å®¹æ˜¯æŒ‡é’ˆï¼ˆæˆ–è€…å¯ä»¥ç†è§£ä¸ºå¼•ç”¨ç±»å‹ mapã€chan ç­‰ï¼‰ï¼Œé‚£ä¹ˆå°±å¯ä»¥åœ¨å‡½æ•°ä¸­ä¿®æ”¹åŸå§‹æ•°æ®ã€‚</p>
<h1 id="å†…å­˜åˆ†é…"><a href="#å†…å­˜åˆ†é…" class="headerlink" title="å†…å­˜åˆ†é…"></a>å†…å­˜åˆ†é…</h1><ul>
<li>æŒ‡é’ˆç±»å‹çš„å˜é‡å¦‚æœæ²¡æœ‰åˆ†é…å†…å­˜ï¼Œå°±é»˜è®¤æ˜¯é›¶å€¼ nilï¼Œå®ƒæ²¡æœ‰æŒ‡å‘çš„å†…å­˜ï¼Œæ‰€ä»¥æ— æ³•ä½¿ç”¨ï¼Œå¼ºè¡Œä½¿ç”¨å°±ä¼šå¾—åˆ°ä»¥ä¸Š nil æŒ‡é’ˆé”™è¯¯</li>
<li>å¯¹äºå€¼ç±»å‹æ¥è¯´ï¼Œå³ä½¿åªå£°æ˜ä¸€ä¸ªå˜é‡ï¼Œæ²¡æœ‰å¯¹å…¶åˆå§‹åŒ–ï¼Œè¯¥å˜é‡ä¹Ÿä¼šæœ‰åˆ†é…å¥½çš„å†…å­˜ã€‚</li>
<li>ä¸¤ä¸ªå…³é”®å‡½æ•°ï¼šnewå’Œmake</li>
</ul>
<h2 id="new"><a href="#new" class="headerlink" title="new"></a>new</h2><p>new å‡½æ•°åªç”¨äºåˆ†é…å†…å­˜ï¼Œå¹¶ä¸”æŠŠå†…å­˜æ¸…é›¶ï¼Œä¹Ÿå°±æ˜¯è¿”å›ä¸€ä¸ªæŒ‡å‘å¯¹åº”ç±»å‹é›¶å€¼çš„æŒ‡é’ˆã€‚new å‡½æ•°ä¸€èˆ¬ç”¨äºéœ€è¦æ˜¾å¼åœ°è¿”å›æŒ‡é’ˆçš„æƒ…å†µï¼Œä¸æ˜¯å¤ªå¸¸ç”¨ã€‚</p>
<h2 id="make"><a href="#make" class="headerlink" title="make"></a>make</h2><p>make å‡½æ•°åªç”¨äº sliceã€chan å’Œ map è¿™ä¸‰ç§å†…ç½®ç±»å‹çš„åˆ›å»ºå’Œåˆå§‹åŒ–ï¼Œå› ä¸ºè¿™ä¸‰ç§ç±»å‹çš„ç»“æ„æ¯”è¾ƒå¤æ‚ï¼Œæ¯”å¦‚ slice è¦æå‰åˆå§‹åŒ–å¥½å†…éƒ¨å…ƒç´ çš„ç±»å‹ï¼Œslice çš„é•¿åº¦å’Œå®¹é‡ç­‰ï¼Œè¿™æ ·æ‰å¯ä»¥æ›´å¥½åœ°ä½¿ç”¨å®ƒä»¬ã€‚</p>
<h1 id="åå°„"><a href="#åå°„" class="headerlink" title="åå°„"></a>åå°„</h1><ul>
<li><p><strong><code>reflect.Value</code></strong> å’Œ**<code>reflect.Type</code>**</p>
<p>åœ¨ Go è¯­è¨€çš„åå°„å®šä¹‰ä¸­ï¼Œä»»ä½•æ¥å£éƒ½ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼šæ¥å£çš„å…·ä½“ç±»å‹ï¼Œä»¥åŠå…·ä½“ç±»å‹å¯¹åº”çš„å€¼ã€‚æ¯”å¦‚ var i int = 3ï¼Œå› ä¸º <code>interface{}</code> å¯ä»¥è¡¨ç¤ºä»»ä½•ç±»å‹ï¼Œæ‰€ä»¥å˜é‡ i å¯ä»¥è½¬ä¸º interface{}ã€‚å…¶ä¸­ Value ä¸ºå˜é‡çš„å€¼ï¼Œå³ 3ï¼Œè€Œ Type ä¸ºå˜é‡çš„ç±»å‹ï¼Œå³ intã€‚</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">i:=<span class="number">3</span></span><br><span class="line">iv:=reflect.ValueOf(i)</span><br><span class="line">it:=reflect.TypeOf(i)</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>ä¿®æ”¹å˜é‡</p>
<p>è¦ä¿®æ”¹ä¸€ä¸ªå˜é‡çš„å€¼ï¼Œæœ‰å‡ ä¸ªå…³é”®ç‚¹ï¼šä¼ é€’æŒ‡é’ˆï¼ˆå¯å¯»å€ï¼‰ï¼Œé€šè¿‡ Elem æ–¹æ³•è·å–æŒ‡å‘çš„å€¼ï¼Œæ‰å¯ä»¥ä¿è¯å€¼å¯ä»¥è¢«ä¿®æ”¹ï¼Œreflect.Value ä¸ºæˆ‘ä»¬æä¾›äº† CanSet æ–¹æ³•åˆ¤æ–­æ˜¯å¦å¯ä»¥ä¿®æ”¹è¯¥å˜é‡ã€‚</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ipv := reflect.ValueOf(&amp;i)</span><br><span class="line">ipv.Elem().SetInt(<span class="number">4</span>)</span><br><span class="line">fmt.Println(i)</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>åå°„çš„ä¸‰å¤§å®šå¾‹</p>
<ol>
<li>ä»»ä½•æ¥å£å€¼ <code>interface{}</code> éƒ½å¯ä»¥åå°„å‡ºåå°„å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯ reflect.Value å’Œ reflect.Typeï¼Œé€šè¿‡å‡½æ•° reflect.ValueOf å’Œ reflect.TypeOf è·å¾—ã€‚</li>
<li>åå°„å¯¹è±¡ä¹Ÿå¯ä»¥è¿˜åŸä¸º interface{} å˜é‡ï¼Œä¹Ÿå°±æ˜¯ç¬¬ 1 æ¡å®šå¾‹çš„å¯é€†æ€§ï¼Œé€šè¿‡ reflect.Value ç»“æ„ä½“çš„ Interface æ–¹æ³•è·å¾—ã€‚</li>
<li>è¦ä¿®æ”¹åå°„çš„å¯¹è±¡ï¼Œè¯¥å€¼å¿…é¡»å¯è®¾ç½®ï¼Œä¹Ÿå°±æ˜¯å¯å¯»å€ï¼Œå‚è€ƒä¸ŠèŠ‚è¯¾ä¿®æ”¹å˜é‡çš„å€¼é‚£ä¸€èŠ‚çš„å†…å®¹ç†è§£ã€‚</li>
</ol>
</li>
</ul>
<h1 id="SliceHeader"><a href="#SliceHeader" class="headerlink" title="SliceHeader"></a>SliceHeader</h1><ul>
<li><p>åœ¨ Go è¯­è¨€ä¸­ï¼Œåˆ‡ç‰‡å…¶å®æ˜¯ä¸€ä¸ªç»“æ„ä½“ï¼Œå®šä¹‰å¦‚ä¸‹ï¼š</p>
<p><img src="/../images/Go%E8%AF%AD%E8%A8%80%E5%9F%BA%E7%A1%80/image_GCPR--tEED.png"></p>
<p>SliceHeader æ˜¯åˆ‡ç‰‡åœ¨è¿è¡Œæ—¶çš„è¡¨ç°å½¢å¼ï¼Œå®ƒæœ‰ä¸‰ä¸ªå­—æ®µ Dataã€Len å’Œ Capã€‚</p>
<ol>
<li>Data ç”¨æ¥æŒ‡å‘å­˜å‚¨åˆ‡ç‰‡å…ƒç´ çš„æ•°ç»„ã€‚</li>
<li>Len ä»£è¡¨åˆ‡ç‰‡çš„é•¿åº¦ã€‚</li>
<li>Cap ä»£è¡¨åˆ‡ç‰‡çš„å®¹é‡ã€‚</li>
</ol>
</li>
<li><p>ä¼˜ç‚¹</p>
<ol>
<li>æ”¯æŒåŠ¨æ€æ‰©å®¹</li>
<li>åˆ‡ç‰‡çš„æœ¬è´¨æ˜¯ SliceHeaderï¼Œåˆå› ä¸ºå‡½æ•°çš„å‚æ•°æ˜¯å€¼ä¼ é€’ï¼Œæ‰€ä»¥ä¼ é€’çš„æ˜¯ SliceHeader çš„å‰¯æœ¬ï¼Œè€Œä¸æ˜¯åº•å±‚æ•°ç»„çš„å‰¯æœ¬ã€‚è¿™æ—¶å€™åˆ‡ç‰‡çš„ä¼˜åŠ¿å°±ä½“ç°å‡ºæ¥äº†ï¼Œå› ä¸º SliceHeader çš„å‰¯æœ¬å†…å­˜å ç”¨éå¸¸å°‘ï¼Œå³ä½¿æ˜¯ä¸€ä¸ªéå¸¸å¤§çš„åˆ‡ç‰‡ï¼Œä¹Ÿé¡¶å¤šå ç”¨ 24 ä¸ªå­—èŠ‚çš„å†…å­˜ï¼Œè¿™å°±è§£å†³äº†å¤§æ•°ç»„åœ¨ä¼ å‚æ—¶å†…å­˜æµªè´¹çš„é—®é¢˜ã€‚</li>
</ol>
</li>
</ul>
<h1 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h1><ul>
<li>æµ‹è¯•æ–‡ä»¶ä»¥_test.goç»“å°¾</li>
<li>æµ‹è¯•å‡½æ•°ä»¥Testxxxï¼ˆxxxä¸ºæµ‹è¯•å‡½æ•°åï¼‰å¼€å¤´</li>
</ul>
<p>å‡è®¾ç¼–å†™çš„å‡½æ•°åœ¨<em>ch18/main.go</em>ä¸­ï¼š<code>go test -v ./ch18</code></p>
<hr>
<ul>
<li>go test -v â€“coverprofile=ch18.cover ./ch18ï¼šå¾—åˆ°ä¸€ä¸ªå•å…ƒæµ‹è¯•è¦†ç›–ç‡æ–‡ä»¶</li>
</ul>
<h2 id="åŸºå‡†æµ‹è¯•"><a href="#åŸºå‡†æµ‹è¯•" class="headerlink" title="åŸºå‡†æµ‹è¯•"></a>åŸºå‡†æµ‹è¯•</h2><p>è¡¡é‡ä»£ç çš„æ€§èƒ½</p>
<ul>
<li><p>å‡½æ•°å¿…é¡»ä»¥ Benchmark å¼€å¤´</p>
</li>
<li><p>å‡½æ•°çš„ç­¾åå¿…é¡»æ¥æ”¶ä¸€ä¸ªæŒ‡å‘ testing.B ç±»å‹çš„æŒ‡é’ˆï¼Œå¹¶ä¸”ä¸èƒ½è¿”å›ä»»ä½•å€¼ï¼›</p>
</li>
<li><p>æœ€åçš„ for å¾ªç¯å¾ˆé‡è¦ï¼Œè¢«æµ‹è¯•çš„ä»£ç è¦æ”¾åˆ°å¾ªç¯é‡Œï¼›</p>
</li>
<li><p>b.N æ˜¯åŸºå‡†æµ‹è¯•æ¡†æ¶æä¾›çš„ï¼Œè¡¨ç¤ºå¾ªç¯çš„æ¬¡æ•°ï¼Œå› ä¸ºéœ€è¦åå¤è°ƒç”¨æµ‹è¯•çš„ä»£ç ï¼Œæ‰å¯ä»¥è¯„ä¼°æ€§èƒ½ã€‚</p>
</li>
<li><p>è¿è¡Œï¼š<code>go test -bench=. ./ch18</code></p>
<p><img src="/../images/Go%E8%AF%AD%E8%A8%80%E5%9F%BA%E7%A1%80/image_TRt00J58vX.png"></p>
</li>
<li><p>è®¡æ—¶æ–¹æ³•</p>
<p><img src="/../images/Go%E8%AF%AD%E8%A8%80%E5%9F%BA%E7%A1%80/image_3wVKmmQ8bg.png"></p>
</li>
<li><p>å†…å­˜ç»Ÿè®¡</p>
<p><img src="/../images/Go%E8%AF%AD%E8%A8%80%E5%9F%BA%E7%A1%80/image_MfFsm1QCxq.png"></p>
</li>
<li><p>å¹¶å‘åŸºå‡†æµ‹è¯•</p>
<p><img src="/../images/Go%E8%AF%AD%E8%A8%80%E5%9F%BA%E7%A1%80/image_MgQUA96T3S.png"></p>
</li>
</ul>
<h1 id="æ³›å‹"><a href="#æ³›å‹" class="headerlink" title="æ³›å‹"></a>æ³›å‹</h1><p>Goçš„æ³›å‹ä½¿ç”¨<code>interface</code>å®ç°</p>
<ul>
<li>an approximation element <code>~T</code> restricts to all types whose underlying type is T: ä»£è¡¨åº•å±‚ç±»å‹æ˜¯<code>T</code></li>
<li>a union element <code>T1 | T2 | ...</code> restricts to any of the listed elements: ä»£è¡¨<code>æˆ–</code>,ç±»å‹åˆ—è¡¨ä¹‹ä¸€ã€‚</li>
</ul>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä»»æ„ç±»å‹ any</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">f</span>[<span class="title">T1</span>, <span class="title">T2</span> <span class="title">any</span>]<span class="params">(x <span class="type">int</span>, y T1)</span></span> T2 {</span><br><span class="line">    ...</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Integer <span class="keyword">interface</span> {</span><br><span class="line">  Signed | Unsigned</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Signed <span class="keyword">interface</span> {</span><br><span class="line">  ~<span class="type">int</span> | ~<span class="type">int8</span> | ~<span class="type">int16</span> | ~<span class="type">int32</span> | ~<span class="type">int64</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Unsigned <span class="keyword">interface</span> {</span><br><span class="line">  ~<span class="type">uint</span> | ~<span class="type">uint8</span> | ~<span class="type">uint16</span> | ~<span class="type">uint32</span> | ~<span class="type">uint64</span> | ~<span class="type">uintptr</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ³›å‹æŠ½è±¡</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Abs</span>[<span class="title">T</span> <span class="title">Integer</span>]<span class="params">(input T)</span></span> T {</span><br><span class="line">  <span class="keyword">if</span> input &lt; <span class="number">0</span> {</span><br><span class="line">    <span class="keyword">return</span> -input</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">return</span> input</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

        </div>

        
            <section class="post-copyright">
                
                    <p class="copyright-item">
                        <span>Author:</span>
                        <span>qing-wq</span>
                    </p>
                
                
                    <p class="copyright-item">
                        <span>Permalink:</span>
                        <span><a href="https://qing-wq.github.io/2023/09/01/Go%E8%AF%AD%E8%A8%80%E5%9F%BA%E7%A1%80/">https://qing-wq.github.io/2023/09/01/Go%E8%AF%AD%E8%A8%80%E5%9F%BA%E7%A1%80/</a></span>
                    </p>
                
                
                    <p class="copyright-item">
                        <span>License:</span>
                        <span>Copyright (c) 2019 <a target="_blank" rel="noopener" href="http://creativecommons.org/licenses/by-nc/4.0/">CC-BY-NC-4.0</a> LICENSE</span>
                    </p>
                
                

            </section>
        
        <section class="post-tags">
            <div>
                <span>Tag(s):</span>
                <span class="tag">
                    
                    
                        <a href="/tags/golang/"># golang</a>
                    
                        
                </span>
            </div>
            <div>
                <a href="javascript:window.history.back();">back</a>
                <span>Â· </span>
                <a href="/">home</a>
            </div>
        </section>
        <section class="post-nav">
            
                <a class="prev" rel="prev" href="/2023/09/03/JUC%E5%9F%BA%E7%A1%80/">JUCåŸºç¡€</a>
            
            
            <a class="next" rel="next" href="/2023/05/14/OAuth2.0%E6%8E%88%E6%9D%83%E7%A0%81%E6%A8%A1%E5%BC%8F%E5%AF%B9%E6%8E%A5%E4%B8%8E%E5%BC%80%E5%8F%91%E8%AE%B0%E5%BD%95/">OAuth2.0æˆæƒç æ¨¡å¼å¯¹æ¥ä¸å¼€å‘è®°å½•</a>
            
        </section>


    </article>
</div>

            </div>
            <footer id="footer" class="footer">
    <div class="copyright">
        <span>Â© qing-wq | Powered by <a href="https://hexo.io" target="_blank">Hexo</a> & <a href="https://github.com/Siricee/hexo-theme-Chic" target="_blank">Chic</a></span>
    </div>
</footer>

    </div>
</body>

</html>