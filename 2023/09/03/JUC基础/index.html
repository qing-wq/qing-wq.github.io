<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
<meta name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">

    <meta name="author" content="qing-wq">



    <meta name="description" content="Qing's Blog">



<title>JUCåŸºç¡€ | Qing&#39;s Blog</title>



    <link rel="icon" href="/favicon.ico">




    <!-- stylesheets list from _config.yml -->
    
    <link rel="stylesheet" href="/css/style.css">
    



    <!-- scripts list from _config.yml -->
    
    <script src="/js/script.js"></script>
    
    <script src="/js/tocbot.min.js"></script>
    



    
    
        
    


<meta name="generator" content="Hexo 7.3.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
</head>

<body>
    <script>
        // this function is used to check current theme before page loaded.
        (() => {
            const currentTheme = window.localStorage && window.localStorage.getItem('theme') || '';
            const isDark = currentTheme === 'dark';
            const pagebody = document.getElementsByTagName('body')[0]
            if (isDark) {
                pagebody.classList.add('dark-theme');
                // mobile
                document.getElementById("mobile-toggle-theme").innerText = "Â· Dark"
            } else {
                pagebody.classList.remove('dark-theme');
                // mobile
                document.getElementById("mobile-toggle-theme").innerText = "Â· Light"
            }
        })();
    </script>

    <div class="wrapper">
        <header>
    <nav class="navbar">
        <div class="container">
            <div class="navbar-header header-logo"><a href="/">Qing&#39;s Blog</a></div>
            <div class="menu navbar-right">
                
                    <a class="menu-item" href="/archives">Posts</a>
                
                    <a class="menu-item" href="/categories">Categories</a>
                
                    <a class="menu-item" href="/tags">Tags</a>
                
                    <a class="menu-item" href="/about">About</a>
                
                <input id="switch_default" type="checkbox" class="switch_default">
                <label for="switch_default" class="toggleBtn"></label>
            </div>
        </div>
    </nav>

    
    <nav class="navbar-mobile" id="nav-mobile">
        <div class="container">
            <div class="navbar-header">
                <div>
                    <a href="/">Qing&#39;s Blog</a><a id="mobile-toggle-theme">Â·&nbsp;Light</a>
                </div>
                <div class="menu-toggle" onclick="mobileBtn()">&#9776; Menu</div>
            </div>
            <div class="menu" id="mobile-menu">
                
                    <a class="menu-item" href="/archives">Posts</a>
                
                    <a class="menu-item" href="/categories">Categories</a>
                
                    <a class="menu-item" href="/tags">Tags</a>
                
                    <a class="menu-item" href="/about">About</a>
                
            </div>
        </div>
    </nav>

</header>
<script>
    var mobileBtn = function f() {
        var toggleMenu = document.getElementsByClassName("menu-toggle")[0];
        var mobileMenu = document.getElementById("mobile-menu");
        if(toggleMenu.classList.contains("active")){
           toggleMenu.classList.remove("active")
            mobileMenu.classList.remove("active")
        }else{
            toggleMenu.classList.add("active")
            mobileMenu.classList.add("active")
        }
    }
</script>
            <div class="main">
                <div class="container">
    
    
        <div class="post-toc">
    <div class="tocbot-list">
    </div>
    <div class="tocbot-list-menu">
        <a class="tocbot-toc-expand" onclick="expand_toc()">Expand all</a>
        <a onclick="go_top()">Back to top</a>
        <a onclick="go_bottom()">Go to bottom</a>
    </div>
</div>

<script>
    var tocbot_timer;
    var DEPTH_MAX = 6; // ä¸º 6 æ—¶å±•å¼€æ‰€æœ‰
    var tocbot_default_config = {
        tocSelector: '.tocbot-list',
        contentSelector: '.post-content',
        headingSelector: 'h1, h2, h3, h4, h5',
        orderedList: false,
        scrollSmooth: true,
        onClick: extend_click,
    };

    function extend_click() {
        clearTimeout(tocbot_timer);
        tocbot_timer = setTimeout(function() {
            tocbot.refresh(obj_merge(tocbot_default_config, {
                hasInnerContainers: true
            }));
        }, 420); // è¿™ä¸ªå€¼æ˜¯ç”± tocbot æºç é‡Œå®šä¹‰çš„ scrollSmoothDuration å¾—æ¥çš„
    }

    document.ready(function() {
        tocbot.init(obj_merge(tocbot_default_config, {
            collapseDepth: 1
        }));
    });

    function expand_toc() {
        var b = document.querySelector('.tocbot-toc-expand');
        var expanded = b.getAttribute('data-expanded');
        expanded ? b.removeAttribute('data-expanded') : b.setAttribute('data-expanded', true);
        tocbot.refresh(obj_merge(tocbot_default_config, {
            collapseDepth: expanded ? 1 : DEPTH_MAX
        }));
        b.innerText = expanded ? 'Expand all' : 'Collapse all';
    }

    function go_top() {
        window.scrollTo(0, 0);
    }

    function go_bottom() {
        window.scrollTo(0, document.body.scrollHeight);
    }

    function obj_merge(target, source) {
        for (var item in source) {
            if (source.hasOwnProperty(item)) {
                target[item] = source[item];
            }
        }
        return target;
    }
</script>
    

    
    <article class="post-wrap">
        <header class="post-header">
            <h1 class="post-title">JUCåŸºç¡€</h1>
            
                <div class="post-meta">
                    
                        ğŸ‘¨â€ğŸ“Author: <a itemprop="author" rel="author" href="/">qing-wq</a>
                    

                    
                        <span class="post-time">
                        ğŸ“…Date: <a href="#">ä¹æœˆ 3, 2023</a>
                        </span>
                    
                    <br/>
                    
                        <span class="post-category">
                            ğŸ“šCategory:
                            
                                <a href="/categories/Java%E5%A4%9A%E7%BA%BF%E7%A8%8B/">Javaå¤šçº¿ç¨‹</a>
                            
                        </span>
                    
                    
                    
                        <span class="post-count">
                            ğŸ“‘Words:
                            <a href="">3.1k</a> 
                        </span>
                    
                    
                        <span class="post-count">
                            â±ï¸Time:
                            <a href="">11min</a> 
                        </span>
                                            
                </div>
            
        </header>

        <div class="post-content">
            <h1 id="åŸºç¡€çŸ¥è¯†"><a href="#åŸºç¡€çŸ¥è¯†" class="headerlink" title="åŸºç¡€çŸ¥è¯†"></a>åŸºç¡€çŸ¥è¯†</h1><h2 id="çº¿ç¨‹çš„çŠ¶æ€"><a href="#çº¿ç¨‹çš„çŠ¶æ€" class="headerlink" title="çº¿ç¨‹çš„çŠ¶æ€"></a>çº¿ç¨‹çš„çŠ¶æ€</h2><p>çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸåˆ†ä¸ºäº”ç§çŠ¶æ€ï¼š</p>
<ul>
<li>æ–°ç”Ÿ <code>NEW</code></li>
<li>è¿è¡Œ <code>RUNNABLE</code></li>
<li>é˜»å¡ <code>BLOCKED</code></li>
<li>ç­‰å¾… <code>WAITING</code></li>
<li>è¶…æ—¶ç­‰å¾…<code>TIME_WAITING</code></li>
<li>ç»ˆæ­¢ <code>TERMINATED</code></li>
</ul>
<p>åœ¨æ“ä½œç³»ç»Ÿå±‚é¢ï¼Œçº¿ç¨‹æœ‰ READY å’Œ RUNNING çŠ¶æ€ï¼›è€Œåœ¨ JVM å±‚é¢ï¼Œåªèƒ½çœ‹åˆ° RUNNABLE çŠ¶æ€</p>
<span id="more"></span>

<p><strong>ä¸ºä»€ä¹ˆ JVM æ²¡æœ‰åŒºåˆ†è¿™ä¸¤ç§çŠ¶æ€å‘¢ï¼Ÿ</strong> </p>
<p> ç°åœ¨çš„æ—¶åˆ†å¤šä»»åŠ¡æ“ä½œç³»ç»Ÿæ¶æ„é€šå¸¸éƒ½æ˜¯ç”¨æ‰€è°“çš„â€œæ—¶é—´åˆ†ç‰‡â€æ–¹å¼è¿›è¡ŒæŠ¢å å¼è½®è½¬è°ƒåº¦ã€‚è¿™ä¸ªæ—¶é—´åˆ†ç‰‡é€šå¸¸æ˜¯å¾ˆå°çš„ï¼Œä¸€ä¸ªçº¿ç¨‹ä¸€æ¬¡æœ€å¤šåªèƒ½åœ¨ CPU ä¸Šè¿è¡Œæ¯”å¦‚ 10-20ms çš„æ—¶é—´ï¼ˆæ­¤æ—¶å¤„äº running çŠ¶æ€ï¼‰ï¼Œä¹Ÿå³å¤§æ¦‚åªæœ‰ 0.01 ç§’è¿™ä¸€é‡çº§ï¼Œæ—¶é—´ç‰‡ç”¨åå°±è¦è¢«åˆ‡æ¢ä¸‹æ¥æ”¾å…¥è°ƒåº¦é˜Ÿåˆ—çš„æœ«å°¾ç­‰å¾…å†æ¬¡è°ƒåº¦ã€‚ï¼ˆä¹Ÿå³å›åˆ° ready çŠ¶æ€ï¼‰ã€‚<em>çº¿ç¨‹åˆ‡æ¢çš„å¦‚æ­¤ä¹‹å¿«ï¼ŒåŒºåˆ†è¿™ä¸¤ç§çŠ¶æ€å°±æ²¡ä»€ä¹ˆæ„ä¹‰äº†ã€‚</em></p>
<h2 id="wait-sleep"><a href="#wait-sleep" class="headerlink" title="wait/sleep"></a>wait/sleep</h2><p><strong>åŒºåˆ«</strong>ï¼š</p>
<ul>
<li><p><strong><code>sleep()</code></strong>** æ–¹æ³•æ²¡æœ‰é‡Šæ”¾é”ï¼Œè€Œ <strong><strong><code>wait()</code></strong></strong> æ–¹æ³•é‡Šæ”¾äº†é”** ã€‚è¿™æ˜¯å› ä¸º<code>sleep()</code> æ˜¯ <code>Thread</code> ç±»çš„é™æ€æœ¬åœ°æ–¹æ³•ï¼Œä¸ä¼šæ“ä½œå¯¹è±¡é”ï¼Œè€Œ<code>wait()</code> åˆ™æ˜¯ <code>Object</code> ç±»çš„æœ¬åœ°æ–¹æ³•ï¼Œè®©è·å¾—å¯¹è±¡é”çš„çº¿ç¨‹å®ç°ç­‰å¾…</p>
</li>
<li><p><code>wait()</code> æ–¹æ³•è¢«è°ƒç”¨åï¼Œ<em>çº¿ç¨‹ä¸ä¼šè‡ªåŠ¨è‹é†’</em>ï¼Œéœ€è¦åˆ«çš„çº¿ç¨‹è°ƒç”¨åŒä¸€ä¸ªå¯¹è±¡ä¸Šçš„ <code>notify()</code>æˆ–è€… <code>notifyAll()</code> æ–¹æ³•ã€‚<code>sleep()</code>æ–¹æ³•æ‰§è¡Œå®Œæˆåï¼Œçº¿ç¨‹ä¼šè‡ªåŠ¨è‹é†’ï¼Œæˆ–è€…ä¹Ÿå¯ä»¥ä½¿ç”¨ <code>wait(long timeout)</code> è¶…æ—¶åçº¿ç¨‹ä¼šè‡ªåŠ¨è‹é†’ã€‚</p>
</li>
</ul>
<p>å› æ­¤ï¼Œ<code>wait()</code> é€šå¸¸è¢«ç”¨äºçº¿ç¨‹é—´äº¤äº’/é€šä¿¡ï¼Œ<code>sleep()</code>é€šå¸¸è¢«ç”¨äºæš‚åœå½“å‰çº¿ç¨‹çš„æ‰§è¡Œã€‚</p>
<p><strong>ä¸ºä»€ä¹ˆ wait() æ–¹æ³•ä¸å®šä¹‰åœ¨ Thread ä¸­ï¼Ÿ</strong></p>
<p><code>wait()</code> æ˜¯è®©è·å¾—å¯¹è±¡é”çš„çº¿ç¨‹å®ç°ç­‰å¾…ï¼Œä¼šè‡ªåŠ¨é‡Šæ”¾å½“å‰çº¿ç¨‹å æœ‰çš„å¯¹è±¡é”ã€‚æ¯ä¸ªå¯¹è±¡éƒ½æ‹¥æœ‰å¯¹è±¡é”ï¼Œæ—¢ç„¶è¦é‡Šæ”¾å½“å‰çº¿ç¨‹å æœ‰çš„å¯¹è±¡é”å¹¶è®©å…¶è¿›å…¥ç­‰å¾…çŠ¶æ€ï¼Œè‡ªç„¶æ˜¯è¦æ“ä½œå¯¹åº”çš„å¯¹è±¡è€Œéå½“å‰çš„çº¿ç¨‹ã€‚</p>
<h2 id="Synchronized"><a href="#Synchronized" class="headerlink" title="Synchronized"></a>Synchronized</h2><p><strong>å…¬å¹³é”ï¼š</strong> ååˆ†å…¬å¹³ï¼Œå¿…é¡»å…ˆæ¥ååˆ°ï¼›</p>
<p><strong>éå…¬å¹³é”ï¼š</strong> ååˆ†ä¸å…¬å¹³ï¼Œå¯ä»¥æ’é˜Ÿï¼›**(é»˜è®¤)**</p>
<h2 id="Locké”"><a href="#Locké”" class="headerlink" title="Locké”"></a>Locké”</h2><p>lockä¸‰éƒ¨æ›²</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span> Lock lock=<span class="keyword">new</span> <span class="title class_">ReentrantLock</span>();</span><br><span class="line"></span><br><span class="line"><span class="number">2.</span> lock.lock() åŠ é”</span><br><span class="line"></span><br><span class="line"><span class="number">3.</span> <span class="keyword">finally</span>=&gt; è§£é”ï¼šlock.unlock();</span><br></pre></td></tr></tbody></table></figure>

<h2 id="Synchronizedé”-ä¸Locké”-çš„åŒºåˆ«"><a href="#Synchronizedé”-ä¸Locké”-çš„åŒºåˆ«" class="headerlink" title="Synchronizedé” ä¸Locké” çš„åŒºåˆ«"></a>Synchronizedé” ä¸Locké” çš„åŒºåˆ«</h2><ul>
<li>Synchronized æ— æ³•åˆ¤æ–­è·å–<strong>é”çš„çŠ¶æ€</strong>ï¼ŒLockå¯ä»¥åˆ¤æ–­</li>
<li>Synchronized ä¼š<strong>è‡ªåŠ¨é‡Šæ”¾é”</strong>ï¼Œlockå¿…é¡»è¦æ‰‹åŠ¨åŠ é”å’Œæ‰‹åŠ¨é‡Šæ”¾é”ï¼å¯èƒ½ä¼šé‡åˆ°æ­»é”</li>
<li>Synchronized çº¿ç¨‹1(è·å¾—é”-&gt;é˜»å¡)ã€çº¿ç¨‹2(ç­‰å¾…)ï¼›lockå°±ä¸ä¸€å®šä¼šä¸€ç›´ç­‰å¾…ä¸‹å»ï¼Œlockä¼šæœ‰ä¸€ä¸ª<strong>trylock</strong>å»å°è¯•è·å–é”ï¼Œä¸ä¼šé€ æˆé•¿ä¹…çš„ç­‰å¾…ã€‚</li>
<li>Synchronized <strong>æ˜¯å¯é‡å…¥é”</strong>ï¼Œä¸å¯ä»¥ä¸­æ–­çš„ï¼Œ<strong>éå…¬å¹³çš„</strong>ï¼›Lockæ˜¯å¯é‡å…¥çš„ï¼Œå¯ä»¥åˆ¤æ–­é”ï¼Œå¯ä»¥è‡ªå·±è®¾ç½®å…¬å¹³é”å’Œéå…¬å¹³é”ï¼›</li>
<li>Synchronized é€‚åˆé”å°‘é‡çš„ä»£ç åŒæ­¥é—®é¢˜ï¼ŒLocké€‚åˆé”å¤§é‡çš„åŒæ­¥ä»£ç ï¼›</li>
</ul>
<h2 id="Callableæ¥å£"><a href="#Callableæ¥å£" class="headerlink" title="Callableæ¥å£"></a>Callableæ¥å£</h2><p>å®ç°ç±»ï¼š<code>FutureTask</code>ï¼Œå¯ä»¥è·å–åˆ°çº¿ç¨‹æ‰§è¡Œå®Œæ¯•çš„ç»“æœ</p>
<p><code>Callable</code>ä¸<code>Runable</code>çš„åŒºåˆ«ï¼š</p>
<ul>
<li><code>Callable</code>å¯ä»¥æœ‰è¿”å›å€¼</li>
<li><code>Callable</code>å¯ä»¥æŠ›å‡ºå¼‚å¸¸ï¼Œè€Œ<code>Runnable</code>ä¸èƒ½æŠ›å‡ºè¢«æ£€æŸ¥çš„å¼‚å¸¸</li>
<li>å¯åŠ¨æ–¹æ³•ä¸åŒ</li>
</ul>
<h2 id="çº¿ç¨‹å®‰å…¨ç±»é›†åˆ"><a href="#çº¿ç¨‹å®‰å…¨ç±»é›†åˆ" class="headerlink" title="çº¿ç¨‹å®‰å…¨ç±»é›†åˆ"></a>çº¿ç¨‹å®‰å…¨ç±»é›†åˆ</h2><h3 id="Listç±»"><a href="#Listç±»" class="headerlink" title="Listç±»"></a>Listç±»</h3><ul>
<li><p><code>Vector</code></p>
</li>
<li><p><code>Collections.synchronizedList()</code></p>
</li>
<li><p><code>CopyOnWriteArrayList</code></p>
<p>  é€‚ç”¨äºè¯»å¤šå†™å°‘çš„åœºæ™¯</p>
<p>  æ ¸å¿ƒæ€æƒ³æ˜¯ï¼šå¦‚æœæœ‰å¤šä¸ªè°ƒç”¨è€…åŒæ—¶è¦æ±‚ç›¸åŒçš„èµ„æºï¼Œä»–ä»¬ä¼šå…±åŒè·å–ç›¸åŒçš„æŒ‡é’ˆæŒ‡å‘ç›¸åŒçš„èµ„æºï¼Œç›´åˆ°æŸä¸ªè°ƒç”¨è€…è§†å›¾ä¿®æ”¹èµ„æºå†…å®¹æ—¶ï¼Œç³»ç»Ÿæ‰ä¼šçœŸæ­£å¤åˆ¶ä¸€ä»½ä¸“ç”¨å‰¯æœ¬ç»™è¯¥è°ƒç”¨è€…ï¼Œè€Œå…¶ä»–è°ƒç”¨è€…æ‰€è§åˆ°çš„æœ€åˆçš„èµ„æºä»ç„¶ä¿æŒä¸å˜ã€‚</p>
<p>  è¯»çš„æ—¶å€™ä¸éœ€è¦åŠ é”ï¼Œå¦‚æœè¯»çš„æ—¶å€™æœ‰å¤šä¸ªçº¿ç¨‹æ­£åœ¨å‘CopyOnWriteArrayListæ·»åŠ æ•°æ®ï¼Œè¯»è¿˜æ˜¯ä¼šè¯»åˆ°æ—§çš„æ•°æ®ï¼Œå› ä¸ºå†™çš„æ—¶å€™ä¸ä¼šé”ä½æ—§çš„CopyOnWriteArrayListã€‚</p>
</li>
</ul>
<p>**<code>CopyOnWriteArrayList</code><strong>æ¯”</strong><code>Vector</code>**åŒºåˆ«ï¼Ÿ</p>
<ul>
<li>**<code>Vector</code><strong>åº•å±‚æ˜¯ä½¿ç”¨</strong><code>synchronized</code>**å…³é”®å­—æ¥å®ç°çš„ï¼Œæ•ˆç‡ä½ä¸‹</li>
<li>**<code>CopyOnWriteArrayList</code>**ä½¿ç”¨çš„æ˜¯Locké”ï¼Œæ›´åŠ é«˜æ•ˆ</li>
</ul>
<h3 id="Setç±»"><a href="#Setç±»" class="headerlink" title="Setç±»"></a>Setç±»</h3><ul>
<li><code>Collections.synchronizedSet()</code></li>
<li><code>CopyOnWriteArraySet</code></li>
</ul>
<h3 id="Mapç±»"><a href="#Mapç±»" class="headerlink" title="Mapç±»"></a>Mapç±»</h3><ul>
<li><code>Collections.synchronizedMap()</code></li>
<li><code>ConcurrentHashMap</code></li>
<li><code>HashTable</code></li>
</ul>
<h1 id="çº¿ç¨‹é€šä¿¡"><a href="#çº¿ç¨‹é€šä¿¡" class="headerlink" title="çº¿ç¨‹é€šä¿¡"></a>çº¿ç¨‹é€šä¿¡</h1><h2 id="ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…é—®é¢˜"><a href="#ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…é—®é¢˜" class="headerlink" title="ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…é—®é¢˜"></a>ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…é—®é¢˜</h2><p>è¿™æ˜¯ä¸€ä¸ªç»å…¸çš„çº¿ç¨‹é€šä¿¡é—®é¢˜ã€‚ä¸¤ç»„çº¿ç¨‹å…±äº«ä¸€ä¸ªç¼“å†²åŒºã€‚ç”Ÿäº§è€…å°†æ•°æ®æ”¾å…¥ç¼“å†²åŒºï¼Œæ¶ˆè´¹è€…å°†æ•°æ®ä»ç¼“å†²åŒºå–å‡º</p>
<p>demoå¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ProviderConsumer</span>{</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">num</span>  <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ¤æ–­ç­‰å¾…ã€ä¸šåŠ¡ã€é€šçŸ¥</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">increment</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException {</span><br><span class="line">        <span class="keyword">if</span> (num &gt; <span class="number">0</span>) {</span><br><span class="line">            <span class="built_in">this</span>.wait();</span><br><span class="line">        }</span><br><span class="line">        num++;</span><br><span class="line">       System.out.println(Thread.currentThread().getName() + <span class="string">" increment num "</span> + num);</span><br><span class="line">        <span class="built_in">this</span>.notifyAll();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">decrement</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException {</span><br><span class="line">        <span class="keyword">if</span> (num == <span class="number">0</span>) {</span><br><span class="line">            <span class="built_in">this</span>.wait();</span><br><span class="line">        }</span><br><span class="line">        num--;</span><br><span class="line">       System.out.println(Thread.currentThread().getName() + <span class="string">" decrement num "</span> + num);</span><br><span class="line">        <span class="built_in">this</span>.notifyAll();</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {</span><br><span class="line">        <span class="type">ProviderConsumer</span> <span class="variable">providerConsumer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ProviderConsumer</span>();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; {</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) {</span><br><span class="line">                <span class="keyword">try</span> {</span><br><span class="line">                    providerConsumer.increment();</span><br><span class="line">                } <span class="keyword">catch</span> (InterruptedException e) {</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        }, <span class="string">"A"</span>).start();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; {</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) {</span><br><span class="line">                <span class="keyword">try</span> {</span><br><span class="line">                    providerConsumer.decrement();</span><br><span class="line">                } <span class="keyword">catch</span> (InterruptedException e) {</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        }, <span class="string">"B"</span>).start();</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p><strong>è™šå‡å”¤é†’é—®é¢˜</strong></p>
<blockquote>
<p>å½“ä¸€å®šçš„æ¡ä»¶è§¦å‘æ—¶ä¼šå”¤é†’å¾ˆå¤šåœ¨é˜»å¡æ€çš„çº¿ç¨‹ï¼Œä½†åªæœ‰éƒ¨åˆ†çš„çº¿ç¨‹å”¤é†’æ˜¯æœ‰ç”¨çš„ï¼Œå…¶ä½™çº¿ç¨‹çš„å”¤é†’æ˜¯å¤šä½™çš„ã€‚  </p>
</blockquote>
<p>  <a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_45668482/article/details/117373700?ydreferer=aHR0cHM6Ly9jbi5iaW5nLmNvbS8=">https://blog.csdn.net/weixin_45668482/article/details/117373700?ydreferer=aHR0cHM6Ly9jbi5iaW5nLmNvbS8%3D</a></p>
<p>è§£å†³è™šå‡å”¤é†’é—®é¢˜ï¼šåº”è¯¥å°†å”¤é†’æ”¾åœ¨å¾ªç¯ä¸­ï¼Œä¸æ»¡è¶³æ¡ä»¶éœ€è¦ç»§ç»­ç­‰å¾…</p>
<p>æ¢å¥è¯è¯´ï¼šå°†ifæ›¿æ¢æˆwhileã€‚å½“ä½¿ç”¨<code>notifyAll()</code>æ—¶ï¼Œæ‰€æœ‰çš„çº¿ç¨‹éƒ½å°†è¢«å”¤é†’ï¼Œå¦‚æœä½¿ç”¨çš„æ˜¯ifï¼Œä¸ä¼šå†æ¬¡è¿›è¡Œæ¡ä»¶åˆ¤æ–­ï¼Œå› æ­¤è¢«å”¤é†’çš„å¯èƒ½æ˜¯æ¶ˆè´¹è€…ï¼Œä¹Ÿå¯èƒ½æ˜¯ç”Ÿäº§è€…ã€‚è€Œä½¿ç”¨whileçš„æ—¶å€™ï¼Œä¼šå†æ¬¡è¿›è¡Œç­‰å¾…åˆ¤æ–­ï¼Œä»è€Œé¿å…è™šå‡å”¤é†’é—®é¢˜ã€‚</p>
<h3 id="Lock-Conditionå®ç°"><a href="#Lock-Conditionå®ç°" class="headerlink" title="Lock + Conditionå®ç°"></a>Lock + Conditionå®ç°</h3><p>Locké”çš„Conditionå¯ä»¥ç²¾å‡†é€šçŸ¥å”¤é†’çš„çº¿ç¨‹ï¼Œä»è€Œ<strong>æ§åˆ¶å¤šä¸ªçº¿ç¨‹çš„æ‰§è¡Œé¡ºåº</strong></p>
<p>demoï¼šå¤šä¸ªçº¿ç¨‹è½®æµè¾“å‡ºA B C</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">TestCondition</span> {</span><br><span class="line">    <span class="keyword">private</span> <span class="type">Lock</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReentrantLock</span>();</span><br><span class="line">    <span class="keyword">private</span> <span class="type">Condition</span> <span class="variable">condition1</span> <span class="operator">=</span> lock.newCondition();</span><br><span class="line">    <span class="keyword">private</span> <span class="type">Condition</span> <span class="variable">condition2</span> <span class="operator">=</span> lock.newCondition();</span><br><span class="line">    <span class="keyword">private</span> <span class="type">Condition</span> <span class="variable">condition3</span> <span class="operator">=</span> lock.newCondition();</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">num</span> <span class="operator">=</span> <span class="number">1</span>; <span class="comment">// 1A 2B 3C</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">printA</span><span class="params">()</span> {</span><br><span class="line">        lock.lock();</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            <span class="comment">// ä¸šåŠ¡ä»£ç  åˆ¤æ–­ -&gt; æ‰§è¡Œ -&gt; é€šçŸ¥</span></span><br><span class="line">            <span class="keyword">while</span> (num != <span class="number">1</span>) {</span><br><span class="line">                condition1.await();</span><br><span class="line">            }</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">"==&gt; AAAA"</span> );</span><br><span class="line">            num = <span class="number">2</span>;</span><br><span class="line">            condition2.signal();</span><br><span class="line">        }<span class="keyword">catch</span> (Exception e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        }<span class="keyword">finally</span> {</span><br><span class="line">            lock.unlock();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">printB</span><span class="params">()</span> {</span><br><span class="line">        lock.lock();</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            <span class="keyword">while</span> (num != <span class="number">2</span>) {</span><br><span class="line">                condition2.await();</span><br><span class="line">            }</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">"==&gt; BBBB"</span> );</span><br><span class="line">            num = <span class="number">3</span>;</span><br><span class="line">            condition3.signal();</span><br><span class="line">        }<span class="keyword">catch</span> (Exception e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        }<span class="keyword">finally</span> {</span><br><span class="line">            lock.unlock();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">printC</span><span class="params">()</span> {</span><br><span class="line">        lock.lock();</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            <span class="keyword">while</span> (num != <span class="number">3</span>) {</span><br><span class="line">                condition3.await();</span><br><span class="line">            }</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">"==&gt; CCCC"</span> );</span><br><span class="line">            num = <span class="number">1</span>;</span><br><span class="line">            condition1.signal();</span><br><span class="line">        }<span class="keyword">catch</span> (Exception e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        }<span class="keyword">finally</span> {</span><br><span class="line">            lock.unlock();</span><br><span class="line">        }</span><br><span class="line">    }</span><br></pre></td></tr></tbody></table></figure>

<h3 id="BlockingQueueå®ç°ç”Ÿäº§è€…æ¶ˆè´¹è€…é—®é¢˜"><a href="#BlockingQueueå®ç°ç”Ÿäº§è€…æ¶ˆè´¹è€…é—®é¢˜" class="headerlink" title="BlockingQueueå®ç°ç”Ÿäº§è€…æ¶ˆè´¹è€…é—®é¢˜"></a>BlockingQueueå®ç°ç”Ÿäº§è€…æ¶ˆè´¹è€…é—®é¢˜</h3><p>BlockingQueueæ˜¯Javaè‡ªå¸¦çš„é˜»å¡é˜Ÿåˆ—ï¼Œå†…éƒ¨çš„åŸç†ä¹Ÿæ˜¯ä½¿ç”¨äº†ReentrantLock + Conditionå®ç°</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {</span><br><span class="line">    BlockingQueue&lt;Object&gt; queue = <span class="keyword">new</span> <span class="title class_">ArrayBlockingQueue</span>&lt;&gt;(<span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">Runnable</span> <span class="variable">producer</span> <span class="operator">=</span> () -&gt; {</span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) {</span><br><span class="line">            <span class="keyword">try</span> {</span><br><span class="line">                queue.put(<span class="keyword">new</span> <span class="title class_">Object</span>());</span><br><span class="line">            } <span class="keyword">catch</span> (InterruptedException e) {</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    };</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Thread</span>(producer).start();</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Thread</span>(producer).start();</span><br><span class="line">    </span><br><span class="line">    <span class="type">Runnable</span> <span class="variable">consumer</span> <span class="operator">=</span> () -&gt; {</span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) {</span><br><span class="line">            <span class="keyword">try</span> {</span><br><span class="line">                queue.take();</span><br><span class="line">            } <span class="keyword">catch</span> (InterruptedException e) {</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    };</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Thread</span>(consumer).start();</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Thread</span>(consumer).start();</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h1 id="Javaä¸­çš„çº¿ç¨‹åä½œ"><a href="#Javaä¸­çš„çº¿ç¨‹åä½œ" class="headerlink" title="Javaä¸­çš„çº¿ç¨‹åä½œ"></a>Javaä¸­çš„çº¿ç¨‹åä½œ</h1><h3 id="CountDownLatch"><a href="#CountDownLatch" class="headerlink" title="CountDownLatch"></a>CountDownLatch</h3><p>å€’è®¡æ•°é”å­˜å™¨ï¼Œå¯ä»¥ç”¨ä½œä¸€ä¸ª<strong>ç®€å•çš„å¼€/å…³é”å­˜å™¨ï¼Œæˆ–è€…é—¨</strong>ï¼šæ‰€æœ‰çº¿ç¨‹è°ƒç”¨<code>await()</code>åœ¨é—¨å£ç­‰å¾…ï¼Œç›´åˆ°è¢«è°ƒç”¨<code>countDown()</code>çš„çº¿ç¨‹æ‰“å¼€ã€‚</p>
<p>CountDownLatchä¸€ä¸ªæœ‰ç”¨çš„å±æ€§æ˜¯ï¼Œå®ƒä¸è¦æ±‚è°ƒç”¨countDownçº¿ç¨‹ç­‰å¾…è®¡æ•°åˆ°è¾¾é›¶ä¹‹å‰ç›¸äº’ç­‰å¾…ï¼Œå®ƒåªæ˜¯é˜»æ­¢ä»»ä½•çº¿ç¨‹é€šè¿‡awaitï¼Œç›´åˆ°æ‰€æœ‰çº¿ç¨‹å¯ä»¥é€šè¿‡ã€‚</p>
<p>å¸¸ç”¨æ–¹æ³•ï¼š</p>
<ul>
<li>**<code>countDown()</code>**å‡ä¸€æ“ä½œï¼›</li>
<li><strong><code>await()</code></strong> ç­‰å¾…è®¡æ•°å™¨å½’é›¶</li>
</ul>
<h3 id="CyclickBarrier"><a href="#CyclickBarrier" class="headerlink" title="CyclickBarrier"></a>CyclickBarrier</h3><p>å¾ªç¯å±éšœï¼Œå®ƒå…è®¸ä¸€ç»„çº¿ç¨‹å…¨éƒ¨ç­‰å¾…å½¼æ­¤è¾¾åˆ°å…±åŒå±éšœç‚¹çš„åŒæ­¥è¾…åŠ©ã€‚å¾ªç¯é˜»å¡åœ¨æ¶‰åŠå›ºå®šå¤§å°çš„çº¿ç¨‹æ–¹çš„ç¨‹åºä¸­å¾ˆæœ‰ç”¨ï¼Œè¿™äº›çº¿ç¨‹å¿…é¡»å¶å°”ç­‰å¾…å½¼æ­¤ã€‚å±éšœè¢«ç§°ä¸ºå¾ªç¯ï¼Œå› ä¸ºå®ƒå¯ä»¥åœ¨ç­‰å¾…çš„çº¿ç¨‹è¢«é‡Šæ”¾ä¹‹åé‡æ–°ä½¿ç”¨ã€‚</p>
<p>å¸¸ç”¨æ–¹æ³•åŒ…æ‹¬ï¼š</p>
<ul>
<li><strong><code>await()</code></strong>: è°ƒç”¨è¯¥æ–¹æ³•çš„çº¿ç¨‹åˆ°è¾¾å±éšœç‚¹ï¼Œå¹¶ç­‰å¾…å…¶ä»–çº¿ç¨‹åˆ°è¾¾ã€‚å¦‚æœæ˜¯æœ€åä¸€ä¸ªåˆ°è¾¾çš„çº¿ç¨‹ï¼Œå°†æ‰§è¡Œå¯é€‰çš„ä»»åŠ¡ã€‚</li>
<li><code>await(long timeout, TimeUnit unit)</code>: è°ƒç”¨è¯¥æ–¹æ³•çš„çº¿ç¨‹åˆ°è¾¾å±éšœç‚¹ï¼Œå¹¶ç­‰å¾…å…¶ä»–çº¿ç¨‹åˆ°è¾¾ï¼Œä½†æœ€å¤šç­‰å¾…æŒ‡å®šçš„æ—¶é—´ã€‚</li>
<li><code>getParties()</code>: è¿”å›éœ€è¦åˆ°è¾¾å±éšœç‚¹çš„æ€»çº¿ç¨‹æ•°ã€‚</li>
<li><code>isBroken()</code>: æ£€æŸ¥å±éšœæ˜¯å¦è¢«ç ´åï¼ˆæ˜¯å¦æœ‰çº¿ç¨‹ç­‰å¾…è¶…æ—¶ï¼‰ã€‚</li>
</ul>
<p>**<code>CyclicBarrier </code>****ä¸ ****<code>CountDownLatch </code>**<strong>åŒºåˆ«</strong></p>
<ul>
<li><code>CountDownLatch</code>æ˜¯ä¸€æ¬¡æ€§çš„ï¼Œ<code>CyclicBarrier</code> æ˜¯å¯ä»¥é‡ç”¨çš„</li>
<li><code>CountDownLatch</code>ä¸­æœ‰ä¸¤ä¸ªå…³é”®ï¼Œä¸€ä¸ªæ˜¯<code>countDown()</code>ï¼Œä¸€ä¸ªæ˜¯<code>awit()</code>ï¼Œè°ƒç”¨<code>awit()</code>çš„çº¿ç¨‹éœ€è¦ç­‰å¾…ï¼Œè°ƒç”¨<code>countDown()</code>çš„çº¿ç¨‹ä¼šå°†å€’è®¡æ—¶-1ï¼Œä¸åŒçš„çº¿ç¨‹èŒè´£å¯èƒ½æ˜¯ä¸åŒçš„ï¼Œè¢«ç®¡ç†çš„æ˜¯è°ƒç”¨äº†<code>awit()</code>çš„çº¿ç¨‹ï¼Œè®¡æ•°å™¨å¯ä»¥æ˜¯å•ç‹¬çš„é€»è¾‘ã€‚</li>
</ul>
<h3 id="Semaphore"><a href="#Semaphore" class="headerlink" title="Semaphore"></a>Semaphore</h3><p>ä¿¡å·é‡ï¼Œç”¨äºæ§åˆ¶åŒæ—¶è®¿é—®æŸä¸ªèµ„æºçš„çº¿ç¨‹æ•°é‡ã€‚å®ƒå¯ä»¥ç”¨æ¥é™åˆ¶å¹¶å‘è®¿é—®çš„çº¿ç¨‹æ•°ï¼Œæˆ–è€…ç”¨äºçº¿ç¨‹é—´çš„ä¿¡å·é€šçŸ¥ã€‚</p>
<p><code>Semaphore</code> ç»´æŠ¤äº†ä¸€ç»„è®¸å¯ï¼ˆpermitsï¼‰ï¼Œçº¿ç¨‹åœ¨è®¿é—®èµ„æºä¹‹å‰å¿…é¡»å…ˆè·å¾—è®¸å¯ï¼Œå¦‚æœè®¸å¯æ•°ä¸è¶³ï¼Œåˆ™çº¿ç¨‹å¿…é¡»ç­‰å¾…ï¼Œç›´åˆ°æœ‰å¯ç”¨çš„è®¸å¯ä¸ºæ­¢ã€‚æ¯ä¸ª <code>Semaphore</code> å¯¹è±¡éƒ½æœ‰ä¸€ä¸ªåˆå§‹è®¸å¯æ•°ï¼Œè¡¨ç¤ºå¯åŒæ—¶è®¿é—®è¯¥èµ„æºçš„çº¿ç¨‹æ•°ã€‚</p>
<p>å‡è®¾ä¿¡å·é‡åˆå§‹æ•°é‡ä¸ºsemï¼š</p>
<p>  P æ“ä½œï¼šç”³è¯·ä¸€ä¸ªè®¸å¯ï¼Œå°† sem å‡ 1ï¼Œç›¸å‡åï¼Œå¦‚æœ <code>sem &lt; 0</code>ï¼Œåˆ™è¿›ç¨‹/çº¿ç¨‹è¿›å…¥é˜»å¡ç­‰å¾…ï¼Œå¦åˆ™ç»§ç»­ï¼Œè¡¨æ˜ P æ“ä½œå¯èƒ½ä¼šé˜»å¡ï¼›</p>
<p>  V æ“ä½œï¼šé‡Šæ”¾ä¸€ä¸ªè®¸å¯ï¼Œå°† sem åŠ  1ï¼Œç›¸åŠ åï¼Œå¦‚æœ<code> sem &lt;= 0</code>ï¼Œå”¤é†’ä¸€ä¸ªç­‰å¾…ä¸­çš„è¿›ç¨‹/çº¿ç¨‹ï¼Œè¡¨æ˜ V æ“ä½œä¸ä¼šé˜»å¡ï¼›</p>
<p>å¸¸ç”¨æ–¹æ³•ï¼š</p>
<ul>
<li><strong><code>acquire()</code></strong>: è·å–ä¸€ä¸ªè®¸å¯ï¼Œå¦‚æœæ²¡æœ‰å¯ç”¨è®¸å¯ï¼Œåˆ™çº¿ç¨‹ä¼šè¢«é˜»å¡ï¼Œç›´åˆ°æœ‰å¯ç”¨è®¸å¯ã€‚</li>
<li><strong><code>release()</code></strong>: é‡Šæ”¾ä¸€ä¸ªè®¸å¯ï¼Œå°†å…¶è¿”å›ç»™ <code>Semaphore</code>ã€‚</li>
<li><code>tryAcquire()</code>: å°è¯•è·å–ä¸€ä¸ªè®¸å¯ï¼Œå¦‚æœè·å–æˆåŠŸåˆ™è¿”å› trueï¼Œå¦åˆ™è¿”å› falseã€‚</li>
<li><code>availablePermits()</code>: è¿”å›å½“å‰å¯ç”¨çš„è®¸å¯æ•°ã€‚</li>
</ul>
<h2 id="ReadWriteLock"><a href="#ReadWriteLock" class="headerlink" title="ReadWriteLock"></a>ReadWriteLock</h2><p>è¯»å†™é”ï¼Œæ§åˆ¶å¯¹å…±äº«èµ„æºè®¿é—®çš„åŒæ­¥æœºåˆ¶ã€‚å®ƒå…è®¸å¤šä¸ªçº¿ç¨‹åŒæ—¶è¯»å–èµ„æºï¼Œä½†åªå…è®¸ä¸€ä¸ªçº¿ç¨‹ç‹¬å å†™å…¥èµ„æºã€‚</p>
<p>ReadWriteLockçš„ç›®çš„æ˜¯åœ¨èµ„æºè¢«è¯»å–çš„é¢‘ç‡é«˜äºå†™å…¥çš„æƒ…å†µä¸‹ä¼˜åŒ–æ€§èƒ½ã€‚é€šè¿‡å…è®¸å¹¶å‘è¯»å–ï¼Œå¤šä¸ªçº¿ç¨‹å¯ä»¥åŒæ—¶è®¿é—®èµ„æºï¼Œè¿™å¯ä»¥æé«˜ååé‡å¹¶å‡å°‘çº¿ç¨‹ä¹‹é—´çš„ç«äº‰ã€‚ç„¶è€Œï¼Œå½“ä¸€ä¸ªçº¿ç¨‹å¸Œæœ›ä¿®æ”¹èµ„æºæ—¶ï¼Œå®ƒéœ€è¦ç‹¬å è®¿é—®ä»¥ç¡®ä¿ä¸€è‡´æ€§ã€‚</p>
<h2 id="Fork-Join"><a href="#Fork-Join" class="headerlink" title="Fork/Join"></a>Fork/Join</h2><p>æ ¸å¿ƒæ€æƒ³ï¼š<strong>åˆ†è€Œæ²»ä¹‹</strong></p>
<p>Fork-Joinæ¨¡å‹çš„æ ¸å¿ƒæ€æƒ³æ˜¯å…³é”®æ¦‚å¿µæ˜¯â€forkâ€ï¼ˆåˆ†å‰ï¼‰å’Œâ€joinâ€ï¼ˆåˆå¹¶ï¼‰ï¼Œå³å°†ä¸€ä¸ªå¤§ä»»åŠ¡åˆ’åˆ†ä¸ºè‹¥å¹²ä¸ªå°ä»»åŠ¡ï¼Œç„¶åå¹¶è¡Œåœ°æ‰§è¡Œè¿™äº›å°ä»»åŠ¡ï¼Œæœ€åå°†å®ƒä»¬çš„ç»“æœç»„åˆèµ·æ¥å¾—åˆ°æœ€ç»ˆçš„ç»“æœã€‚è¿™ä¸ªè¿‡ç¨‹å¯ä»¥é€’å½’åœ°è¿›è¡Œï¼Œå³æ¯ä¸ªå°ä»»åŠ¡ä¹Ÿå¯ä»¥å†æ¬¡åˆ’åˆ†æˆæ›´å°çš„å­ä»»åŠ¡ï¼Œç›´åˆ°ä»»åŠ¡çš„è§„æ¨¡è¶³å¤Ÿå°ä»¥è‡³äºå¯ä»¥è¢«ç›´æ¥æ‰§è¡Œã€‚</p>
<p>ä¸¤ä¸ªå®ç°ç±»ï¼š</p>
<ul>
<li><code>RecursiveTask</code>æœ‰è¿”å›å€¼</li>
<li><code>RecursiveAction</code>æ²¡æœ‰è¿”å›å€¼</li>
</ul>
<p>Fork/Joinæ¡†æ¶çš„ä¼˜åŠ¿åœ¨äºå®ƒèƒ½å¤Ÿè‡ªåŠ¨åœ°å°†ä»»åŠ¡åˆ’åˆ†æˆåˆé€‚çš„å¤§å°ï¼Œå¹¶åˆ©ç”¨å¤šæ ¸å¤„ç†å™¨ä¸Šçš„å¹¶è¡Œæ€§æé«˜ç¨‹åºçš„æ€§èƒ½ã€‚å®ƒä¹Ÿæä¾›äº†ä¸€äº›ä¼˜åŒ–æŠ€æœ¯ï¼Œå¦‚<em><strong>å·¥ä½œçªƒå–ï¼ˆwork stealingï¼‰</strong></em>ï¼Œå¯ä»¥ç¡®ä¿å„ä¸ªçº¿ç¨‹åœ¨æ‰§è¡Œä»»åŠ¡æ—¶èƒ½å¤Ÿå……åˆ†åˆ©ç”¨ç³»ç»Ÿèµ„æºã€‚</p>
<h3 id="å·¥ä½œçªƒå–åŸç†"><a href="#å·¥ä½œçªƒå–åŸç†" class="headerlink" title="å·¥ä½œçªƒå–åŸç†"></a>å·¥ä½œçªƒå–åŸç†</h3><ol>
<li>æ¯ä¸ªå·¥ä½œçº¿ç¨‹éƒ½æœ‰ä¸€ä¸ªæœ¬åœ°çš„å·¥ä½œé˜Ÿåˆ—ï¼ˆ<em>åŒç«¯é˜Ÿåˆ—</em>ï¼‰ï¼Œç”¨äºå­˜å‚¨å¾…æ‰§è¡Œçš„ä»»åŠ¡ã€‚ä½¿ç”¨åŒç«¯é˜Ÿåˆ—ä½œä¸ºæœ¬åœ°å·¥ä½œé˜Ÿåˆ—çš„å¥½å¤„åœ¨äºï¼Œå·¥ä½œçº¿ç¨‹å¯ä»¥é«˜æ•ˆåœ°ä»é˜Ÿåˆ—çš„å¤´éƒ¨æˆ–å°¾éƒ¨æ‰§è¡Œæ’å…¥å’Œåˆ é™¤æ“ä½œã€‚å½“å·¥ä½œçº¿ç¨‹æ‰§è¡Œä»»åŠ¡æ—¶ï¼Œå®ƒä¼šä»é˜Ÿåˆ—çš„å¤´éƒ¨è·å–ä»»åŠ¡å¹¶æ‰§è¡Œï¼›è€Œå½“å·¥ä½œçº¿ç¨‹å°è¯•çªƒå–ä»»åŠ¡æ—¶ï¼Œå®ƒä¼šä»é˜Ÿåˆ—çš„å°¾éƒ¨æ’å…¥çªƒå–åˆ°çš„ä»»åŠ¡ã€‚</li>
<li>å½“ä¸€ä¸ªå·¥ä½œçº¿ç¨‹çš„æœ¬åœ°å·¥ä½œé˜Ÿåˆ—ä¸ºç©ºæ—¶ï¼Œå®ƒä¼šå°è¯•ä»å…¶ä»–å·¥ä½œçº¿ç¨‹çš„å·¥ä½œé˜Ÿåˆ—ä¸­çªƒå–ä»»åŠ¡ã€‚è¿™ä¸ªçªƒå–çš„ç›®æ ‡é€šå¸¸æ˜¯é€‰æ‹©ä¸€ä¸ªç›¸å¯¹è¾ƒç¹å¿™çš„å·¥ä½œçº¿ç¨‹ï¼Œå³å…¶å·¥ä½œé˜Ÿåˆ—ä¸­æœ‰æ›´å¤šä»»åŠ¡ç­‰å¾…æ‰§è¡Œã€‚</li>
<li>å·¥ä½œçº¿ç¨‹å¯ä»¥ä»ç›®æ ‡å·¥ä½œçº¿ç¨‹çš„å·¥ä½œé˜Ÿåˆ—çš„é¡¶éƒ¨ï¼ˆå¤´éƒ¨ï¼‰æˆ–è€…åº•éƒ¨ï¼ˆå°¾éƒ¨ï¼‰çªƒå–ä»»åŠ¡ã€‚é€‰æ‹©çªƒå–çš„ä½ç½®å¯ä»¥æ ¹æ®å…·ä½“çš„å®ç°ç­–ç•¥æ¥ç¡®å®šï¼Œä¸åŒçš„å®ç°æ–¹å¼å¯èƒ½æœ‰æ‰€ä¸åŒã€‚</li>
<li>çªƒå–ä»»åŠ¡çš„è¿‡ç¨‹é€šå¸¸æ˜¯é€šè¿‡çº¿ç¨‹é—´çš„åŸå­æ“ä½œæ¥å®ç°çš„ï¼Œä»¥ç¡®ä¿å¹¶å‘çš„æ­£ç¡®æ€§ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥ä½¿ç”¨CASï¼ˆCompare and Swapï¼‰æ“ä½œæ¥ä¿è¯ä»»åŠ¡çš„çªƒå–æ˜¯åŸå­çš„ã€‚</li>
<li>å½“ä¸€ä¸ªå·¥ä½œçº¿ç¨‹æˆåŠŸåœ°çªƒå–åˆ°ä»»åŠ¡åï¼Œå®ƒä¼šå°†ä»»åŠ¡æ·»åŠ åˆ°è‡ªå·±çš„æœ¬åœ°å·¥ä½œé˜Ÿåˆ—ä¸­ï¼Œå¹¶ç»§ç»­æ‰§è¡Œçªƒå–åˆ°çš„ä»»åŠ¡ã€‚</li>
</ol>

        </div>

        
            <section class="post-copyright">
                
                    <p class="copyright-item">
                        <span>Author:</span>
                        <span>qing-wq</span>
                    </p>
                
                
                    <p class="copyright-item">
                        <span>Permalink:</span>
                        <span><a href="https://qing-wq.github.io/2023/09/03/JUC%E5%9F%BA%E7%A1%80/">https://qing-wq.github.io/2023/09/03/JUC%E5%9F%BA%E7%A1%80/</a></span>
                    </p>
                
                
                    <p class="copyright-item">
                        <span>License:</span>
                        <span>Copyright (c) 2019 <a target="_blank" rel="noopener" href="http://creativecommons.org/licenses/by-nc/4.0/">CC-BY-NC-4.0</a> LICENSE</span>
                    </p>
                
                

            </section>
        
        <section class="post-tags">
            <div>
                <span>Tag(s):</span>
                <span class="tag">
                    
                    
                        <a href="/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"># å­¦ä¹ ç¬”è®°</a>
                    
                        
                </span>
            </div>
            <div>
                <a href="javascript:window.history.back();">back</a>
                <span>Â· </span>
                <a href="/">home</a>
            </div>
        </section>
        <section class="post-nav">
            
                <a class="prev" rel="prev" href="/2023/09/08/RabbitMQ%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">RabbitMQå­¦ä¹ ç¬”è®°</a>
            
            
            <a class="next" rel="next" href="/2023/09/01/Go%E8%AF%AD%E8%A8%80%E5%9F%BA%E7%A1%80/">Goè¯­è¨€åŸºç¡€</a>
            
        </section>


    </article>
</div>

            </div>
            <footer id="footer" class="footer">
    <div class="copyright">
        <span>Â© qing-wq | Powered by <a href="https://hexo.io" target="_blank">Hexo</a> & <a href="https://github.com/Siricee/hexo-theme-Chic" target="_blank">Chic</a></span>
    </div>
</footer>

    </div>
</body>

</html>