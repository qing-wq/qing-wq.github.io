<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
<meta name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">

    <meta name="author" content="qing-wq">



    <meta name="description" content="Qing's Blog">



<title>MyBatiså­¦ä¹ ç¬”è®° | Qing&#39;s Blog</title>



    <link rel="icon" href="/favicon.ico">




    <!-- stylesheets list from _config.yml -->
    
    <link rel="stylesheet" href="/css/style.css">
    



    <!-- scripts list from _config.yml -->
    
    <script src="/js/script.js"></script>
    
    <script src="/js/tocbot.min.js"></script>
    



    
    
        
    


<meta name="generator" content="Hexo 7.3.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
</head>

<body>
    <script>
        // this function is used to check current theme before page loaded.
        (() => {
            const currentTheme = window.localStorage && window.localStorage.getItem('theme') || '';
            const isDark = currentTheme === 'dark';
            const pagebody = document.getElementsByTagName('body')[0]
            if (isDark) {
                pagebody.classList.add('dark-theme');
                // mobile
                document.getElementById("mobile-toggle-theme").innerText = "Â· Dark"
            } else {
                pagebody.classList.remove('dark-theme');
                // mobile
                document.getElementById("mobile-toggle-theme").innerText = "Â· Light"
            }
        })();
    </script>

    <div class="wrapper">
        <header>
    <nav class="navbar">
        <div class="container">
            <div class="navbar-header header-logo"><a href="/">Qing&#39;s Blog</a></div>
            <div class="menu navbar-right">
                
                    <a class="menu-item" href="/archives">Posts</a>
                
                    <a class="menu-item" href="/categories">Categories</a>
                
                    <a class="menu-item" href="/tags">Tags</a>
                
                    <a class="menu-item" href="/about">About</a>
                
                <input id="switch_default" type="checkbox" class="switch_default">
                <label for="switch_default" class="toggleBtn"></label>
            </div>
        </div>
    </nav>

    
    <nav class="navbar-mobile" id="nav-mobile">
        <div class="container">
            <div class="navbar-header">
                <div>
                    <a href="/">Qing&#39;s Blog</a><a id="mobile-toggle-theme">Â·&nbsp;Light</a>
                </div>
                <div class="menu-toggle" onclick="mobileBtn()">&#9776; Menu</div>
            </div>
            <div class="menu" id="mobile-menu">
                
                    <a class="menu-item" href="/archives">Posts</a>
                
                    <a class="menu-item" href="/categories">Categories</a>
                
                    <a class="menu-item" href="/tags">Tags</a>
                
                    <a class="menu-item" href="/about">About</a>
                
            </div>
        </div>
    </nav>

</header>
<script>
    var mobileBtn = function f() {
        var toggleMenu = document.getElementsByClassName("menu-toggle")[0];
        var mobileMenu = document.getElementById("mobile-menu");
        if(toggleMenu.classList.contains("active")){
           toggleMenu.classList.remove("active")
            mobileMenu.classList.remove("active")
        }else{
            toggleMenu.classList.add("active")
            mobileMenu.classList.add("active")
        }
    }
</script>
            <div class="main">
                <div class="container">
    
    
        <div class="post-toc">
    <div class="tocbot-list">
    </div>
    <div class="tocbot-list-menu">
        <a class="tocbot-toc-expand" onclick="expand_toc()">Expand all</a>
        <a onclick="go_top()">Back to top</a>
        <a onclick="go_bottom()">Go to bottom</a>
    </div>
</div>

<script>
    var tocbot_timer;
    var DEPTH_MAX = 6; // ä¸º 6 æ—¶å±•å¼€æ‰€æœ‰
    var tocbot_default_config = {
        tocSelector: '.tocbot-list',
        contentSelector: '.post-content',
        headingSelector: 'h1, h2, h3, h4, h5',
        orderedList: false,
        scrollSmooth: true,
        onClick: extend_click,
    };

    function extend_click() {
        clearTimeout(tocbot_timer);
        tocbot_timer = setTimeout(function() {
            tocbot.refresh(obj_merge(tocbot_default_config, {
                hasInnerContainers: true
            }));
        }, 420); // è¿™ä¸ªå€¼æ˜¯ç”± tocbot æºç é‡Œå®šä¹‰çš„ scrollSmoothDuration å¾—æ¥çš„
    }

    document.ready(function() {
        tocbot.init(obj_merge(tocbot_default_config, {
            collapseDepth: 1
        }));
    });

    function expand_toc() {
        var b = document.querySelector('.tocbot-toc-expand');
        var expanded = b.getAttribute('data-expanded');
        expanded ? b.removeAttribute('data-expanded') : b.setAttribute('data-expanded', true);
        tocbot.refresh(obj_merge(tocbot_default_config, {
            collapseDepth: expanded ? 1 : DEPTH_MAX
        }));
        b.innerText = expanded ? 'Expand all' : 'Collapse all';
    }

    function go_top() {
        window.scrollTo(0, 0);
    }

    function go_bottom() {
        window.scrollTo(0, document.body.scrollHeight);
    }

    function obj_merge(target, source) {
        for (var item in source) {
            if (source.hasOwnProperty(item)) {
                target[item] = source[item];
            }
        }
        return target;
    }
</script>
    

    
    <article class="post-wrap">
        <header class="post-header">
            <h1 class="post-title">MyBatiså­¦ä¹ ç¬”è®°</h1>
            
                <div class="post-meta">
                    
                        ğŸ‘¨â€ğŸ“Author: <a itemprop="author" rel="author" href="/">qing-wq</a>
                    

                    
                        <span class="post-time">
                        ğŸ“…Date: <a href="#">ä¸ƒæœˆ 26, 2022</a>
                        </span>
                    
                    <br/>
                    
                        <span class="post-category">
                            ğŸ“šCategory:
                            
                                <a href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">å­¦ä¹ ç¬”è®°</a>
                            
                        </span>
                    
                    
                    
                        <span class="post-count">
                            ğŸ“‘Words:
                            <a href="">5.1k</a> 
                        </span>
                    
                    
                        <span class="post-count">
                            â±ï¸Time:
                            <a href="">23min</a> 
                        </span>
                                            
                </div>
            
        </header>

        <div class="post-content">
            <p>MyBatisï¼ŒåŸå iBatisï¼ŒJavaå¸¸ç”¨ORMæ¡†æ¶ï¼ŒåŸæ¥æ˜¯Apacheä¸‹çš„ä¸€ä¸ªå¼€æºé¡¹ç›®ï¼Œ2010 å¹´è¿ç§»åˆ° Google codeï¼Œæ”¹å MyBatisã€‚2013 å¹´è¿ç§»åˆ° Githubã€‚</p>
<p><strong>å®˜æ–¹æ–‡æ¡£</strong>ï¼š <a target="_blank" rel="noopener" href="https://mybatis.org/mybatis-3/zh" title="mybatis â€“ MyBatis 3 | Introduction">mybatis â€“ MyBatis 3 | Introduction</a></p>
<h2 id="1-MyBatisä½¿ç”¨æ­¥éª¤"><a href="#1-MyBatisä½¿ç”¨æ­¥éª¤" class="headerlink" title="1 MyBatisä½¿ç”¨æ­¥éª¤"></a>1 MyBatisä½¿ç”¨æ­¥éª¤</h2><h3 id="1-1-å¯¼å…¥ä¾èµ–"><a href="#1-1-å¯¼å…¥ä¾èµ–" class="headerlink" title="1.1 å¯¼å…¥ä¾èµ–"></a>1.1 å¯¼å…¥ä¾èµ–</h3><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>8.0.26<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.mybatis/mybatis --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.5.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<span id="more"></span>

<h3 id="1-2-åˆ›å»ºSqlSession"><a href="#1-2-åˆ›å»ºSqlSession" class="headerlink" title="1.2 åˆ›å»ºSqlSession"></a>1.2 åˆ›å»ºSqlSession</h3><p>SqlSessionæ˜¯MyBatisç”¨äºæ‰§è¡ŒSqlçš„å…³é”®API</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// MyBatiså·¥å…·ç±»ï¼šç”¨äºè·å–sqlSessionFactory -&gt; sqlSession</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyBatisUtil</span> {</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> SqlSessionFactory sqlSessionFactory;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> {</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            <span class="comment">// 1.è·å–sqlSessionFactoryå¯¹è±¡</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">resource</span> <span class="operator">=</span> <span class="string">"mybatis-config.xml"</span>;</span><br><span class="line">            <span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> Resources.getResourceAsStream(resource);</span><br><span class="line">            sqlSessionFactory = <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBuilder</span>().build(inputStream);</span><br><span class="line">        } <span class="keyword">catch</span> (IOException e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·å–sqlSessionå¯¹è±¡</span></span><br><span class="line">    <span class="comment">// sqlSessionä¸­å®Œå…¨åŒ…å«äº†é¢å‘æ•°æ®åº“æ‰§è¡Œsqlå‘½ä»¤æ‰€éœ€çš„æ‰€æœ‰æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> SqlSession <span class="title function_">getSqlSession</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> sqlSessionFactory.openSession(<span class="literal">true</span>);   <span class="comment">// è®¾ç½®ä¸ºtrueè¡¨ç¤ºé»˜è®¤å¼€å¯äº‹åŠ¡</span></span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h3 id="1-3-XML-é…ç½®"><a href="#1-3-XML-é…ç½®" class="headerlink" title="1.3 XML é…ç½®"></a>1.3 XML é…ç½®</h3><p><code>mybatis-config.xml</code> æ ¸å¿ƒé…ç½®æ–‡ä»¶</p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">"1.0"</span> encoding=<span class="string">"UTF-8"</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">configuration</span></span></span><br><span class="line"><span class="meta">  <span class="keyword">PUBLIC</span> <span class="string">"-//mybatis.org//DTD Config 3.0//EN"</span></span></span><br><span class="line"><span class="meta">  <span class="string">"http://mybatis.org/dtd/mybatis-3-config.dtd"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">"development"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">"development"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">"JDBC"</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">"POOLED"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driver"</span> <span class="attr">value</span>=<span class="string">"${driver}"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"url"</span> <span class="attr">value</span>=<span class="string">"${url}"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"${username}"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"${password}"</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">environments</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">"org/mybatis/example/BlogMapper.xml"</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p>æ¯ä¸€ä¸ªmapperæ–‡ä»¶éƒ½éœ€è¦åœ¨ <code>mybatis-config.xml</code> ä¸­æ³¨å†Œ</p>
<h3 id="1-4-ç¼–å†™Mapperæ–‡ä»¶"><a href="#1-4-ç¼–å†™Mapperæ–‡ä»¶" class="headerlink" title="1.4 ç¼–å†™Mapperæ–‡ä»¶"></a>1.4 ç¼–å†™Mapperæ–‡ä»¶</h3><p>å®šä¹‰ä¸€ä¸ª Mapper æ¥å£ï¼Œæ‰§è¡Œæ•°æ®åº“çš„æŸ¥è¯¢æ“ä½œ</p>
<p><code>PersonMapper.xml</code></p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">PersonMapper</span> {</span><br><span class="line">    <span class="keyword">public</span> Person <span class="title function_">getPersonById</span><span class="params">(Integer personId)</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">"1.0"</span> encoding=<span class="string">"UTF-8"</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span></span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">"-//mybatis.org//DTD Mapper 3.0//EN"</span></span></span><br><span class="line"><span class="meta">        <span class="string">"http://mybatis.org/dtd/mybatis-3-mapper.dtd"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"com.qing.TestMyBatis.mapper.PersonMapper"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getPersonById"</span> <span class="attr">resultType</span>=<span class="string">"com.qing.TestMyBatis.entity.Person"</span> <span class="attr">parameterType</span>=<span class="string">"Integer"</span>&gt;</span></span><br><span class="line">        select * from person where personId = #{personId}</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p><code>namespace</code> ç”¨äºç»‘å®šä¸€ä¸ª Mapper æ¥å£ï¼Œ<code>id</code> å¯¹åº”åŸæ¥æ–¹æ³•å</p>
<p><code>resultMap,resultType</code> è¿”å›çš„ç»“æœé›†ï¼Œå‰è€…è¿”å›å¤šä¸ªï¼Œåè€…è¿”å›å•ä¸ªï¼Œå€¼ä¸ºå®ä½“ç±»(é›†åˆä¹Ÿæ˜¯)ï¼Œæ³¨æ„è·¯å¾„</p>
<p><code>parameterType</code> è¾“å…¥çš„å‚æ•°ç±»å‹ï¼Œ<code>#{personId}</code> è¡¨ç¤ºè¾“å…¥çš„å‚æ•°ï¼Œè·Ÿæ–¹æ³•çš„å‚æ•°åå¯¹åº”</p>
<p>åŸæ¥éœ€è¦å®ç° Mapper æ¥å£ï¼Œç°åœ¨åªéœ€è¦åœ¨ xml æ–‡ä»¶ä¸­é…ç½®å³å¯</p>
<h2 id="2-ä¸‡èƒ½-Map"><a href="#2-ä¸‡èƒ½-Map" class="headerlink" title="2 ä¸‡èƒ½ Map"></a>2 ä¸‡èƒ½ Map</h2><p>ç»™ Dao ä¼ å‚çš„æ—¶å€™ï¼Œå¦‚æœ <code>parameterType</code> æ˜¯ä¸€ä¸ªå®ä½“ç±»ï¼Œå°±å¿…é¡»è¦æ„é€ å®Œæ•´çš„å¯¹è±¡ä½œä¸ºå‚æ•°ï¼Œæˆ–è€…å†™ä¸åŒçš„æ„é€ æ–¹æ³•ï¼ŒMapç±»å‹å¾ˆè´´å¿ƒçš„è§£å†³äº†è¿™ä¸€éš¾é¢˜ã€‚</p>
<p>ç®€å•åº”ç”¨</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addPerson</span><span class="params">()</span>{</span><br><span class="line">    <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> MyBatisUtil.getSqlSession();</span><br><span class="line">    <span class="type">PersonMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> sqlSession.getMapper(PersonMapper.class);</span><br><span class="line">    Map&lt;String, Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    map.put(<span class="string">"id"</span>, <span class="number">6</span>);    <span class="comment">// mapä¸­çš„é”®å¯ä»¥éšæ„è®¾ç½®åå­—ï¼Œå¯ä»¥ä¸éœ€è¦ä¸€ä¸€å¯¹åº”</span></span><br><span class="line">    map.put(<span class="string">"hometown"</span>, <span class="string">"shandong"</span>);</span><br><span class="line">    <span class="type">Integer</span> <span class="variable">n</span> <span class="operator">=</span> mapper.save(map);</span><br><span class="line">    sqlSession.commit();</span><br><span class="line">    sqlSession.close();</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">"save"</span> <span class="attr">parameterType</span>=<span class="string">"map"</span>&gt;</span></span><br><span class="line">    insert bank.person(personId, address) VALUE (#{id},#{hometown})</span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p>å½“å®ä½“ç±»çš„å±æ€§è¿‡å¤šï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨ map</p>
<h2 id="3-æ¨¡ç³ŠæŸ¥è¯¢"><a href="#3-æ¨¡ç³ŠæŸ¥è¯¢" class="headerlink" title="3 æ¨¡ç³ŠæŸ¥è¯¢"></a>3 æ¨¡ç³ŠæŸ¥è¯¢</h2><p>æ–¹å¼ä¸€ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;select id=<span class="string">"getPersonLike"</span> resultType=<span class="string">"com.qing.TestMyBatis.entity.Person"</span>&gt;</span><br><span class="line">    select * from person where name like <span class="title function_">concat</span><span class="params">(<span class="string">'%'</span>,#{name},<span class="string">'%'</span>)</span></span><br><span class="line">&lt;/select&gt;</span><br></pre></td></tr></tbody></table></figure>

<p>æ–¹å¼äºŒï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Person&gt; list = mapper.getPersonLike(<span class="string">"%q%"</span>);</span><br></pre></td></tr></tbody></table></figure>

<h2 id="4-MyBatis-XMLé…ç½®æ–‡ä»¶"><a href="#4-MyBatis-XMLé…ç½®æ–‡ä»¶" class="headerlink" title="4 MyBatis XMLé…ç½®æ–‡ä»¶"></a>4 MyBatis XMLé…ç½®æ–‡ä»¶</h2><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">"1.0"</span> encoding=<span class="string">"UTF-8"</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">configuration</span></span></span><br><span class="line"><span class="meta">  <span class="keyword">PUBLIC</span> <span class="string">"-//mybatis.org//DTD Config 3.0//EN"</span></span></span><br><span class="line"><span class="meta">  <span class="string">"http://mybatis.org/dtd/mybatis-3-config.dtd"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">"development"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">"development"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">"JDBC"</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">"POOLED"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driver"</span> <span class="attr">value</span>=<span class="string">"${driver}"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"url"</span> <span class="attr">value</span>=<span class="string">"${url}"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"${username}"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"${password}"</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">environments</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">"org/mybatis/example/BlogMapper.xml"</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<ul>
<li><p><code>environment</code> ç¯å¢ƒ</p>
<p>MyBatis å¯ä»¥é…ç½®æˆé€‚åº”å¤šç§ç¯å¢ƒï¼Œä½†æ¯ä¸ª SqlSessionFactory å®ä¾‹åªèƒ½é€‰æ‹©ä¸€ç§ç¯å¢ƒ</p>
</li>
<li><p><code>transactionManager</code> äº‹åŠ¡ç®¡ç†å™¨</p>
<p>MyBatis é»˜è®¤äº‹åŠ¡ç®¡ç†å™¨æ˜¯ JDBC</p>
</li>
<li><p><code>dataSource</code> æ•°æ®æº</p>
<p>ä½¿ç”¨ properties å±æ€§æ¥å®ç°å¼•ç”¨é…ç½®æ–‡ä»¶</p>
</li>
</ul>
<p>åœ¨å®é™…å¼€å‘ä¸­ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä¼šå°†æ•°æ®åº“çš„é…ç½®å•ç‹¬æˆ¿å­å•Š<code>db.properties</code>ä¸­ï¼Œç„¶åå¼•å…¥åˆ°<code>mybatis-config.xml</code>ä¸­</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">driver=com.mysql.cj.jdbc.Driver</span><br><span class="line">url=jdbc:mysql://localhost:3306/{table_name}?useSSL=true&amp;useUnicode=true&amp;characterEncoding=UTF-8</span><br><span class="line">username=xxxxx</span><br><span class="line">password=xxxxx</span><br></pre></td></tr></tbody></table></figure>

<p>ç„¶ååœ¨<code>mybatis-config.xml</code>æ·»åŠ ï¼š</p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span> <span class="attr">resource</span>=<span class="string">"db.properties"</span>/&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<h3 id="4-2-ç±»å‹åˆ«å"><a href="#4-2-ç±»å‹åˆ«å" class="headerlink" title="4.2 ç±»å‹åˆ«å"></a>4.2 ç±»å‹åˆ«å</h3><p>ç±»å‹åˆ«åæ˜¯ä¸º Java ç±»å‹è®¾ç½®çš„ä¸€ä¸ªçŸ­çš„åå­—ã€‚å®ƒä¹‹å’Œ XML é…ç½®æœ‰å…³ï¼Œå­˜åœ¨çš„æ„ä¹‰ä»…åœ¨äºç”¨æ¥å‡å°‘ç±»å®Œå…¨é™å®šåçš„å†—ä½™ã€‚</p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">typeAlias</span> <span class="attr">type</span>=<span class="string">"com.qing.TestMyBatis.entity.Person"</span> <span class="attr">alias</span>=<span class="string">"Person"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p>æ³¨æ„ï¼š</p>
<ul>
<li>XML æ–‡ä»¶æœ‰ä¸¥æ ¼çš„é¡ºåº</li>
<li>åˆ«åå†™åœ¨ <code>mybatis-config.xml</code> ä¸­</li>
</ul>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">"com.qing.TestMyBatis.entity"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p>ä½¿ç”¨åŒ…åæ˜ å°„ï¼Œå¯ä»¥æ‰«æåˆ°åŒ…ä¸‹çš„æ‰€æœ‰å®ä½“ç±»ï¼Œåˆ«åé»˜è®¤ä¸ºç±»åé¦–å­—æ¯å°å†™</p>
<h3 id="4-3-æ˜ å°„å™¨"><a href="#4-3-æ˜ å°„å™¨" class="headerlink" title="4.3 æ˜ å°„å™¨"></a>4.3 æ˜ å°„å™¨</h3><p>ä½¿ç”¨ä¸åŒæ˜ å°„å™¨è¿›è¡Œæ³¨å…¥ç»‘å®šï¼›</p>
<p>ç¬¬ä¸€ç§ï¼š</p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">"com/qing/TestMyBatis/mapper/PerMapper.xml"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p>ç¬¬äºŒç§ï¼šä½¿ç”¨ class æ–‡ä»¶ç»‘å®šæ³¨å†Œ</p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">class</span>=<span class="string">"com.qing.TestMyBatis.mapper.PersonMapper"</span>/&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p>classå±æ€§çš„æ³¨æ„ç‚¹ï¼š</p>
<ul>
<li>æ¥å£å’Œä»–çš„ Mapper æ–‡ä»¶å¿…é¡»åŒå</li>
<li>æ¥å£å’Œä»–çš„ Mapper é…ç½®æ–‡ä»¶å¿…é¡»åœ¨åŒä¸€ä¸ªåŒ…ä¸‹</li>
</ul>
<p>ç¬¬ä¸‰ç§ï¼šä½¿ç”¨åŒ…æ‰«æè¿›è¡Œæ³¨å†Œç»‘å®š</p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">"com.qing.TestMyBatis.mapper.PersonMapper"</span>/&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p>æ³¨æ„ç‚¹ä¸ç¬¬äºŒç§ç›¸åŒ</p>
<h3 id="4-4-ResultMap"><a href="#4-4-ResultMap" class="headerlink" title="4.4 ResultMap"></a>4.4 ResultMap</h3><blockquote>
<p>ResultMap å…ƒç´ æ˜¯ MyBatis ä¸­æœ€é‡è¦æœ€å¼ºå¤§çš„å…ƒç´ </p>
</blockquote>
<p>å½“Mapperæ–‡ä»¶ä¸­å®ä½“ç±»çš„å±æ€§åå’Œè¡¨ä¸­çš„å­—æ®µåä¸ä¸€è‡´æ—¶ï¼Œå°±ä¼šå‘ç”Ÿè¯»å–é”™è¯¯</p>
<p><strong>å› ä¸º MyBatis æ˜¯æ ¹æ®å­—æ®µåå»æŸ¥æ‰¾å¯¹åº”çš„<code>getter()</code>å’Œ<code>setter()</code>æ–¹æ³•ï¼Œæ‰¾ä¸åˆ°å°±ä¼šè¿”å› null</strong></p>
<p><strong>è§£å†³å±æ€§åå’Œå­—æ®µåä¸ä¸€è‡´çš„é—®é¢˜</strong></p>
<p>è§£å†³åŠæ³•ï¼š</p>
<ol>
<li>ç»™å­—æ®µèµ·åˆ«å</li>
<li><code>ResultMap</code></li>
</ol>
<p><code>ResultMap</code>ï¼šç»“æœé›†æ˜ å°„</p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">"Person"</span> <span class="attr">type</span>=<span class="string">"com.qing.TestMyBatis.entity.Person"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"personId"</span> <span class="attr">property</span>=<span class="string">"id"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"name"</span> <span class="attr">property</span>=<span class="string">"name"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"address"</span> <span class="attr">property</span>=<span class="string">"add"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getPersonById"</span> <span class="attr">resultType</span>=<span class="string">"Person"</span> <span class="attr">parameterType</span>=<span class="string">"Integer"</span>&gt;</span></span><br><span class="line">    select * from person where personId = #{id}</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p>éœ€è¦æ³¨æ„ï¼Œ<code>ResultMap</code> ä¸­çš„ <code>column</code> å’Œ <code>property</code> ä¸è¦ç”¨æ··äº†ï¼ï¼ï¼**<code>column</code> ä»£è¡¨çš„æ˜¯æ•°æ®åº“åˆ—åï¼Œè€Œ <code>property</code> æ˜¯å®ä½“ç±»çš„å±æ€§å**</p>
<h2 id="7-æ—¥å¿—"><a href="#7-æ—¥å¿—" class="headerlink" title="7 æ—¥å¿—"></a>7 æ—¥å¿—</h2><p>å¦‚æœæ•°æ®åº“å‡ºç°å¼‚å¸¸ï¼Œæˆ‘ä»¬éœ€è¦æ’é”™ã€‚æ—¥å¿—å°±æ˜¯æœ€å¥½çš„åŠ©æ‰‹</p>
<h3 id="7-1-STDOUT-LOGGING"><a href="#7-1-STDOUT-LOGGING" class="headerlink" title="7.1 STDOUT_LOGGING"></a>7.1 STDOUT_LOGGING</h3><p>MyBatiså®˜æ–¹è‡ªå¸¦çš„æ—¥å¿—æ¡†æ¶ã€‚åœ¨æ ¸å¿ƒé…ç½®æ–‡ä»¶ä¸­é…ç½®è¯¥æ—¥å¿—ï¼š</p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">settings</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">"logImpl"</span> <span class="attr">value</span>=<span class="string">"STDOUT_LOGGING"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<h3 id="7-2-Log4j"><a href="#7-2-Log4j" class="headerlink" title="7.2 Log4j"></a>7.2 Log4j</h3><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/log4j/log4j --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.17<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">#å°†ç­‰çº§ä¸ºDEBUGçš„æ—¥å¿—ä¿¡æ¯è¾“å‡ºåˆ°consoleå’Œfileè¿™ä¸¤ä¸ªç›®çš„åœ°ï¼Œconsoleå’Œfileçš„å®šä¹‰åœ¨ä¸‹é¢çš„ä»£ç </span><br><span class="line">log4j.rootLogger=DEBUG,console,file</span><br><span class="line"></span><br><span class="line">#æ§åˆ¶å°è¾“å‡ºçš„ç›¸å…³è®¾ç½®</span><br><span class="line">log4j.appender.console = org.apache.log4j.ConsoleAppender</span><br><span class="line">log4j.appender.console.Target = System.out</span><br><span class="line">log4j.appender.console.Threshold=DEBUG</span><br><span class="line">log4j.appender.console.layout = org.apache.log4j.PatternLayout</span><br><span class="line">log4j.appender.console.layout.ConversionPattern=[%c]-%m%n</span><br><span class="line"></span><br><span class="line">#æ–‡ä»¶è¾“å‡ºçš„ç›¸å…³è®¾ç½®</span><br><span class="line">log4j.appender.file = org.apache.log4j.RollingFileAppender</span><br><span class="line">log4j.appender.file.File=./log/qing.log</span><br><span class="line">log4j.appender.file.MaxFileSize=10mb</span><br><span class="line">log4j.appender.file.Threshold=DEBUG</span><br><span class="line">log4j.appender.file.layout=org.apache.log4j.PatternLayout</span><br><span class="line">log4j.appender.file.layout.ConversionPattern=[%p][%d{yy-MM-dd}][%c]%m%n</span><br><span class="line"></span><br><span class="line">#æ—¥å¿—è¾“å‡ºçº§åˆ«</span><br><span class="line">log4j.logger.org.mybatis=DEBUG</span><br><span class="line">log4j.logger.java.sql=DEBUG</span><br><span class="line">log4j.logger.java.sql.Statement=DEBUG</span><br><span class="line">log4j.logger.java.sql.ResultSet=DEBUG</span><br><span class="line">log4j.logger.java.sql.PreparedStatement=DEBUG</span><br></pre></td></tr></tbody></table></figure>

<p>æ ¸å¿ƒé…ç½®æ–‡ä»¶ï¼š</p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">"logImpl"</span> <span class="attr">value</span>=<span class="string">"Log4j"</span>/&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p><img src="/../images/Mybatis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image_MkQjlNyeuN.png"></p>
<h2 id="8-ä½¿ç”¨æ³¨è§£å¼€å‘"><a href="#8-ä½¿ç”¨æ³¨è§£å¼€å‘" class="headerlink" title="8 ä½¿ç”¨æ³¨è§£å¼€å‘"></a>8 ä½¿ç”¨æ³¨è§£å¼€å‘</h2><p>æ³¨è§£ä½¿ç”¨æ¡ä»¶ï¼š</p>
<ul>
<li>æ¥å£ä¸ XML é…ç½®æ–‡ä»¶å¿…é¡»åŒå</li>
<li>æ˜ å°„å™¨ä½¿ç”¨ class</li>
</ul>
<p><code>@Param()</code></p>
<ul>
<li>åŸºæœ¬ç±»å‹å‰éƒ½è¦åŠ ä¸Šè¯¥æ³¨è§£</li>
<li>å¼•ç”¨ç±»å‹ä¸ç”¨åŠ </li>
</ul>
<p><strong>CRUD</strong></p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Select("select * from person where name = #{name}")</span></span><br><span class="line">List&lt;Person&gt; <span class="title function_">getPerByName</span><span class="params">(<span class="meta">@Param("name")</span>String name)</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Delete("delete from person where personId = #{id}")</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">deletePerson</span><span class="params">(<span class="meta">@Param("id")</span> <span class="type">int</span> id)</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Update("update Person set name = #{name},address = #{add} where personId = #{id}")</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">UpdatePerson</span><span class="params">(Person person)</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Insert("insert into person(personId,name,address) value(#{id},#{name},#{add})")</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">addPerson</span><span class="params">(Person person)</span>;</span><br></pre></td></tr></tbody></table></figure>

<p><strong>Tips</strong>ï¼š<code>#{}</code> å’Œ <code>${}</code> çš„åŒºåˆ«</p>
<p><code>#{}</code> å¯ä»¥é˜²æ­¢ sql æ³¨å…¥ï¼Œèƒ½ç”¨åˆ™ç”¨ï¼Œç±»ä¼¼äº <code>PrepareStatement</code></p>
<p><code>${}</code> ä¸å¯ä»¥é˜²æ­¢ sql æ³¨å…¥ï¼Œæ—©æœŸä½¿ç”¨</p>
<h2 id="9-å¤šè¡¨æŸ¥è¯¢"><a href="#9-å¤šè¡¨æŸ¥è¯¢" class="headerlink" title="9 å¤šè¡¨æŸ¥è¯¢"></a>9 å¤šè¡¨æŸ¥è¯¢</h2><p><strong>[å›é¡¾]MySQL å¤šè¡¨æŸ¥è¯¢</strong></p>
<ul>
<li>å­æŸ¥è¯¢</li>
<li>è”è¡¨æŸ¥è¯¢</li>
</ul>
<p>MyBatis å¤šè¡¨æŸ¥è¯¢</p>
<p><strong>å…³é”®å­—</strong></p>
<ul>
<li><code>column</code> å¯¹åº”æ•°æ®åº“ä¸­è¡¨çš„å­—æ®µ</li>
<li><code>property</code> å¯¹åº”å®ä½“ç±»ä¸­çš„å±æ€§</li>
<li><code>association</code> å½“å±æ€§ä¸ºå¼•ç”¨ç±»å‹æ—¶ä½¿ç”¨ï¼Œè¡¨ç¤ºå¯¹è±¡<ul>
<li><code>javaType</code> è¡¨ç¤ºå±æ€§å¯¹åº”çš„å¼•ç”¨ç±»å‹</li>
</ul>
</li>
<li><code>collection</code> å½“å±æ€§ä¸ºé›†åˆæ—¶ä½¿ç”¨ï¼Œè¡¨ç¤ºé›†åˆ<ul>
<li><code>ofType</code> è¡¨ç¤ºé›†åˆçš„æ³›å‹ä¿¡æ¯</li>
</ul>
</li>
</ul>
<p>è¿™é‡Œå¼•å…¥ä¸¤å¼ è¡¨ï¼š<code>teacher&amp;student</code></p>
<p><img src="/../images/Mybatis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image_46ggW4rKS0.png"></p>
<p>å…¶ä¸­ <code>student</code> çš„ id ä¸ <code>teacher</code> çš„ id äº’ä¸ºå¤–é”®</p>
<h3 id="9-1-å¤šå¯¹ä¸€"><a href="#9-1-å¤šå¯¹ä¸€" class="headerlink" title="9.1 å¤šå¯¹ä¸€"></a>9.1 å¤šå¯¹ä¸€</h3><p>å®ä¾‹å¼•å…¥ï¼šå¤šä¸ªå­¦ç”Ÿå¯¹åº”ä¸€ä¸ªè€å¸ˆ</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Student</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> id;</span><br><span class="line">    <span class="keyword">public</span> String name;</span><br><span class="line">    <span class="keyword">public</span> Teacher teacher;     <span class="comment">// å®ä½“ç±»ä¸­å«æœ‰å¯¹è±¡</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p><strong>æŒ‰ç…§æŸ¥è¯¢åµŒå¥—å¤„ç†(ç±»ä¼¼äºå­æŸ¥è¯¢)</strong></p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getStudent"</span> <span class="attr">resultMap</span>=<span class="string">"sonSelect"</span>&gt;</span></span><br><span class="line">    select * from student</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">"sonSelect"</span> <span class="attr">type</span>=<span class="string">"com.qing.TestMyBatis.entity.Student"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"id"</span> <span class="attr">property</span>=<span class="string">"id"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"name"</span> <span class="attr">property</span>=<span class="string">"name"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">"teacher"</span> <span class="attr">column</span>=<span class="string">"tid"</span> <span class="attr">select</span>=<span class="string">"getTeacher"</span> <span class="attr">javaType</span>=<span class="string">"com.qing.TestMyBatis.entity.Teacher"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getTeacher"</span> <span class="attr">resultType</span>=<span class="string">"com.qing.TestMyBatis.entity.Teacher"</span>&gt;</span></span><br><span class="line">    select * from teacher where id = #{tid}</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p><strong>æŒ‰ç…§ç»“æœåµŒå¥—å¤„ç†(ç±»ä¼¼äºè”è¡¨æŸ¥è¯¢)</strong></p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getStudent"</span> <span class="attr">resultMap</span>=<span class="string">"join"</span>&gt;</span></span><br><span class="line">    select s.id,s.name,s.tid,t.name tname,t.id tid from student s,teacher t where t.id = s.tid</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">"join"</span> <span class="attr">type</span>=<span class="string">"com.qing.TestMyBatis.entity.Student"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"id"</span> <span class="attr">property</span>=<span class="string">"id"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"name"</span> <span class="attr">property</span>=<span class="string">"name"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">"teacher"</span> <span class="attr">javaType</span>=<span class="string">"com.qing.TestMyBatis.entity.Teacher"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"name"</span> <span class="attr">column</span>=<span class="string">"tname"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"id"</span> <span class="attr">column</span>=<span class="string">"tid"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">association</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p><code>resultMap</code> ç”¨äºå¤„ç† teacher å±æ€§</p>
<p>æŸ¥è¯¢ç»“æœ</p>
<p><img src="/../images/Mybatis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image_20240905155202694.png"></p>
<p>æ³¨æ„ï¼šåˆ—èµ·åˆ«åä¸€å®šä¹‹å <code>column="tname"</code> è¦ç”¨åˆ«åï¼Œåˆ—åå†²çªä¹Ÿå¯ä»¥ä½¿ç”¨åˆ«åè§£å†³</p>
<h3 id="9-2-ä¸€å¯¹å¤š"><a href="#9-2-ä¸€å¯¹å¤š" class="headerlink" title="9.2 ä¸€å¯¹å¤š"></a>9.2 ä¸€å¯¹å¤š</h3><p>å®ä¾‹å¼•å…¥ï¼šä¸€ä¸ªè€å¸ˆå¯¹å¤šä¸ªå­¦ç”Ÿ</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Teacher</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> id;</span><br><span class="line">    <span class="keyword">public</span> String name;</span><br><span class="line">    List&lt;Student&gt; students;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p><strong>æŒ‰ç…§ç»“æœåµŒå¥—å¤„ç†(ç±»ä¼¼äºè”è¡¨æŸ¥è¯¢)</strong></p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getTeacher"</span> <span class="attr">resultMap</span>=<span class="string">"map"</span>&gt;</span></span><br><span class="line">    select s.id sid,s.name sname,t.id tid,t.name tname,s.tid stid</span><br><span class="line">    from student s,teacher t</span><br><span class="line">    where s.tid = t.id and  t.id = #{id}</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">"map"</span> <span class="attr">type</span>=<span class="string">"Teacher"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"tid"</span> <span class="attr">property</span>=<span class="string">"id"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"tname"</span> <span class="attr">property</span>=<span class="string">"name"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">"students"</span> <span class="attr">ofType</span>=<span class="string">"Student"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"sid"</span> <span class="attr">property</span>=<span class="string">"id"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"sname"</span> <span class="attr">property</span>=<span class="string">"name"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"stid"</span> <span class="attr">property</span>=<span class="string">"tid"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p><code>resultMap</code> ç”¨äºå¤„ç† students å±æ€§</p>
<p><strong>è¸©å‘ï¼šcolumn ä¸­å†™åˆ—åæˆ–åˆ—åçš„åˆ«åï¼Œproperty ä¸­å†™å±æ€§åï¼ŒäºŒè€…åˆ«ææ··äº†ï¼</strong></p>
<p><strong>æŒ‰ç…§æŸ¥è¯¢åµŒå¥—å¤„ç†(ç±»ä¼¼äºå­æŸ¥è¯¢)</strong></p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getTeacher"</span> <span class="attr">resultMap</span>=<span class="string">"Teach"</span>&gt;</span></span><br><span class="line">    select * from teacher where id = #{id}</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">"Teach"</span> <span class="attr">type</span>=<span class="string">"Teacher"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--        é€šè¿‡æŸ¥è¯¢åˆ°çš„teacherçš„idå»æŸ¥studentçš„tid--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">"students"</span> <span class="attr">javaType</span>=<span class="string">"ArrayList"</span> <span class="attr">select</span>=<span class="string">"getStudentByTeacherId"</span> <span class="attr">column</span>=<span class="string">"id"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getStudentByTeacherId"</span> <span class="attr">resultType</span>=<span class="string">"Student"</span>&gt;</span></span><br><span class="line">    select * from student where tid = #{tid}</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p>æ³¨æ„ <code>collection</code> ä¸­çš„ <code>javaType</code> ä¸º<strong>ArrayList</strong></p>
<p>æŸ¥è¯¢ç»“æœ</p>
<p><img src="/../images/Mybatis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20240905155136614.png"></p>
<p>æŸ¥è¯¢å‡ºæ¥çš„ teacher çš„ id æ˜¯å¼‚å¸¸çš„</p>
<p>æ€»ç»“ï¼š</p>
<ul>
<li><code>association</code> è¡¨ç¤ºä¸€ä¸ªå¤æ‚çš„è”åˆï¼Œç”¨äºå¤šå¯¹ä¸€ï¼›</li>
<li><code>collection</code> è¡¨ç¤ºä¸€ä¸ªå¤æ‚çš„é›†åˆï¼Œç”¨äºä¸€å¯¹å¤šï¼›</li>
</ul>
<h2 id="10-åŠ¨æ€-SQL"><a href="#10-åŠ¨æ€-SQL" class="headerlink" title="10 åŠ¨æ€ SQL"></a>10 åŠ¨æ€ SQL</h2><p>ä»€ä¹ˆæ˜¯åŠ¨æ€ SQLï¼ŸåŠ¨æ€ SQL å°±æ˜¯æ ¹æ®ä¸åŒçš„æ¡ä»¶ç”Ÿæˆä¸åŒçš„ SQL è¯­å¥</p>
<p>å¯ä»¥çœ‹ä¸€ä¸‹å®˜æ–¹è§£é‡Šï¼š</p>
<blockquote>
<p>åŠ¨æ€ SQL æ˜¯ MyBatis çš„å¼ºå¤§ç‰¹æ€§ä¹‹ä¸€ã€‚å¦‚æœä½ ä½¿ç”¨è¿‡ JDBC æˆ–å…¶å®ƒç±»ä¼¼çš„æ¡†æ¶ï¼Œä½ åº”è¯¥èƒ½ç†è§£æ ¹æ®ä¸åŒæ¡ä»¶æ‹¼æ¥ SQL è¯­å¥æœ‰å¤šç—›è‹¦ï¼Œä¾‹å¦‚æ‹¼æ¥æ—¶è¦ç¡®ä¿ä¸èƒ½å¿˜è®°æ·»åŠ å¿…è¦çš„ç©ºæ ¼ï¼Œè¿˜è¦æ³¨æ„å»æ‰åˆ—è¡¨æœ€åä¸€ä¸ªåˆ—åçš„é€—å·ã€‚åˆ©ç”¨åŠ¨æ€ SQLï¼Œå¯ä»¥å½»åº•æ‘†è„±è¿™ç§ç—›è‹¦ã€‚</p>
</blockquote>
<p><strong>å°æŠ€å·§</strong>ï¼š<strong>UUID</strong></p>
<p>åœ¨å®é™…ä¸šåŠ¡ä¸­ï¼Œæ•°æ®åº“ä¸­è¡¨çš„ ID å¹¶ä¸æ˜¯æŒ‰é¡ºåºç”Ÿæˆçš„ï¼Œè€Œæ˜¯ä½¿ç”¨ UUID éšæœºç”Ÿæˆçš„ï¼Œè¿™æ ·å°±å¯ä»¥ä¿è¯å”¯ä¸€æ€§ã€‚å› ä¸ºè‹¥æ˜¯æŒ‰é¡ºåºç”Ÿæˆï¼Œé‚£ä¹ˆåˆ æ‰ä¸€ä¸ªæ•°ä¹‹åé¡ºåºå°±æ‰“ä¹±äº†ï¼Œè¿™æ˜¯ innodbæ…¢çš„åŸå› ã€‚</p>
<p><strong><code>mapUnderscoreToCamelCase</code></strong></p>
<p>æ˜¯å¦å¼€å¯è‡ªåŠ¨é©¼å³°å‘½åè§„åˆ™æ˜ å°„ï¼Œå³ä»ç»å…¸æ•°æ®åº“åˆ—ååˆ°ç»å…¸ Java åçš„ç±»ä¼¼æ˜ å°„</p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">settings</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">"mapUnderscoreToCamelCase"</span> <span class="attr">value</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<h3 id="10-1-å¸¸ç”¨æ ‡ç­¾"><a href="#10-1-å¸¸ç”¨æ ‡ç­¾" class="headerlink" title="10.1 å¸¸ç”¨æ ‡ç­¾"></a>10.1 å¸¸ç”¨æ ‡ç­¾</h3><p>ç¼–å†™å®ä½“ç±»</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Blog</span> {</span><br><span class="line">    <span class="keyword">private</span> String id;</span><br><span class="line">    <span class="keyword">private</span> String title;</span><br><span class="line">    <span class="keyword">private</span> String author;</span><br><span class="line">    <span class="keyword">private</span> Date createTime;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> views;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h3 id="10-2-IF"><a href="#10-2-IF" class="headerlink" title="10.2 IF"></a>10.2 IF</h3><p>éœ€æ±‚ï¼šæŸ¥æ‰¾ Blogï¼Œå°†ä¼ å…¥çš„å‚æ•°å…¨éƒ¨ç”¨äºæŸ¥æ‰¾</p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"queryBlogIF"</span> <span class="attr">parameterType</span>=<span class="string">"map"</span> <span class="attr">resultType</span>=<span class="string">"com.qing.TestMyBatis.entity.Blog"</span>&gt;</span></span><br><span class="line">    select * from blog where 1=1</span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"title != null"</span>&gt;</span></span><br><span class="line">        and title = #{title}</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"author != null"</span>&gt;</span></span><br><span class="line">        and author = #{author}    </span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p>ä¼˜åŒ–</p>
<p>åœ¨ä¸Šé¢çš„ sql ä»£ç ä¸­ï¼Œæˆ‘ä»¬æ·»åŠ äº†ä¸€è¡Œ <code>where 1=1</code>ï¼Œè¿™çœ‹èµ·æ¥ååˆ†åˆ«æ‰­ï¼Œæœ‰æ²¡æœ‰æ›´å¥½çš„è§£å†³åŠæ³•ï¼Ÿ</p>
<h3 id="10-3-where"><a href="#10-3-where" class="headerlink" title="10.3 where"></a>10.3 where</h3><p>MyBatis æä¾›äº†ä¸€ä¸ªç®€å•ä¸”é€‚åˆå¤§å¤šæ•°åœºæ™¯çš„è§£å†³åŠæ³•ï¼šwhere æ ‡ç­¾</p>
<blockquote>
<p><em>where</em> å…ƒç´ åªä¼šåœ¨å­å…ƒç´ è¿”å›ä»»ä½•å†…å®¹çš„æƒ…å†µä¸‹æ‰æ’å…¥ â€œWHEREâ€ å­å¥ã€‚è€Œä¸”ï¼Œè‹¥å­å¥çš„å¼€å¤´ä¸º â€œANDâ€ æˆ– â€œORâ€ï¼Œ<em>where</em> å…ƒç´ ä¹Ÿä¼šå°†å®ƒä»¬å»é™¤ã€‚</p>
</blockquote>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"queryBlogIF"</span> <span class="attr">parameterType</span>=<span class="string">"map"</span> <span class="attr">resultType</span>=<span class="string">"com.qing.TestMyBatis.entity.Blog"</span>&gt;</span></span><br><span class="line">    select * from blog</span><br><span class="line">    <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"title != null"</span>&gt;</span></span><br><span class="line">            and title = #{title}</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"author != null"</span>&gt;</span></span><br><span class="line">            and author = #{author}</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p>ä¸ <code>where</code> ä½œç”¨ç±»ä¼¼çš„è¿˜æœ‰ <code>set</code> å…³é”®å­—</p>
<h3 id="10-4-set"><a href="#10-4-set" class="headerlink" title="10.4 set"></a>10.4 set</h3><blockquote>
<p><em>set</em> å…ƒç´ ä¼šåŠ¨æ€åœ°åœ¨è¡Œé¦–æ’å…¥ SET å…³é”®å­—ï¼Œå¹¶ä¼šåˆ æ‰é¢å¤–çš„é€—å·ï¼ˆè¿™äº›é€—å·æ˜¯åœ¨ä½¿ç”¨æ¡ä»¶è¯­å¥ç»™åˆ—èµ‹å€¼æ—¶å¼•å…¥çš„ï¼‰</p>
</blockquote>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">"updateBlog"</span> <span class="attr">parameterType</span>=<span class="string">"map"</span>&gt;</span></span><br><span class="line">    update Blog</span><br><span class="line">    <span class="tag">&lt;<span class="name">set</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"title != null"</span>&gt;</span></span><br><span class="line">            title = #{title},</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"author != null"</span>&gt;</span></span><br><span class="line">            author = #{author},</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"views!=null"</span>&gt;</span></span><br><span class="line">            views = #{views},</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">    where id = #{id}</span><br><span class="line"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<h3 id="10-5-trim"><a href="#10-5-trim" class="headerlink" title="10.5 trim"></a>10.5 trim</h3><p>trim å…ƒç´ å¯ä»¥è‡ªå®šä¹‰ç±»ä¼¼äº <em>where</em> å…ƒç´ åŠŸèƒ½çš„æ ‡ç­¾</p>
<p>å’Œ <em>where</em> å…ƒç´ ç­‰ä»·çš„è‡ªå®šä¹‰ trim å…ƒç´ ä¸ºï¼š</p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">trim</span> <span class="attr">prefix</span>=<span class="string">"WHERE"</span> <span class="attr">prefixOverrides</span>=<span class="string">"AND |OR "</span>&gt;</span></span><br><span class="line">  ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">trim</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p><em>prefixOverrides</em> å±æ€§ä¼šå¿½ç•¥é€šè¿‡ç®¡é“ç¬¦åˆ†éš”çš„æ–‡æœ¬åºåˆ—ï¼ˆæ³¨æ„æ­¤ä¾‹ä¸­çš„ç©ºæ ¼æ˜¯å¿…è¦çš„ï¼‰ã€‚ä¸Šè¿°ä¾‹å­ä¼šç§»é™¤æ‰€æœ‰ <em>prefixOverrides</em> å±æ€§ä¸­æŒ‡å®šçš„å†…å®¹ï¼Œå¹¶ä¸”æ’å…¥ <em>prefix</em> å±æ€§ä¸­æŒ‡å®šçš„å†…å®¹ã€‚</p>
<p>suffixOverrides è¡¨ç¤ºåç¼€</p>
<h3 id="10-6-chooseï¼Œwhenï¼Œotherwise"><a href="#10-6-chooseï¼Œwhenï¼Œotherwise" class="headerlink" title="10.6 chooseï¼Œwhenï¼Œotherwise"></a>10.6 chooseï¼Œwhenï¼Œotherwise</h3><p>ç±»ä¼¼äº Java ä¸­çš„ switch</p>
<p>éœ€æ±‚ï¼šä¼ å…¥äº† â€œtitleâ€ å°±æŒ‰ â€œtitleâ€ æŸ¥æ‰¾ï¼Œä¼ å…¥äº† â€œauthorâ€ å°±æŒ‰ â€œauthorâ€ æŸ¥æ‰¾</p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"testChoose"</span> <span class="attr">parameterType</span>=<span class="string">"map"</span> <span class="attr">resultType</span>=<span class="string">"com.qing.TestMyBatis.entity.Blog"</span>&gt;</span></span><br><span class="line">    select * from blog</span><br><span class="line">    <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">choose</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">when</span> <span class="attr">test</span>=<span class="string">"title != null"</span>&gt;</span></span><br><span class="line">                title like #{title}</span><br><span class="line">            <span class="tag">&lt;/<span class="name">when</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">when</span> <span class="attr">test</span>=<span class="string">"author!=null"</span>&gt;</span></span><br><span class="line">                author like #{author}</span><br><span class="line">            <span class="tag">&lt;/<span class="name">when</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">when</span> <span class="attr">test</span>=<span class="string">"views!=null"</span>&gt;</span></span><br><span class="line">                views = #{views}</span><br><span class="line">            <span class="tag">&lt;/<span class="name">when</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">otherwise</span>&gt;</span></span><br><span class="line">                views &gt; 5000</span><br><span class="line">            <span class="tag">&lt;/<span class="name">otherwise</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">choose</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p><strong>æ‰€è°“çš„åŠ¨æ€ SQLï¼Œæœ¬è´¨è¿˜æ˜¯ SQL è¯­å¥ï¼Œåªæ˜¯æˆ‘ä»¬å¯ä»¥åœ¨ sql å±‚é¢å»æ‰§è¡Œä¸€äº›é€»è¾‘ä»£ç </strong></p>
<h3 id="10-7-foreach"><a href="#10-7-foreach" class="headerlink" title="10.7 foreach"></a>10.7 foreach</h3><p>åŠ¨æ€ SQL çš„å¦ä¸€ä¸ªå¸¸ç”¨æ“ä½œéœ€æ±‚æ˜¯å¯¹ä¸€ä¸ªé›†åˆè¿›è¡Œéå†ï¼Œé€šå¸¸åœ¨æ„å»º IN æ¡ä»¶è¯­å¥çš„æ—¶å€™</p>
<p>è¯­æ³•ï¼š</p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"selectPostIn"</span> <span class="attr">resultType</span>=<span class="string">"domain.blog.Post"</span>&gt;</span></span><br><span class="line">  SELECT *</span><br><span class="line">  FROM POST P</span><br><span class="line">  <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">item</span>=<span class="string">"item"</span> <span class="attr">index</span>=<span class="string">"index"</span> <span class="attr">collection</span>=<span class="string">"list"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">open</span>=<span class="string">"ID in ("</span> <span class="attr">separator</span>=<span class="string">","</span> <span class="attr">close</span>=<span class="string">")"</span> <span class="attr">nullable</span>=<span class="string">"true"</span>&gt;</span></span><br><span class="line">          #{item}</span><br><span class="line">    <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span> </span><br></pre></td></tr></tbody></table></figure>

<p>å…¶ä¸­ï¼Œ<code>collection="list</code> çš„ list å±æ€§å¯ä»¥ç”¨ map ä½œæ˜ å°„</p>
<p>sqlï¼š<code>select * from blog where ID in (item1,item2,item3)</code></p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"TestForEach"</span> <span class="attr">resultType</span>=<span class="string">"com.qing.TestMyBatis.entity.Blog"</span>&gt;</span></span><br><span class="line">    select * from blog</span><br><span class="line">    <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">"list"</span> <span class="attr">index</span>=<span class="string">"index"</span> <span class="attr">item</span>=<span class="string">"item"</span> <span class="attr">open</span>=<span class="string">"ID in ("</span> <span class="attr">separator</span>=<span class="string">","</span> <span class="attr">close</span>=<span class="string">")"</span>&gt;</span></span><br><span class="line">            #{item}</span><br><span class="line">        <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<h3 id="10-8-SQL-ç‰‡æ®µ"><a href="#10-8-SQL-ç‰‡æ®µ" class="headerlink" title="10.8 SQL ç‰‡æ®µ"></a>10.8 SQL ç‰‡æ®µ</h3><p>SQL ç‰‡æ®µå°±æ˜¯å°† sql è¯­å¥ä¸­çš„å…¬å…±éƒ¨åˆ†æå–å‡ºæ¥ï¼Œæ–¹ä¾¿å¤ç”¨</p>
<p>è¯­æ³•ï¼š</p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">sql</span> <span class="attr">id</span>=<span class="string">"if-title-author"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"title != null"</span>&gt;</span></span><br><span class="line">        and title = #{title}</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"author != null"</span>&gt;</span></span><br><span class="line">        and author = #{author}</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">sql</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"queryBlogIF"</span> <span class="attr">parameterType</span>=<span class="string">"map"</span> <span class="attr">resultType</span>=<span class="string">"com.qing.TestMyBatis.entity.Blog"</span>&gt;</span></span><br><span class="line">    select * from blog</span><br><span class="line">    <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">"if-title-author"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p>æ³¨æ„äº‹é¡¹ï¼š</p>
<ul>
<li>æœ€å¥½åŸºäºå•è¡¨æ¥å®šä¹‰ SQL ç‰‡æ®µï¼Œå› ä¸ºæŸäº›å…³é”®å­—å¹¶ä¸æ˜¯æ‰€æœ‰è¡¨éƒ½æ”¯æŒ</li>
<li>ä¸è¦å­˜åœ¨ where æ ‡ç­¾</li>
</ul>
<h2 id="11-ç¼“å­˜"><a href="#11-ç¼“å­˜" class="headerlink" title="11 ç¼“å­˜"></a>11 ç¼“å­˜</h2><ul>
<li>ä»€ä¹ˆæ˜¯ç¼“å­˜<ul>
<li>å­˜åœ¨å†…å­˜ä¸­çš„ä¸´æ—¶æ•°æ®</li>
<li>å°†ç”¨æˆ·ç»å¸¸æŸ¥è¯¢çš„æ•°æ®æ”¾åœ¨å†…å­˜ä¸­ï¼Œç”¨æˆ·æŸ¥è¯¢æ•°æ®å°±å¯ä»¥ç›´æ¥ä»ç¼“å­˜ä¸­æŸ¥è¯¢ï¼Œä»è€Œæé«˜æŸ¥è¯¢æ•ˆç‡ï¼Œè§£å†³äº†é«˜å¹¶å‘ç³»ç»Ÿçš„æ€§èƒ½é—®é¢˜</li>
</ul>
</li>
<li>ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ç¼“å­˜<ul>
<li>å‡å°‘å’Œæ•°æ®åº“çš„äº¤äº’ï¼Œå‡å°‘ç³»ç»Ÿå¼€é”€ã€‚</li>
</ul>
</li>
<li>ä»€ä¹ˆæ ·çš„æ•°æ®ä½¿ç”¨ç¼“å­˜<ul>
<li>ç»å¸¸æŸ¥è¯¢å¹¶ä¸”ä¸ç»å¸¸æ”¹å˜çš„æ•°æ®</li>
</ul>
</li>
</ul>
<p>MyBatisç¼“å­˜åŸç†ï¼š</p>
<ol>
<li>å…ˆçœ‹äºŒçº§ç¼“å­˜ä¸­æœ‰æ²¡æœ‰æƒ³è¦çš„æ•°æ®</li>
<li>å†å»ä¸€çº§ç¼“å­˜ä¸­æŸ¥æ‰¾</li>
<li>å†å»æ•°æ®åº“ä¸­æŸ¥æ‰¾</li>
</ol>
<h3 id="11-1-ä¸€çº§ç¼“å­˜"><a href="#11-1-ä¸€çº§ç¼“å­˜" class="headerlink" title="11.1 ä¸€çº§ç¼“å­˜"></a>11.1 ä¸€çº§ç¼“å­˜</h3><ul>
<li>ä¸€çº§ç¼“å­˜ä¹Ÿå«æœ¬åœ°ç¼“å­˜ï¼Œä¸æ•°æ®åº“åŒä¸€æ¬¡ä¼šè¯æœŸé—´æŸ¥è¯¢åˆ°çš„æ•°æ®ä¼šæ”¾åœ¨æœ¬åœ°ç¼“å­˜ä¸­</li>
<li>MyBatis é»˜è®¤å¼€å¯ä¸€çº§ç¼“å­˜</li>
</ul>
<p><strong>ä¸€æ¬¡ä¼šè¯çš„ä½œç”¨åŸŸï¼šå¼€å¯ SqlSession åˆ°å…³é—­</strong></p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">Test</span><span class="params">()</span> {</span><br><span class="line">        <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> MyBatisUtil.getSqlSession();</span><br><span class="line">        <span class="type">BlogMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> sqlSession.getMapper(BlogMapper.class);</span><br><span class="line">        <span class="type">Blog</span> <span class="variable">blog</span> <span class="operator">=</span> mapper.getBlog(<span class="string">"%MyBatis%"</span>);</span><br><span class="line">        System.out.println(blog);</span><br><span class="line"></span><br><span class="line">        <span class="type">Blog</span> <span class="variable">blog2</span> <span class="operator">=</span> mapper.getBlog(<span class="string">"%MyBatis%"</span>);</span><br><span class="line">        System.out.println(blog == blog2);</span><br><span class="line">        sqlSession.close();</span><br><span class="line">    }</span><br></pre></td></tr></tbody></table></figure>

<p><img src="/../images/Mybatis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image_3PtJDMySrr.png"></p>
<p>ä¸Šé¢çš„ä»£ç åšäº†ä¸¤æ¬¡æŸ¥è¯¢ï¼Œä½†å®é™…åªä»æ•°æ®åº“ä¸­æŸ¥äº†ä¸€æ¬¡</p>
<p>ç¼“å­˜å¤±æ•ˆçš„æƒ…å†µï¼š</p>
<ul>
<li>æ‰§è¡Œå¢åˆ æ”¹æ“ä½œï¼Œå¯èƒ½ä¼šæ”¹å˜åŸæ¥çš„æ•°æ®ï¼Œæ‰€ä»¥ä¸€å®šä¼šåˆ·æ–°ç¼“å­˜</li>
<li>æŸ¥è¯¢ä¸åŒçš„ Mapper.xml</li>
<li>æ‰‹åŠ¨æ¸…ç†ç¼“å­˜<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlSession.clearCache();</span><br></pre></td></tr></tbody></table></figure></li>
</ul>
<p>select æ ‡ç­¾ä¸­è¿˜æœ‰ä¸€ä¸ªå±æ€§ <code>useCache</code> è¡¨ç¤ºè¯¥å…ƒç´ æ˜¯å¦ä½¿ç”¨ç¼“å­˜ï¼Œ<code>flushCache</code> å±æ€§è¡¨ç¤ºæ˜¯å¦åˆ·æ–°ç¼“å­˜</p>
<h3 id="11-2-äºŒçº§ç¼“å­˜"><a href="#11-2-äºŒçº§ç¼“å­˜" class="headerlink" title="11.2 äºŒçº§ç¼“å­˜"></a>11.2 äºŒçº§ç¼“å­˜</h3><ul>
<li>äºŒçº§ç¼“å­˜ä¹Ÿç§°ä¸ºå…¨å±€ç¼“å­˜ï¼Œæ˜¯åŸºäº <code>namespace</code> çº§åˆ«çš„ç¼“å­˜</li>
<li>äºŒçº§ç¼“å­˜çš„å·¥ä½œæœºåˆ¶ï¼š<ul>
<li>ä¸€ä¸ªä¼šè¯æŸ¥è¯¢ä¸€æ¡æ•°æ®ï¼Œè¿™ä¸ªæ•°æ®å°±ä¼šè¢«æ”¾åœ¨ä¸€çº§ç¼“å­˜å½“ä¸­</li>
<li>å¦‚æœå½“å‰ä¼šè¯å…³é—­äº†ï¼Œè¿™ä¸ªä¼šè¯å¯¹åº”çš„ä¸€çº§ç¼“å­˜å…³é—­ï¼Œä¸€çº§ç¼“å­˜ä¸­çš„æ•°æ®å°±ä¼šä¿å­˜åˆ°äºŒçº§ç¼“å­˜å½“ä¸­</li>
<li>æ–°çš„ä¼šè¯æŸ¥è¯¢ä¿¡æ¯ï¼Œå°±å¯ä»¥ä»äºŒçº§ç¼“å­˜ä¸­è·å–å†…å®¹</li>
</ul>
</li>
</ul>
<p>äºŒçº§ç¼“å­˜çš„å¼€å¯ååˆ†ç®€å•ï¼Œåªéœ€è¦åœ¨ mapper.xml ä¸­åŠ ä¸Š</p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">cache</span>/&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p>è¿™ä¸ªç®€å•è¯­å¥çš„æ•ˆæœå¦‚ä¸‹:</p>
<ul>
<li>æ˜ å°„è¯­å¥æ–‡ä»¶ä¸­çš„æ‰€æœ‰ select è¯­å¥çš„ç»“æœå°†ä¼šè¢«ç¼“å­˜ã€‚</li>
<li>æ˜ å°„è¯­å¥æ–‡ä»¶ä¸­çš„æ‰€æœ‰ insertã€update å’Œ delete è¯­å¥ä¼šåˆ·æ–°ç¼“å­˜ã€‚</li>
<li>ç¼“å­˜ä¼šä½¿ç”¨æœ€è¿‘æœ€å°‘ä½¿ç”¨ç®—æ³•ï¼ˆLRU, Least Recently Usedï¼‰ç®—æ³•æ¥æ¸…é™¤ä¸éœ€è¦çš„ç¼“å­˜ã€‚</li>
<li>ç¼“å­˜ä¸ä¼šå®šæ—¶è¿›è¡Œåˆ·æ–°ï¼ˆä¹Ÿå°±æ˜¯è¯´ï¼Œæ²¡æœ‰åˆ·æ–°é—´éš”ï¼‰ã€‚</li>
<li>ç¼“å­˜ä¼šä¿å­˜åˆ—è¡¨æˆ–å¯¹è±¡ï¼ˆæ— è®ºæŸ¥è¯¢æ–¹æ³•è¿”å›å“ªç§ï¼‰çš„ 1024 ä¸ªå¼•ç”¨ã€‚</li>
<li>ç¼“å­˜ä¼šè¢«è§†ä¸ºè¯»/å†™ç¼“å­˜ï¼Œè¿™æ„å‘³ç€è·å–åˆ°çš„å¯¹è±¡å¹¶ä¸æ˜¯å…±äº«çš„ï¼Œå¯ä»¥å®‰å…¨åœ°è¢«è°ƒç”¨è€…ä¿®æ”¹ï¼Œè€Œä¸å¹²æ‰°å…¶ä»–è°ƒç”¨è€…æˆ–çº¿ç¨‹æ‰€åšçš„æ½œåœ¨ä¿®æ”¹ã€‚</li>
</ul>
<p>æˆ‘ä»¬ä¹Ÿå¯ä»¥è‡ªå®šä¹‰ç¼“å­˜</p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">cache</span></span></span><br><span class="line"><span class="tag">  <span class="attr">eviction</span>=<span class="string">"FIFO"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">flushInterval</span>=<span class="string">"60000"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">size</span>=<span class="string">"512"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">readOnly</span>=<span class="string">"true"</span>/&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p><code>eviction</code> è¡¨ç¤ºæ¸…é™¤ç­–ç•¥ï¼Œå¯ç”¨çš„æ¸…é™¤ç­–ç•¥æœ‰ï¼š</p>
<ul>
<li><code>LRU</code> â€“ æœ€è¿‘æœ€å°‘ä½¿ç”¨ï¼šç§»é™¤æœ€é•¿æ—¶é—´ä¸è¢«ä½¿ç”¨çš„å¯¹è±¡ã€‚</li>
<li><code>FIFO</code> â€“ å…ˆè¿›å…ˆå‡ºï¼šæŒ‰å¯¹è±¡è¿›å…¥ç¼“å­˜çš„é¡ºåºæ¥ç§»é™¤å®ƒä»¬ã€‚</li>
<li><code>SOFT</code> â€“ è½¯å¼•ç”¨ï¼šåŸºäºåƒåœ¾å›æ”¶å™¨çŠ¶æ€å’Œè½¯å¼•ç”¨è§„åˆ™ç§»é™¤å¯¹è±¡ã€‚</li>
<li><code>WEAK</code> â€“ å¼±å¼•ç”¨ï¼šæ›´ç§¯æåœ°åŸºäºåƒåœ¾æ”¶é›†å™¨çŠ¶æ€å’Œå¼±å¼•ç”¨è§„åˆ™ç§»é™¤å¯¹è±¡ã€‚</li>
</ul>
<p><code>flushInterval</code> è¡¨ç¤ºåˆ·æ–°é—´éš”ï¼Œå•ä½æ˜¯æ¯«ç§’</p>
<p><code>size</code> è¡¨ç¤ºç¼“å­˜å¯¹è±¡å¯ä»¥å ç”¨çš„å†…å­˜èµ„æº</p>
<p><code>readOnly</code> è¡¨ç¤ºåªè¯»å±æ€§ã€‚åªè¯»çš„ç¼“å­˜ä¼šç»™æ‰€æœ‰è°ƒç”¨è€…è¿”å›ç¼“å­˜å¯¹è±¡çš„ç›¸åŒå®ä¾‹ã€‚ å› æ­¤è¿™äº›å¯¹è±¡ä¸èƒ½è¢«ä¿®æ”¹ã€‚è¿™å°±æä¾›äº†å¯è§‚çš„æ€§èƒ½æå‡ã€‚è€Œå¯è¯»å†™çš„ç¼“å­˜ä¼šï¼ˆé€šè¿‡åºåˆ—åŒ–ï¼‰è¿”å›ç¼“å­˜å¯¹è±¡çš„æ‹·è´ã€‚ é€Ÿåº¦ä¸Šä¼šæ…¢ä¸€äº›ï¼Œä½†æ˜¯æ›´å®‰å…¨ï¼Œå› æ­¤é»˜è®¤å€¼æ˜¯ falseã€‚</p>
<p><strong>æ³¨æ„ï¼šä½¿ç”¨äºŒçº§ç¼“å­˜çš„å®ä½“ç±»å¿…é¡»å®ç° <strong><strong><code>Serializable</code></strong></strong> æ¥å£</strong></p>
<p>æ¥çœ‹ä¸‹é¢ä¸€ä¸ªä¾‹å­ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">Test</span><span class="params">()</span> {</span><br><span class="line">        <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> MyBatisUtil.getSqlSession();</span><br><span class="line">        <span class="type">BlogMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> sqlSession.getMapper(BlogMapper.class);</span><br><span class="line">        <span class="type">Blog</span> <span class="variable">blog</span> <span class="operator">=</span> mapper.getBlog(<span class="string">"%MyBatis%"</span>);</span><br><span class="line">        System.out.println(blog);</span><br><span class="line">        sqlSession.close();</span><br><span class="line">        <span class="type">SqlSession</span> <span class="variable">sqlSession1</span> <span class="operator">=</span> MyBatisUtil.getSqlSession();</span><br><span class="line">        <span class="type">BlogMapper</span> <span class="variable">mapper1</span> <span class="operator">=</span> sqlSession1.getMapper(BlogMapper.class);</span><br><span class="line">        <span class="type">Blog</span> <span class="variable">blog1</span> <span class="operator">=</span> mapper1.getBlog(<span class="string">"%MyBatis%"</span>);</span><br><span class="line">        System.out.println(blog1);</span><br><span class="line">        System.out.println(blog == blog1);</span><br><span class="line">        sqlSession1.close();</span><br><span class="line">    }</span><br></pre></td></tr></tbody></table></figure>

<p><img src="/../images/Mybatis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image_rkuGDtwrcZ.png"></p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">Test2</span><span class="params">()</span> {</span><br><span class="line">        <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> MyBatisUtil.getSqlSession();</span><br><span class="line">        <span class="type">BlogMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> sqlSession.getMapper(BlogMapper.class);</span><br><span class="line">        <span class="type">Blog</span> <span class="variable">blog</span> <span class="operator">=</span> mapper.getBlog(<span class="string">"%MyBatis%"</span>);</span><br><span class="line">        System.out.println(blog);</span><br><span class="line"></span><br><span class="line">        <span class="type">SqlSession</span> <span class="variable">sqlSession1</span> <span class="operator">=</span> MyBatisUtil.getSqlSession();</span><br><span class="line">        <span class="type">BlogMapper</span> <span class="variable">mapper1</span> <span class="operator">=</span> sqlSession1.getMapper(BlogMapper.class);</span><br><span class="line">        <span class="type">Blog</span> <span class="variable">blog1</span> <span class="operator">=</span> mapper1.getBlog(<span class="string">"%MyBatis%"</span>);</span><br><span class="line">        System.out.println(blog1);</span><br><span class="line">        System.out.println(blog == blog1);</span><br><span class="line">        sqlSession.close();</span><br><span class="line">        sqlSession1.close();</span><br><span class="line">    }</span><br></pre></td></tr></tbody></table></figure>

<p><img src="/../images/Mybatis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image_EiFHuKpTUZ.png"></p>
<p>å¯ä»¥çœ‹åˆ° Mybaitis æŸ¥è¯¢äº†ä¸¤æ¬¡ï¼Œå¯è§ç¬¬ä¸€ä¸ª sqlSession ä¸­çš„æ•°æ®åœ¨ä¼šè¯å…³é—­ä¹‹å‰å¹¶æ²¡æœ‰è¢«æ”¾è¿›äºŒçº§ç¼“å­˜ä¸­ã€‚å¹¶ä¸”ï¼Œä½¿ç”¨äºŒçº§ç¼“å­˜æŸ¥è¯¢å‡ºæ¥çš„ä¸¤ä¸ªå¯¹è±¡åœ°å€å¹¶ä¸ç›¸ç­‰ï¼Œè€Œä¸€çº§ç¼“å­˜æ˜¯ç›¸ç­‰çš„ã€‚</p>
<p>æ€»ç»“ï¼š</p>
<ul>
<li>åªè¦å¼€å¯äº†äºŒçº§ç¼“å­˜ï¼Œåœ¨åŒä¸€ä¸ª Mapper ä¸‹å°±æœ‰æ•ˆ</li>
<li>select çš„æ•°æ®ä¼šå…ˆæ”¾åœ¨ä¸€çº§ç¼“å­˜ä¸­ï¼Œåªæœ‰å½“ä¸€çº§ç¼“å­˜æäº¤æˆ–è€…å›æ»šæ—¶æ‰ä¼šå°†æ•°æ®æ”¾åœ¨äºŒçº§ç¼“å­˜å½“ä¸­</li>
</ul>
<h2 id="12-å¸¸è§-Bug"><a href="#12-å¸¸è§-Bug" class="headerlink" title="12 å¸¸è§ Bug"></a>12 å¸¸è§ Bug</h2><p><img src="/../images/Mybatis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/6523C60C4B66B4DA1C512EF1397AA555_2DWEdkXWkb.gif"></p>
<p>é‡åˆ°çš„æŠ¥é”™ï¼š</p>
<p><img src="/../images/Mybatis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image_459aZ2uDF4.png"></p>
<p>æˆ– <code>java.lang.ExceptionInInitializerError</code> åˆå§‹åŒ–é”™è¯¯<strong>ã€æœ€å¸¸è§ã€‘</strong></p>
<p>åŸå› ï¼š<strong>ç”±äº Maven çš„çº¦å®šå¤§äºé…ç½®ï¼Œxml æ–‡ä»¶è¢«è¿‡æ»¤</strong></p>
<p>è§£å†³ï¼šåœ¨pom.xmlä¸­æ·»åŠ ä»¥ä¸‹ä»£ç </p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resources</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">resource</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">directory</span>&gt;</span>src/main/java<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">includes</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">include</span>&gt;</span>**/*.properties<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">include</span>&gt;</span>**/*.xml<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">includes</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">filtering</span>&gt;</span>true<span class="tag">&lt;/<span class="name">filtering</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resources</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

        </div>

        
            <section class="post-copyright">
                
                    <p class="copyright-item">
                        <span>Author:</span>
                        <span>qing-wq</span>
                    </p>
                
                
                    <p class="copyright-item">
                        <span>Permalink:</span>
                        <span><a href="https://qing-wq.github.io/2022/07/26/Mybatis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">https://qing-wq.github.io/2022/07/26/Mybatis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/</a></span>
                    </p>
                
                
                    <p class="copyright-item">
                        <span>License:</span>
                        <span>Copyright (c) 2019 <a target="_blank" rel="noopener" href="http://creativecommons.org/licenses/by-nc/4.0/">CC-BY-NC-4.0</a> LICENSE</span>
                    </p>
                
                

            </section>
        
        <section class="post-tags">
            <div>
                <span>Tag(s):</span>
                <span class="tag">
                    
                    
                        <a href="/tags/MyBatis/"># MyBatis</a>
                    
                        
                </span>
            </div>
            <div>
                <a href="javascript:window.history.back();">back</a>
                <span>Â· </span>
                <a href="/">home</a>
            </div>
        </section>
        <section class="post-nav">
            
                <a class="prev" rel="prev" href="/2022/09/08/Spring%E9%A1%B9%E7%9B%AE%E4%B8%AD%E7%9A%84%E5%85%A8%E5%B1%80%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86/">é¡¹ç›®ä¸­çš„å…¨å±€å¼‚å¸¸å¤„ç†</a>
            
            
        </section>


    </article>
</div>

            </div>
            <footer id="footer" class="footer">
    <div class="copyright">
        <span>Â© qing-wq | Powered by <a href="https://hexo.io" target="_blank">Hexo</a> & <a href="https://github.com/Siricee/hexo-theme-Chic" target="_blank">Chic</a></span>
    </div>
</footer>

    </div>
</body>

</html>