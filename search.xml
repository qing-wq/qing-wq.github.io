<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>LangChain4j-spring Bugä¿®å¤è®°å½•</title>
    <url>/2024/08/20/LangChain4j-spring%20Bug/</url>
    <content><![CDATA[<p>èµ·å› ï¼šåœ¨ä½¿ç”¨langchain4jçš„è¿‡ç¨‹ä¸­å‘ç°ï¼Œå¦‚æœä½¿ç”¨<code>@ComponentScan</code>æ‰«æç‰¹å®šçš„æ–‡ä»¶è·¯å¾„ï¼Œå¹¶ä¸”è¯¥æ–‡ä»¶è·¯å¾„ä¸­å®šä¹‰äº†å¸¦æœ‰<code>@AiService</code>ï¼Œé‚£ä¹ˆè¯¥æ¥å£å°†ä¸ä¼šè¢«æ‰«æå¹¶ç”Ÿæˆä»£ç†ç±»</p>
<h2 id="é—®é¢˜åˆ†æ"><a href="#é—®é¢˜åˆ†æ" class="headerlink" title="é—®é¢˜åˆ†æ"></a>é—®é¢˜åˆ†æ</h2><p>åœ¨Springbootä¸­ä½¿ç”¨<code>context/beanFactory</code>è·å–å¸¦æœ‰<code>@AiService</code>çš„Beanï¼Œå‘ç°Springbootä¼šè‡ªåŠ¨å¿½ç•¥æ¥å£ï¼ŒåŸå› åœ¨äº<strong>Springæ˜¯ä¸ä¼šæ‰«ææ¥å£çš„ï¼Œå› ä¸ºæ¥å£æ²¡æœ‰åŠæ³•å®ä¾‹åŒ–</strong>ï¼Œå› æ­¤ä½œè€…çš„åšæ³•ä¸ºï¼š</p>
<ol>
<li><code>Reflections</code>æ‰«æå½“å‰å¯åŠ¨ç±»æ‰€åœ¨çš„ç±»è·¯å¾„è·å–<code>@AiService</code>çš„class</li>
<li>åœ¨<code>BeanFactoryPostProcessor</code>é˜¶æ®µï¼ˆBeanåŠ è½½å®Œä½†è¿˜æœªåˆ›å»ºä»»ä½•Beanå®ä¾‹å‰ï¼‰ï¼Œä½¿ç”¨<code>AiServiceFactory</code>æ›¿æ¢æ¥å£çš„BeanDefinitionå®Œæˆä»£ç†æ›¿æ¢</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> Set&lt;Class&lt;?&gt;&gt; findAiServices(ConfigurableListableBeanFactory beanFactory) &#123;</span><br><span class="line">    String[] applicationBean = beanFactory.getBeanNamesForAnnotation(SpringBootApplication.class);</span><br><span class="line">    <span class="type">BeanDefinition</span> <span class="variable">applicationBeanDefinition</span> <span class="operator">=</span> beanFactory.getBeanDefinition(applicationBean[<span class="number">0</span>]);</span><br><span class="line">    <span class="type">String</span> <span class="variable">basePackage</span> <span class="operator">=</span> applicationBeanDefinition.getResolvableType().resolve().getPackage().getName();</span><br><span class="line">    <span class="type">Reflections</span> <span class="variable">reflections</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Reflections</span>((<span class="keyword">new</span> <span class="title class_">ConfigurationBuilder</span>()).forPackage(basePackage));</span><br><span class="line">    Set&lt;Class&lt;?&gt;&gt; classes = reflections.getTypesAnnotatedWith(AiService.class);</span><br><span class="line">    classes.removeIf(clazz -&gt; !clazz.getName().startsWith(basePackage));</span><br><span class="line">    <span class="keyword">return</span> classes;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="æ”¹åŠ¨1ï¼šè·å–æ‰€æœ‰çš„ComponentScançš„basePackageå¹¶æ‰«æ"><a href="#æ”¹åŠ¨1ï¼šè·å–æ‰€æœ‰çš„ComponentScançš„basePackageå¹¶æ‰«æ" class="headerlink" title="æ”¹åŠ¨1ï¼šè·å–æ‰€æœ‰çš„ComponentScançš„basePackageå¹¶æ‰«æ"></a>æ”¹åŠ¨1ï¼šè·å–æ‰€æœ‰çš„ComponentScançš„basePackageå¹¶æ‰«æ</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> Set&lt;String&gt; <span class="title function_">getBasePackages</span><span class="params">(ConfigurableListableBeanFactory beanFactory)</span> &#123;</span><br><span class="line">        Set&lt;String&gt; basePackages = <span class="keyword">new</span> <span class="title class_">LinkedHashSet</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        List&lt;String&gt; autoConfigPackages = AutoConfigurationPackages.get(beanFactory);</span><br><span class="line">        basePackages.addAll(autoConfigPackages);</span><br><span class="line"></span><br><span class="line">        String[] beanNames = beanFactory.getBeanNamesForAnnotation(ComponentScan.class);</span><br><span class="line">        <span class="keyword">for</span> (String beanName : beanNames) &#123;</span><br><span class="line">            Class&lt;?&gt; beanClass = beanFactory.getType(beanName);</span><br><span class="line">            <span class="keyword">if</span> (beanClass != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="type">ComponentScan</span> <span class="variable">componentScan</span> <span class="operator">=</span> beanClass.getAnnotation(ComponentScan.class);</span><br><span class="line">                <span class="keyword">if</span> (componentScan != <span class="literal">null</span>) &#123;</span><br><span class="line">                    Collections.addAll(basePackages, componentScan.value());</span><br><span class="line">                    Collections.addAll(basePackages, componentScan.basePackages());</span><br><span class="line">                    <span class="keyword">for</span> (Class&lt;?&gt; basePackageClass : componentScan.basePackageClasses()) &#123;</span><br><span class="line">                        basePackages.add(ClassUtils.getPackageName(basePackageClass));</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>

<h2 id="æ”¹åŠ¨2ï¼šè‡ªå®šä¹‰ClassPathBeanDefinitionScanneræ‰«ææ¥å£"><a href="#æ”¹åŠ¨2ï¼šè‡ªå®šä¹‰ClassPathBeanDefinitionScanneræ‰«ææ¥å£" class="headerlink" title="æ”¹åŠ¨2ï¼šè‡ªå®šä¹‰ClassPathBeanDefinitionScanneræ‰«ææ¥å£"></a>æ”¹åŠ¨2ï¼šè‡ªå®šä¹‰ClassPathBeanDefinitionScanneræ‰«ææ¥å£</h2><p>åŸæ¥ä½¿ç”¨<code>Reflections</code>æ‰«æçš„æ–¹å¼ä¸å¤ªä¼˜é›…ï¼Œæˆ‘ä»¬çš„ç›®æ ‡æ˜¯è·å–Beanï¼Œé€šè¿‡Springæœ¬èº«çš„æ–¹æ³•æ›´å¥½ã€‚ä½†é—®é¢˜åœ¨äºå¦‚ä½•è®©Springæ‰«æè‡ªå®šä¹‰æ¥å£</p>
<p>è§£å†³æ–¹æ¡ˆï¼šå‚è€ƒMybatisçš„å®ç°ï¼ŒMybtisé€šè¿‡<code>@Mapper</code>å³å¯å°†ç±»æ³¨å…¥åˆ°Springä¸­ï¼ŒåŸç†åœ¨äºä½¿ç”¨äº†è‡ªå®šä¹‰ç±»æ‰«æå™¨<code>ClassPathMapperScanner</code>æ‰«ææ‰€æœ‰å¸¦æœ‰<code>@Mapper</code>å’Œ<code>@MapperScan</code>æŒ‡å®šçš„è·¯å¾„</p>
<p>ä½¿ç”¨<code>BeanDefinitionRegistryPostProcessor</code>åœ¨beanæ³¨å†Œå®Œæˆåï¼Œå†æ¬¡ä½¿ç”¨è‡ªå®šä¹‰<code>ClassPathBeanDefinitionScanner</code>æ‰«æå…¨éƒ¨æ¥å£ï¼ˆé»˜è®¤çš„<code>BeanScanner</code>åªä¼šæ‰«æç±»ï¼‰ï¼Œæ‰«æçš„è·¯å¾„ä¸ºæ‰€æœ‰<code>@ComponentScan</code>æŒ‡å®šçš„basePackage</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ClassPathAiServiceScanner</span> <span class="keyword">extends</span> <span class="title class_">ClassPathBeanDefinitionScanner</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ClassPathAiServiceScanner</span><span class="params">(BeanDefinitionRegistry registry, <span class="type">boolean</span> useDefaultFilters)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(registry, useDefaultFilters);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="type">boolean</span> <span class="title function_">isCandidateComponent</span><span class="params">(AnnotatedBeanDefinition beanDefinition)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> beanDefinition.getMetadata().isInterface() &amp;&amp; beanDefinition.getMetadata().isIndependent();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AiServiceScannerProcessor</span> <span class="keyword">implements</span> <span class="title class_">BeanDefinitionRegistryPostProcessor</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">postProcessBeanDefinitionRegistry</span><span class="params">(BeanDefinitionRegistry registry)</span> <span class="keyword">throws</span> BeansException &#123;</span><br><span class="line">        <span class="type">ClassPathAiServiceScanner</span> <span class="variable">classPathAiServiceScanner</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathAiServiceScanner</span>(registry, <span class="literal">false</span>);</span><br><span class="line">        classPathAiServiceScanner.addIncludeFilter(<span class="keyword">new</span> <span class="title class_">AnnotationTypeFilter</span>(AiService.class));</span><br><span class="line">        Set&lt;String&gt; basePackages = getBasePackages((ConfigurableListableBeanFactory) registry);</span><br><span class="line">        classPathAiServiceScanner.scan(StringUtils.toStringArray(basePackages));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åŒä¸Š</span></span><br><span class="line">    <span class="keyword">private</span> Set&lt;String&gt; <span class="title function_">getBasePackages</span><span class="params">(ConfigurableListableBeanFactory beanFactory)</span> &#123;</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æœ€ååœ¨<code>BeanFactoryPostProcessor</code>é˜¶æ®µï¼Œé€šè¿‡è‡ªå®šä¹‰çš„<code>AiServiceFactory</code>æ›¿æ¢æ¥å£çš„beanClassï¼Œç„¶åå°†åŸæœ‰çš„beanClassè®¾ç½®ä¸ºä»–çš„å†…éƒ¨å±æ€§å¹¶é‡å†™ä»–çš„<code>getObject()</code>æ–¹æ³•ï¼Œè¿™æ ·å°±å®Œæˆbeançš„æ›¿æ¢</p>
<h2 id="Issue"><a href="#Issue" class="headerlink" title="Issue"></a>Issue</h2><ul>
<li><a href="https://github.com/langchain4j/langchain4j/issues/1606">https://github.com/langchain4j/langchain4j/issues/1606</a></li>
<li><a href="https://github.com/langchain4j/langchain4j-spring/pull/35">https://github.com/langchain4j/langchain4j-spring/pull/35</a></li>
</ul>
<hr>
<p>å‚è€ƒèµ„æ–™ï¼š</p>
<ul>
<li><a href="https://cloud.tencent.com/developer/article/1962431">https://cloud.tencent.com/developer/article/1962431</a></li>
</ul>
]]></content>
  </entry>
  <entry>
    <title>Goè¯­è¨€åŸºç¡€</title>
    <url>/2023/09/01/Go%E8%AF%AD%E8%A8%80%E5%9F%BA%E7%A1%80/</url>
    <content><![CDATA[<h2 id="ç¯å¢ƒæ­å»º"><a href="#ç¯å¢ƒæ­å»º" class="headerlink" title="ç¯å¢ƒæ­å»º"></a>ç¯å¢ƒæ­å»º</h2><ul>
<li><strong>GOPATH</strong>ï¼šä»£è¡¨ Go è¯­è¨€é¡¹ç›®çš„å·¥ä½œç›®å½•ï¼Œåœ¨ Go Module æ¨¡å¼ä¹‹å‰éå¸¸é‡è¦ï¼Œç°åœ¨åŸºæœ¬ä¸Šç”¨æ¥å­˜æ”¾ä½¿ç”¨ go get å‘½ä»¤è·å–çš„é¡¹ç›®ã€‚</li>
<li><strong>GOBIN</strong>ï¼šä»£è¡¨ Go ç¼–è¯‘ç”Ÿæˆçš„ç¨‹åºçš„å®‰è£…ç›®å½•ï¼Œæ¯”å¦‚é€šè¿‡ go install å‘½ä»¤ï¼Œä¼šæŠŠç”Ÿæˆçš„ Go ç¨‹åºå®‰è£…åˆ° GOBIN ç›®å½•ä¸‹ï¼Œä»¥ä¾›ä½ åœ¨ç»ˆç«¯ä½¿ç”¨ã€‚</li>
<li>Goä»£ç†ï¼š<code>GOPROXY=https://goproxy.cn</code></li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">export</span> GOROOT=/usr/local/go </span><br><span class="line"><span class="built_in">export</span> GOPATH=<span class="variable">$HOME</span>/MyDoucument/code/goProject</span><br><span class="line"><span class="built_in">export</span> GOBIN=<span class="variable">$GOPATH</span>/bin</span><br><span class="line"><span class="built_in">export</span> GO111MODULE=on</span><br></pre></td></tr></table></figure>

<h3 id="ç¼–è¯‘å‘å¸ƒ"><a href="#ç¼–è¯‘å‘å¸ƒ" class="headerlink" title="ç¼–è¯‘å‘å¸ƒ"></a>ç¼–è¯‘å‘å¸ƒ</h3><p><code>go build</code>ç¼–è¯‘ç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶</p>
<p><code>go install</code>æŠŠå®ƒå®‰è£…åˆ° <code>$GOBIN</code> ç›®å½•æˆ–è€…ä»»æ„ä½ç½®</p>
<h3 id="è·¨å¹³å°ç¼–è¯‘"><a href="#è·¨å¹³å°ç¼–è¯‘" class="headerlink" title="è·¨å¹³å°ç¼–è¯‘"></a>è·¨å¹³å°ç¼–è¯‘</h3><p>Go è¯­è¨€é€šè¿‡ä¸¤ä¸ªç¯å¢ƒå˜é‡æ¥æ§åˆ¶è·¨å¹³å°ç¼–è¯‘ï¼Œå®ƒä»¬åˆ†åˆ«æ˜¯ <code>GOOS</code> å’Œ <code>GOARCH</code> ã€‚</p>
<ul>
<li><strong>GOOS</strong>ï¼šä»£è¡¨è¦ç¼–è¯‘çš„ç›®æ ‡æ“ä½œç³»ç»Ÿï¼Œå¸¸è§çš„æœ‰ Linuxã€Windowsã€Darwin ç­‰ã€‚</li>
<li><strong>GOARCH</strong>ï¼šä»£è¡¨è¦ç¼–è¯‘çš„ç›®æ ‡å¤„ç†å™¨æ¶æ„ï¼Œå¸¸è§çš„æœ‰ 386ã€AMD64ã€ARM64 ç­‰ã€‚</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">GOOS=linux GOARCH=amd64 go build ./ch01/main.go</span><br></pre></td></tr></table></figure>

<h1 id="åŸºæœ¬æ•°æ®ç±»å‹"><a href="#åŸºæœ¬æ•°æ®ç±»å‹" class="headerlink" title="åŸºæœ¬æ•°æ®ç±»å‹"></a>åŸºæœ¬æ•°æ®ç±»å‹</h1><h3 id="æ•´å‹"><a href="#æ•´å‹" class="headerlink" title="æ•´å‹"></a>æ•´å‹</h3><ul>
<li><strong>æœ‰ç¬¦å·æ•´å‹</strong>ï¼šå¦‚ <code>int</code>ã€<code>int8</code>ã€<code>int16</code>ã€<code>int32</code> å’Œ <code>int64</code>ã€‚</li>
<li><strong>æ— ç¬¦å·æ•´å‹</strong>ï¼šå¦‚ <code>uint</code>ã€<code>uint8</code>ã€<code>uint16</code>ã€<code>uint32</code> å’Œ <code>uint64</code>ã€‚</li>
</ul>
<p>é™¤äº†æœ‰ç”¨â€œä½â€ï¼ˆbitï¼‰å¤§å°è¡¨ç¤ºçš„æ•´å‹å¤–ï¼Œè¿˜æœ‰ int å’Œ uint è¿™ä¸¤ä¸ªæ²¡æœ‰å…·ä½“ bit å¤§å°çš„æ•´å‹ï¼Œå®ƒä»¬çš„å¤§å°å¯èƒ½æ˜¯ 32bitï¼Œä¹Ÿå¯èƒ½æ˜¯ 64bitï¼Œå’Œç¡¬ä»¶è®¾å¤‡ CPU æœ‰å…³ã€‚</p>
<h3 id="æµ®ç‚¹æ•°"><a href="#æµ®ç‚¹æ•°" class="headerlink" title="æµ®ç‚¹æ•°"></a>æµ®ç‚¹æ•°</h3><ul>
<li><code>float32</code>&#x20;</li>
<li><code>float64</code></li>
</ul>
<h3 id="å¤æ•°"><a href="#å¤æ•°" class="headerlink" title="å¤æ•°"></a>å¤æ•°</h3><ul>
<li><code>complex64</code></li>
<li><code>complex128</code></li>
</ul>
<p>å¤æ•°æœ‰å®éƒ¨å’Œè™šéƒ¨ï¼Œ<code>complex64</code>çš„å®éƒ¨å’Œè™šéƒ¨ä¸º32ä½ï¼Œ<code>complex128</code>çš„å®éƒ¨å’Œè™šéƒ¨ä¸º64ä½</p>
<h3 id="å¸ƒå°”å€¼"><a href="#å¸ƒå°”å€¼" class="headerlink" title="å¸ƒå°”å€¼"></a>å¸ƒå°”å€¼</h3><p><code>bool</code></p>
<ul>
<li>å¸ƒå°”ç±»å‹å˜é‡çš„é»˜è®¤å€¼ä¸ºfalseã€‚</li>
<li>Go è¯­è¨€ä¸­ä¸å…è®¸å°†æ•´å‹å¼ºåˆ¶è½¬æ¢ä¸ºå¸ƒå°”å‹.</li>
<li>å¸ƒå°”å‹æ— æ³•å‚ä¸æ•°å€¼è¿ç®—ï¼Œä¹Ÿæ— æ³•ä¸å…¶ä»–ç±»å‹è¿›è¡Œè½¬æ¢</li>
</ul>
<h3 id="å­—ç¬¦ä¸²"><a href="#å­—ç¬¦ä¸²" class="headerlink" title="å­—ç¬¦ä¸²"></a>å­—ç¬¦ä¸²</h3><p>*** Go è¯­è¨€é‡Œçš„å­—ç¬¦ä¸²çš„å†…éƒ¨å®ç°ä½¿ç”¨UTF-8ç¼–ç ï¼Œæ¯ä¸ªå­—ç¬¦ä¸²çš„åº•å±‚éƒ½æ˜¯byteæ•°ç»„***â€‹</p>
<ul>
<li><em><strong>byteï¼šç›¸å½“äºuint8</strong></em></li>
<li><em><strong>runeï¼šç›¸å½“äºint32</strong></em><ul>
<li>Go ä½¿ç”¨äº†ç‰¹æ®Š <code>rune</code> ç±»å‹æ¥å¤„ç† <code>Unicode</code>ï¼ˆå¤åˆå­—ç¬¦ï¼ŒåŒ…æ‹¬ä¸­æ–‡ã€æ—¥æ–‡ç­‰ç”¨å¤šå­—èŠ‚è¡¨ç¤ºå­—ç¬¦ï¼‰</li>
</ul>
</li>
</ul>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">//utf-8éå†</span></span><br><span class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="built_in">len</span>(str); i++ &#123;</span><br><span class="line">    ch := str[i]</span><br><span class="line">    fmt.Printf(<span class="string">&quot;%c \n&quot;</span>, ch)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Unicodeéå†</span></span><br><span class="line"><span class="keyword">for</span> _, ch1 := <span class="keyword">range</span> str &#123;</span><br><span class="line">    fmt.Printf(<span class="string">&quot;%c \n&quot;</span>, ch1)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="Arrayã€Sliceã€Map"><a href="#Arrayã€Sliceã€Map" class="headerlink" title="Arrayã€Sliceã€Map"></a>Arrayã€Sliceã€Map</h2><p><img src="/../images/image_hekea8NFLl.png"></p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line">array1:=[<span class="number">5</span>]<span class="type">string</span>&#123;<span class="number">1</span>:<span class="string">&quot;b&quot;</span>,<span class="number">3</span>:<span class="string">&quot;d&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line">slice:=array[start:end]</span><br><span class="line"></span><br><span class="line">slice1:=<span class="built_in">make</span>([]<span class="type">string</span>,<span class="number">4</span>,<span class="number">8</span>)</span><br><span class="line"></span><br><span class="line">slice2:=<span class="built_in">append</span>(slice1,<span class="string">&quot;f&quot;</span>)</span><br><span class="line"></span><br><span class="line">nameAgeMap:=<span class="built_in">make</span>(<span class="keyword">map</span>[<span class="type">string</span>]<span class="type">int</span>)</span><br><span class="line"></span><br><span class="line">nameAgeMap:=<span class="keyword">map</span>[<span class="type">string</span>]<span class="type">int</span>&#123;<span class="string">&quot;é£é›ªæ— æƒ…&quot;</span>:<span class="number">20</span>&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>ğŸ“Œæç¤º</p>
<p>åœ¨åˆ›å»ºæ–°åˆ‡ç‰‡çš„æ—¶å€™ï¼Œæœ€å¥½è¦è®©æ–°åˆ‡ç‰‡çš„é•¿åº¦å’Œå®¹é‡ä¸€æ ·ï¼Œè¿™æ ·åœ¨è¿½åŠ æ“ä½œçš„æ—¶å€™å°±ä¼šç”Ÿæˆæ–°çš„åº•å±‚æ•°ç»„ï¼Œä»è€Œå’ŒåŸæœ‰æ•°ç»„åˆ†ç¦»ï¼Œå°±ä¸ä¼šå› ä¸ºå…±ç”¨åº•å±‚æ•°ç»„å¯¼è‡´ä¿®æ”¹å†…å®¹çš„æ—¶å€™å½±å“å¤šä¸ªåˆ‡ç‰‡ã€‚</p>
</blockquote>
<h2 id="å‡½æ•°å’Œæ–¹æ³•"><a href="#å‡½æ•°å’Œæ–¹æ³•" class="headerlink" title="å‡½æ•°å’Œæ–¹æ³•"></a>å‡½æ•°å’Œæ–¹æ³•</h2><p>åœ¨ Go è¯­è¨€ä¸­ï¼Œæ–¹æ³•å’Œå‡½æ•°æ˜¯ä¸¤ä¸ªæ¦‚å¿µï¼Œä½†åˆéå¸¸ç›¸ä¼¼ï¼Œä¸åŒç‚¹åœ¨äºæ–¹æ³•å¿…é¡»è¦æœ‰ä¸€ä¸ªæ¥æ”¶è€…ï¼Œè¿™ä¸ªæ¥æ”¶è€…æ˜¯ä¸€ä¸ªç±»å‹ï¼Œè¿™æ ·æ–¹æ³•å°±å’Œè¿™ä¸ªç±»å‹ç»‘å®šåœ¨ä¸€èµ·ï¼Œç§°ä¸ºè¿™ä¸ªç±»å‹çš„æ–¹æ³•ã€‚</p>
<ul>
<li>å‡½æ•°ï¼šæ­£å¸¸çš„ä»£ç é€»è¾‘</li>
<li>æ–¹æ³•ï¼šç‰¹å®šç±»å‹æ‰æœ‰ï¼Œç›¸å½“äºå¯¹è±¡çš„æ–¹æ³•</li>
</ul>
<h3 id="å€¼ç±»å‹æ¥æ”¶è€…å’ŒæŒ‡é’ˆç±»å‹æ¥æ”¶è€…"><a href="#å€¼ç±»å‹æ¥æ”¶è€…å’ŒæŒ‡é’ˆç±»å‹æ¥æ”¶è€…" class="headerlink" title="å€¼ç±»å‹æ¥æ”¶è€…å’ŒæŒ‡é’ˆç±»å‹æ¥æ”¶è€…"></a>å€¼ç±»å‹æ¥æ”¶è€…å’ŒæŒ‡é’ˆç±»å‹æ¥æ”¶è€…</h3><ul>
<li>å€¼ç±»å‹æ¥æ”¶è€…ï¼šä¸ä¼šæ”¹å˜åŸæ¥çš„å¯¹è±¡ï¼Œç›¸å½“äºæ“ä½œå¯¹è±¡çš„æ‹·è´</li>
<li>æŒ‡é’ˆç±»å‹æ¥æ”¶è€…ï¼šé€šè¿‡æŒ‡é’ˆå¯ä»¥è·å–å¯¹è±¡åœ°å€ï¼Œå¯ä»¥ç›´æ¥æ”¹å˜åŸæ¥çš„å¯¹è±¡</li>
</ul>
<blockquote>
<p>æç¤ºï¼šåœ¨è°ƒç”¨æ–¹æ³•çš„æ—¶å€™ï¼Œä¼ é€’çš„æ¥æ”¶è€…æœ¬è´¨ä¸Šéƒ½æ˜¯å‰¯æœ¬ï¼Œåªä¸è¿‡ä¸€ä¸ªæ˜¯è¿™ä¸ªå€¼çš„å‰¯æœ¬ï¼Œä¸€æ˜¯æŒ‡å‘è¿™ä¸ªå€¼æŒ‡é’ˆçš„å‰¯æœ¬ã€‚æŒ‡é’ˆå…·æœ‰æŒ‡å‘åŸæœ‰å€¼çš„ç‰¹æ€§ï¼Œæ‰€ä»¥ä¿®æ”¹äº†æŒ‡é’ˆæŒ‡å‘çš„å€¼ï¼Œä¹Ÿå°±ä¿®æ”¹äº†åŸæœ‰çš„å€¼ã€‚<em><strong>æˆ‘ä»¬å¯ä»¥ç®€å•åœ°ç†è§£ä¸ºå€¼æ¥æ”¶è€…ä½¿ç”¨çš„æ˜¯å€¼çš„å‰¯æœ¬æ¥è°ƒç”¨æ–¹æ³•ï¼Œè€ŒæŒ‡é’ˆæ¥æ”¶è€…ä½¿ç”¨å®é™…çš„å€¼æ¥è°ƒç”¨æ–¹æ³•ã€‚</strong></em></p>
</blockquote>
<blockquote>
<p>ğŸ“Œå€¼æ¥å—è€…æ–¹æ³•ä¸ä¼šæ”¹å˜åŸå§‹ç»“æ„ä½“å®ä¾‹</p>
</blockquote>
<ul>
<li>å¦‚æœä½¿ç”¨ä¸€ä¸ªå€¼ç±»å‹å˜é‡è°ƒç”¨æŒ‡é’ˆç±»å‹æ¥æ”¶è€…çš„æ–¹æ³•ï¼ŒGo è¯­è¨€ç¼–è¯‘å™¨ä¼šè‡ªåŠ¨å¸®æˆ‘ä»¬å–æŒ‡é’ˆè°ƒç”¨ï¼Œä»¥æ»¡è¶³æŒ‡é’ˆæ¥æ”¶è€…çš„è¦æ±‚ã€‚</li>
<li>åŒæ ·çš„åŸç†ï¼Œå¦‚æœä½¿ç”¨ä¸€ä¸ªæŒ‡é’ˆç±»å‹å˜é‡è°ƒç”¨å€¼ç±»å‹æ¥æ”¶è€…çš„æ–¹æ³•ï¼ŒGo è¯­è¨€ç¼–è¯‘å™¨ä¼šè‡ªåŠ¨å¸®æˆ‘ä»¬è§£å¼•ç”¨è°ƒç”¨ï¼Œä»¥æ»¡è¶³å€¼ç±»å‹æ¥æ”¶è€…çš„è¦æ±‚ã€‚</li>
</ul>
<h3 id="å€¼ç±»å‹è°ƒç”¨è€…å’ŒæŒ‡é’ˆç±»å‹è°ƒç”¨è€…"><a href="#å€¼ç±»å‹è°ƒç”¨è€…å’ŒæŒ‡é’ˆç±»å‹è°ƒç”¨è€…" class="headerlink" title="å€¼ç±»å‹è°ƒç”¨è€…å’ŒæŒ‡é’ˆç±»å‹è°ƒç”¨è€…"></a>å€¼ç±»å‹è°ƒç”¨è€…å’ŒæŒ‡é’ˆç±»å‹è°ƒç”¨è€…</h3><p>åœ¨å®˜æ–¹effective goæ–‡æ¡£ä¸­ï¼Œå¯¹ä¸¤è€…åŒºåˆ«æè¿°å¦‚ä¸‹ï¼š</p>
<ul>
<li><em><strong>å€¼æ–¹æ³•ï¼ˆvalue methodsï¼‰å¯ä»¥é€šè¿‡æŒ‡é’ˆå’Œå€¼è°ƒç”¨ï¼Œä½†æ˜¯æŒ‡é’ˆæ–¹æ³•ï¼ˆpointer methodsï¼‰åªèƒ½é€šè¿‡æŒ‡é’ˆæ¥è°ƒç”¨</strong></em>** <em>ã€‚</em>** â€‹</li>
<li>ä½†æœ‰ä¸€ä¸ªä¾‹å¤–ï¼Œå¦‚æœæŸä¸ªå€¼æ˜¯å¯å¯»å€çš„ï¼ˆaddressableï¼Œæˆ–è€…è¯´<em>å·¦å€¼</em>ï¼‰ï¼Œé‚£ä¹ˆç¼–è¯‘å™¨ä¼šåœ¨å€¼è°ƒç”¨æŒ‡é’ˆæ–¹æ³•æ—¶è‡ªåŠ¨æ’å…¥å–åœ°å€ç¬¦ï¼Œä½¿å¾—åœ¨æ­¤æƒ…å½¢ä¸‹çœ‹èµ·æ¥åƒæŒ‡é’ˆæ–¹æ³•ä¹Ÿå¯ä»¥é€šè¿‡å€¼æ¥è°ƒç”¨ã€‚</li>
</ul>
<hr>
<p>æ€»ç»“ï¼š</p>
<ul>
<li>ä¸ç®¡æ˜¯æ™®é€šå¯¹è±¡è¿˜æ˜¯æŒ‡é’ˆï¼Œéƒ½å¯ä»¥è°ƒç”¨ä»–ä»¬çš„å€¼æ–¹æ³•å’ŒæŒ‡é’ˆæ–¹æ³•ï¼Œå› ä¸ºç¼–è¯‘å™¨ä¼šè‡ªè¡Œå¤„ç†ï¼ˆè¯­æ³•ç³–</li>
<li><strong>é‡äº‹ä¸å†³è¯·ç”¨pointer methodï¼ï¼ï¼</strong></li>
</ul>
<h3 id="é€šè¿‡å˜é‡è°ƒç”¨æ–¹æ³•"><a href="#é€šè¿‡å˜é‡è°ƒç”¨æ–¹æ³•" class="headerlink" title="é€šè¿‡å˜é‡è°ƒç”¨æ–¹æ³•"></a>é€šè¿‡å˜é‡è°ƒç”¨æ–¹æ³•</h3><figure class="highlight go"><table><tr><td class="code"><pre><span class="line">student := Student(<span class="string">&quot;my name is xiaoming, I am &quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ–¹æ³•èµ‹å€¼ç»™å˜é‡</span></span><br><span class="line">sm := Student.stu</span><br><span class="line">sm2 := (*Student).stu2</span><br><span class="line">sm(student, <span class="number">2</span>)</span><br><span class="line">sm2(&amp;student)</span><br><span class="line">student.stu(<span class="number">1</span>)</span><br></pre></td></tr></table></figure>

<h2 id="ç»“æ„ä½“å’Œæ¥å£"><a href="#ç»“æ„ä½“å’Œæ¥å£" class="headerlink" title="ç»“æ„ä½“å’Œæ¥å£"></a>ç»“æ„ä½“å’Œæ¥å£</h2><p>ç»“æ„ä½“å®šä¹‰ï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">type Stu <span class="class"><span class="keyword">struct</span>&#123;</span></span><br><span class="line">  name <span class="built_in">string</span></span><br><span class="line">  age <span class="type">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åŒ¿åç»“æ„ä½“ å˜é‡ </span></span><br><span class="line">var stu <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">  name <span class="built_in">string</span></span><br><span class="line">  age <span class="type">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åŒ¿åç»“æ„ä½“å˜é‡å¦ä¸€ç§å†™æ³•</span></span><br><span class="line">newCar := <span class="keyword">struct</span> &#123;</span><br><span class="line">  Make    <span class="built_in">string</span> `json:<span class="string">&quot;make&quot;</span>`</span><br><span class="line">  Model   <span class="built_in">string</span> `json:<span class="string">&quot;model&quot;</span>`</span><br><span class="line">  Mileage <span class="type">int</span>    `json:<span class="string">&quot;mileage&quot;</span>`</span><br><span class="line">&#125;&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// MyStringer interface</span></span><br><span class="line">type MyStringer interface&#123;</span><br><span class="line">  myString() <span class="built_in">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><em><strong>ä»¥æŒ‡é’ˆç±»å‹æ¥æ”¶è€…å®ç°æ¥å£çš„æ—¶å€™ï¼Œåªæœ‰å¯¹åº”çš„æŒ‡é’ˆç±»å‹å®ä¾‹æ‰è¢«è®¤ä¸ºå®ç°äº†è¯¥æ¥å£ã€‚</strong></em></p>
<p><img src="/../images/Ciqc1F-yPMSAZ4k7AABU_GW4VxE080_J3w0-tF9PU.png"></p>
<h3 id="å·¥å‚å‡½æ•°ï¼ˆæ„é€ å‡½æ•°ï¼‰"><a href="#å·¥å‚å‡½æ•°ï¼ˆæ„é€ å‡½æ•°ï¼‰" class="headerlink" title="å·¥å‚å‡½æ•°ï¼ˆæ„é€ å‡½æ•°ï¼‰"></a>å·¥å‚å‡½æ•°ï¼ˆæ„é€ å‡½æ•°ï¼‰</h3><p>å·¥å‚å‡½æ•°ä¸€èˆ¬ç”¨äºåˆ›å»ºè‡ªå®šä¹‰çš„ç»“æ„ä½“ï¼Œä¾¿äºä½¿ç”¨è€…è°ƒç”¨</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewPerson</span><span class="params">(name <span class="type">string</span>)</span></span> *person &#123;</span><br><span class="line">    <span class="keyword">return</span> &amp;person&#123;name:name&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="ç»§æ‰¿å’Œç»„åˆ"><a href="#ç»§æ‰¿å’Œç»„åˆ" class="headerlink" title="ç»§æ‰¿å’Œç»„åˆ"></a>ç»§æ‰¿å’Œç»„åˆ</h3><p>åœ¨ Go è¯­è¨€ä¸­æ²¡æœ‰ç»§æ‰¿çš„æ¦‚å¿µï¼Œæ‰€ä»¥ç»“æ„ã€æ¥å£ä¹‹é—´ä¹Ÿæ²¡æœ‰çˆ¶å­å…³ç³»ï¼ŒGo è¯­è¨€æå€¡çš„æ˜¯ç»„åˆï¼Œåˆ©ç”¨ç»„åˆè¾¾åˆ°ä»£ç å¤ç”¨çš„ç›®çš„ï¼Œè¿™ä¹Ÿæ›´çµæ´»ã€‚</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ç»„åˆ</span></span><br><span class="line">p:=person&#123;</span><br><span class="line">    age:<span class="number">30</span>,</span><br><span class="line">    name:<span class="string">&quot;é£é›ªæ— æƒ…&quot;</span>,</span><br><span class="line">    address:address&#123;</span><br><span class="line">        province: <span class="string">&quot;åŒ—äº¬&quot;</span>,</span><br><span class="line">        city:     <span class="string">&quot;åŒ—äº¬&quot;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//åƒä½¿ç”¨è‡ªå·±çš„å­—æ®µä¸€æ ·ï¼Œç›´æ¥ä½¿ç”¨</span></span><br><span class="line">fmt.Println(p.province)</span><br></pre></td></tr></table></figure>

<p>ç±»å‹ç»„åˆåï¼Œå¤–éƒ¨ç±»å‹ä¸ä»…å¯ä»¥ä½¿ç”¨å†…éƒ¨ç±»å‹çš„å­—æ®µï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å†…éƒ¨ç±»å‹çš„æ–¹æ³•ï¼Œå°±åƒä½¿ç”¨è‡ªå·±çš„æ–¹æ³•ä¸€æ ·ã€‚<br><strong>æ–¹æ³•è¦†å†™</strong>ï¼šå¦‚æœå¤–éƒ¨ç±»å‹å®šä¹‰äº†å’Œå†…éƒ¨ç±»å‹åŒæ ·çš„æ–¹æ³•ï¼Œé‚£ä¹ˆå¤–éƒ¨ç±»å‹çš„ä¼šè¦†ç›–å†…éƒ¨ç±»å‹ï¼Œè¿™å°±æ˜¯ã€‚</p>
<h3 id="ç±»å‹æ–­è¨€"><a href="#ç±»å‹æ–­è¨€" class="headerlink" title="ç±»å‹æ–­è¨€"></a>ç±»å‹æ–­è¨€</h3><p>ç±»å‹æ–­è¨€ç”¨æ¥åˆ¤æ–­ä¸€ä¸ªæ¥å£çš„å€¼æ˜¯å¦æ˜¯å®ç°è¯¥æ¥å£çš„æŸä¸ªå…·ä½“ç±»å‹ã€‚</p>
<p>æ¥å£å¼•ç”¨æ‹¥æœ‰æ–­è¨€èƒ½åŠ›ï¼Œç”¨äºåˆ¤æ–­å½“å‰å¼•ç”¨æ˜¯å¦å±äºæŸä¸ªå¯¹è±¡çš„å®ä¾‹</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æ¥å£å¼•ç”¨æŒ‡å‘å­ç±»å®ä¾‹</span></span><br><span class="line"><span class="keyword">var</span> myInterface MyInterface = NewTest(<span class="string">&quot;test&quot;</span>, <span class="number">18</span>, <span class="string">&quot;test&quot;</span>)</span><br><span class="line"><span class="comment">// åˆ¤æ–­myInterfaceæ˜¯å¦æ˜¯Testç±»å‹</span></span><br><span class="line"><span class="keyword">if</span> _, ok := myInterface.(*Test);!ok &#123;</span><br><span class="line">  <span class="built_in">panic</span>(<span class="string">&quot;myInterface ä¸æ˜¯ Testå®ä¾‹&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>åœ¨ç±»å‹æ–­è¨€çš„æ—¶å€™ï¼ŒåŒæ—¶å®Œæˆäº†ç±»å‹è½¬æ¢</strong></p>
<h2 id="Error"><a href="#Error" class="headerlink" title="Error"></a>Error</h2><p>åœ¨ Go è¯­è¨€ä¸­ï¼Œé”™è¯¯æ˜¯é€šè¿‡å†…ç½®çš„ error æ¥å£è¡¨ç¤ºçš„ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// error å®šä¹‰</span></span><br><span class="line"><span class="keyword">type</span> <span class="type">error</span> <span class="keyword">interface</span> &#123;</span><br><span class="line">   Error() <span class="type">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å·¥å‚å‡½æ•°</span></span><br><span class="line">errors.New(<span class="string">&quot;error&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>è‡ªå®šä¹‰å¼‚å¸¸</strong></p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> commonError <span class="keyword">struct</span> &#123;</span><br><span class="line">  errorCode <span class="type">int</span>    <span class="comment">//é”™è¯¯ç </span></span><br><span class="line">  errorMsg  <span class="type">string</span> <span class="comment">//é”™è¯¯ä¿¡æ¯</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"> <span class="comment">// å®ç°äº†Error()å°±æ˜¯è‡ªå®šä¹‰å¼‚å¸¸ </span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(ce *commonError)</span></span> Error() <span class="type">string</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> ce.errorMsg</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Error-Wrapping"><a href="#Error-Wrapping" class="headerlink" title="Error Wrapping"></a>Error Wrapping</h3><p>ä¸Šè¿°è‡ªå®šä¹‰å¼‚å¸¸å¯ä»¥æ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚ï¼Œä½†æ˜¯éå¸¸çƒ¦çï¼Œå› ä¸ºæ—¢è¦å®šä¹‰æ–°çš„ç±»å‹è¿˜è¦å®ç° error æ¥å£ã€‚</p>
<p>&#x20;Go è¯­è¨€ 1.13 ç‰ˆæœ¬å¼€å§‹ï¼ŒGo æ ‡å‡†åº“æ–°å¢äº† Error Wrapping åŠŸèƒ½ï¼Œè®©æˆ‘ä»¬å¯ä»¥åŸºäºä¸€ä¸ªå­˜åœ¨çš„ error ç”Ÿæˆæ–°çš„ errorï¼Œå¹¶ä¸”å¯ä»¥ä¿ç•™åŸ error ä¿¡æ¯ã€‚</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// wrap</span></span><br><span class="line">e := errors.New(<span class="string">&quot;åŸå§‹é”™è¯¯e&quot;</span>)</span><br><span class="line">w := fmt.Errorf(<span class="string">&quot;Wrapäº†ä¸€ä¸ªé”™è¯¯:%w&quot;</span>, e)</span><br><span class="line">fmt.Println(w)   <span class="comment">// wrapäº†ä¸€ä¸ªé”™è¯¯:åŸå§‹é”™è¯¯e</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Unwrap</span></span><br><span class="line">fmt.Println(errors.Unwrap(w))   <span class="comment">// åŸå§‹é”™è¯¯e</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="errors-Is"><a href="#errors-Is" class="headerlink" title="errors.Is"></a>errors.Is</h3><p>æœ‰äº† Error Wrapping åï¼Œä½ ä¼šå‘ç°åŸæ¥ç”¨çš„åˆ¤æ–­ä¸¤ä¸ª error æ˜¯ä¸æ˜¯åŒä¸€ä¸ª error çš„æ–¹æ³•å¤±æ•ˆäº†ï¼Œæ¯”å¦‚ Go è¯­è¨€æ ‡å‡†åº“ç»å¸¸ç”¨åˆ°çš„å¦‚ä¸‹ä»£ç ä¸­çš„æ–¹å¼ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line">fmt.Println(errors.Is(w, e))  <span class="comment">// true</span></span><br><span class="line">fmt.Println(e == os.ErrExist) <span class="comment">// false</span></span><br></pre></td></tr></table></figure>

<p><code>errors.ls</code></p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Is</span><span class="params">(err, target <span class="type">error</span>)</span></span> <span class="type">bool</span></span><br></pre></td></tr></table></figure>

<p>ä»¥ä¸Šå°±æ˜¯errors.Is å‡½æ•°çš„å®šä¹‰ï¼Œå¯ä»¥è§£é‡Šä¸ºï¼š</p>
<ul>
<li>å¦‚æœ err å’Œ target æ˜¯åŒä¸€ä¸ªï¼Œé‚£ä¹ˆè¿”å› trueã€‚</li>
<li>å¦‚æœ err æ˜¯ä¸€ä¸ª wrapping errorï¼Œtarget ä¹ŸåŒ…å«åœ¨è¿™ä¸ªåµŒå¥— error é“¾ä¸­çš„è¯ï¼Œä¹Ÿè¿”å› trueã€‚</li>
</ul>
<blockquote>
<p>ğŸ“Œå¯ä»¥ç®€å•åœ°æ¦‚æ‹¬ä¸ºï¼Œä¸¤ä¸ª error ç›¸ç­‰æˆ– err åŒ…å« target çš„æƒ…å†µä¸‹è¿”å› trueï¼Œå…¶ä½™è¿”å› falseã€‚</p>
</blockquote>
<h3 id="errors-As"><a href="#errors-As" class="headerlink" title="errors.As"></a>errors.As</h3><p>åŒæ ·çš„åŸå› ï¼Œæœ‰äº† error åµŒå¥—åï¼Œerror æ–­è¨€ä¹Ÿä¸èƒ½ç”¨äº†ï¼Œå› ä¸ºä½ ä¸çŸ¥é“ä¸€ä¸ª error æ˜¯å¦è¢«åµŒå¥—ï¼ŒåˆåµŒå¥—äº†å‡ å±‚ã€‚æ‰€ä»¥ Go è¯­è¨€ä¸ºè§£å†³è¿™ä¸ªé—®é¢˜æä¾›äº† errors.As å‡½æ•°ï¼Œæ¯”å¦‚å‰é¢ error æ–­è¨€çš„ä¾‹å­ï¼Œå¯ä»¥ä½¿ç”¨  errors.As å‡½æ•°é‡å†™ï¼Œæ•ˆæœæ˜¯ä¸€æ ·çš„ï¼Œå¦‚ä¸‹é¢çš„ä»£ç æ‰€ç¤ºï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> cm *commonError</span><br><span class="line"><span class="keyword">if</span> errors.As(err,&amp;cm)&#123;</span><br><span class="line">   fmt.Println(<span class="string">&quot;é”™è¯¯ä»£ç ä¸º:&quot;</span>,cm.errorCode,<span class="string">&quot;ï¼Œé”™è¯¯ä¿¡æ¯ä¸ºï¼š&quot;</span>,cm.errorMsg)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">   fmt.Println(sum)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Deferred"><a href="#Deferred" class="headerlink" title="Deferred"></a>Deferred</h3><p>defer è¯­å¥å¸¸è¢«ç”¨äºæˆå¯¹çš„æ“ä½œï¼Œå¦‚æ–‡ä»¶çš„æ‰“å¼€å’Œå…³é—­ï¼ŒåŠ é”å’Œé‡Šæ”¾é”ï¼Œè¿æ¥çš„å»ºç«‹å’Œæ–­å¼€ç­‰ã€‚ä¸ç®¡å¤šä¹ˆå¤æ‚çš„æ“ä½œï¼Œéƒ½å¯ä»¥ä¿è¯èµ„æºè¢«æ­£ç¡®åœ°é‡Šæ”¾ã€‚</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">ReadFile</span><span class="params">(filename <span class="type">string</span>)</span></span> ([]<span class="type">byte</span>, <span class="type">error</span>) &#123;</span><br><span class="line">   f, err := os.Open(filename)</span><br><span class="line">   <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">defer</span> f.Close()</span><br><span class="line">   <span class="comment">//çœç•¥æ— å…³ä»£ç </span></span><br><span class="line">   <span class="keyword">return</span> readAll(f, n)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol>
<li>åœ¨ä¸€ä¸ªæ–¹æ³•æˆ–è€…å‡½æ•°ä¸­ï¼Œå¯ä»¥æœ‰å¤šä¸ª defer è¯­å¥ï¼›</li>
<li>defer æœ‰ä¸€ä¸ªè°ƒç”¨æ ˆï¼Œå¤šä¸ª defer è¯­å¥çš„æ‰§è¡Œé¡ºåºä¾ç…§<strong>åè¿›å…ˆå‡º</strong>çš„åŸåˆ™ã€‚</li>
</ol>
<h3 id="Panic"><a href="#Panic" class="headerlink" title="Panic"></a>Panic</h3><p>Go è¯­è¨€æ˜¯ä¸€é—¨é™æ€çš„å¼ºç±»å‹è¯­è¨€ï¼Œå¾ˆå¤šé—®é¢˜éƒ½å°½å¯èƒ½åœ°åœ¨ç¼–è¯‘æ—¶æ•è·ï¼Œä½†æ˜¯æœ‰ä¸€äº›åªèƒ½åœ¨è¿è¡Œæ—¶æ£€æŸ¥ï¼Œæ¯”å¦‚æ•°ç»„è¶Šç•Œè®¿é—®ã€ä¸ç›¸åŒçš„ç±»å‹å¼ºåˆ¶è½¬æ¢ç­‰ï¼Œè¿™ç±»è¿è¡Œæ—¶çš„é—®é¢˜ä¼šå¼•èµ· panic å¼‚å¸¸ã€‚é™¤äº†è¿è¡Œæ—¶å¯ä»¥äº§ç”Ÿ panic å¤–ï¼Œæˆ‘ä»¬è‡ªå·±ä¹Ÿå¯ä»¥æŠ›å‡º panic å¼‚å¸¸ã€‚</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">panic</span><span class="params">(v <span class="keyword">interface</span>&#123;&#125;)</span></span></span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>interface&#123;&#125;</code> æ˜¯ç©ºæ¥å£çš„æ„æ€ï¼Œåœ¨ Go è¯­è¨€ä¸­ä»£è¡¨ä»»æ„ç±»å‹ã€‚</p>
</blockquote>
<p>panic å¼‚å¸¸æ˜¯ä¸€ç§éå¸¸ä¸¥é‡çš„æƒ…å†µï¼Œä¼šè®©ç¨‹åºä¸­æ–­è¿è¡Œï¼Œä½¿ç¨‹åºå´©æºƒï¼Œæ‰€ä»¥<strong>å¦‚æœæ˜¯ä¸å½±å“ç¨‹åºè¿è¡Œçš„é”™è¯¯ï¼Œä¸è¦ä½¿ç”¨ panicï¼Œä½¿ç”¨æ™®é€šé”™è¯¯ error å³å¯ã€‚</strong></p>
<h4 id="Recover-æ•è·-Panic-å¼‚å¸¸"><a href="#Recover-æ•è·-Panic-å¼‚å¸¸" class="headerlink" title="Recover æ•è· Panic å¼‚å¸¸"></a>Recover æ•è· Panic å¼‚å¸¸</h4><p>é€šå¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¸å¯¹ panic å¼‚å¸¸åšä»»ä½•å¤„ç†ï¼Œå› ä¸ºæ—¢ç„¶å®ƒæ˜¯å½±å“ç¨‹åºè¿è¡Œçš„å¼‚å¸¸ï¼Œå°±è®©å®ƒç›´æ¥å´©æºƒå³å¯ã€‚ä½†æ˜¯ä¹Ÿçš„ç¡®æœ‰ä¸€äº›ç‰¹ä¾‹ï¼Œæ¯”å¦‚<strong>åœ¨ç¨‹åºå´©æºƒå‰åšä¸€äº›èµ„æºé‡Šæ”¾çš„å¤„ç†</strong>ï¼Œè¿™æ—¶å€™å°±éœ€è¦ä» panic å¼‚å¸¸ä¸­æ¢å¤ï¼Œæ‰èƒ½å®Œæˆå¤„ç†ã€‚</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">connectMySQL</span><span class="params">(ip, username, password <span class="type">string</span>)</span></span> &#123;</span><br><span class="line">  <span class="keyword">if</span> ip == <span class="string">&quot;&quot;</span> &#123;</span><br><span class="line">    <span class="built_in">panic</span>(<span class="string">&quot;ipä¸èƒ½ä¸ºç©º&quot;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//çœç•¥å…¶ä»–ä»£ç </span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> p := <span class="built_in">recover</span>(); p != <span class="literal">nil</span> &#123;</span><br><span class="line">      fmt.Println(p)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;()</span><br><span class="line">  connectMySQL(<span class="string">&quot;&quot;</span>, <span class="string">&quot;root&quot;</span>, <span class="string">&quot;123456&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="å¹¶å‘åŸºç¡€"><a href="#å¹¶å‘åŸºç¡€" class="headerlink" title="å¹¶å‘åŸºç¡€"></a>å¹¶å‘åŸºç¡€</h1><h2 id="åç¨‹ï¼ˆGoroutineï¼‰"><a href="#åç¨‹ï¼ˆGoroutineï¼‰" class="headerlink" title="åç¨‹ï¼ˆGoroutineï¼‰"></a>åç¨‹ï¼ˆGoroutineï¼‰</h2><p>Go è¯­è¨€ä¸­æ²¡æœ‰çº¿ç¨‹çš„æ¦‚å¿µï¼Œåªæœ‰åç¨‹ï¼Œä¹Ÿç§°ä¸º goroutineã€‚</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">go</span> function()</span><br></pre></td></tr></table></figure>

<h2 id="Channel"><a href="#Channel" class="headerlink" title="Channel"></a>Channel</h2><figure class="highlight go"><table><tr><td class="code"><pre><span class="line">ch:=<span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">string</span>)</span><br></pre></td></tr></table></figure>

<ol>
<li>æ¥æ”¶ï¼šè·å– chan ä¸­çš„å€¼ï¼Œæ“ä½œç¬¦ä¸º<code> &lt;- chan</code>ã€‚</li>
<li>å‘é€ï¼šå‘ chan å‘é€å€¼ï¼ŒæŠŠå€¼æ”¾åœ¨ chan ä¸­ï¼Œæ“ä½œç¬¦ä¸º <code>chan &lt;-</code>ã€‚</li>
</ol>
<h3 id="æ— ç¼“å†²-channel"><a href="#æ— ç¼“å†²-channel" class="headerlink" title="æ— ç¼“å†² channel"></a><strong>æ— ç¼“å†² channel</strong></h3><p>æ— ç¼“å†² channelï¼Œå®ƒçš„å®¹é‡æ˜¯ 0ï¼Œä¸èƒ½å­˜å‚¨ä»»ä½•æ•°æ®ã€‚æ‰€ä»¥æ— ç¼“å†² channel åªèµ·åˆ°ä¼ è¾“æ•°æ®çš„ä½œç”¨ï¼Œæ•°æ®å¹¶ä¸ä¼šåœ¨ channel ä¸­åšä»»ä½•åœç•™ã€‚è¿™ä¹Ÿæ„å‘³ç€ï¼Œæ— ç¼“å†² channel çš„å‘é€å’Œæ¥æ”¶æ“ä½œæ˜¯åŒæ—¶è¿›è¡Œçš„ï¼Œå®ƒä¹Ÿå¯ä»¥ç§°ä¸ºåŒæ­¥ channelã€‚</p>
<h3 id="æœ‰ç¼“å†²-channel"><a href="#æœ‰ç¼“å†²-channel" class="headerlink" title="æœ‰ç¼“å†² channel"></a>æœ‰ç¼“å†² channel</h3><p>æœ‰ç¼“å†² channel ç±»ä¼¼ä¸€ä¸ªå¯é˜»å¡çš„é˜Ÿåˆ—ï¼Œå†…éƒ¨çš„å…ƒç´ <em><strong>å…ˆè¿›å…ˆå‡º</strong></em>ã€‚é€šè¿‡ make å‡½æ•°çš„ç¬¬äºŒä¸ªå‚æ•°å¯ä»¥æŒ‡å®š channel å®¹é‡çš„å¤§å°ï¼Œè¿›è€Œåˆ›å»ºä¸€ä¸ªæœ‰ç¼“å†² channelã€‚</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line">cacheCh:=<span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">int</span>,<span class="number">5</span>)</span><br></pre></td></tr></table></figure>

<p><img src="/../images/CgqCHl-7fzmAVLu0AACSjW-neAE188_KyDQkHLLjx.png"></p>
<p>ä¸€ä¸ªæœ‰ç¼“å†² channel å…·å¤‡ä»¥ä¸‹ç‰¹ç‚¹ï¼š</p>
<ol>
<li>æœ‰ç¼“å†² channel çš„å†…éƒ¨æœ‰ä¸€ä¸ªç¼“å†²é˜Ÿåˆ—ï¼›</li>
<li>å‘é€æ“ä½œæ˜¯å‘é˜Ÿåˆ—çš„å°¾éƒ¨æ’å…¥å…ƒç´ ï¼Œå¦‚æœé˜Ÿåˆ—å·²æ»¡ï¼Œåˆ™é˜»å¡ç­‰å¾…ï¼Œç›´åˆ°å¦ä¸€ä¸ª goroutine æ‰§è¡Œï¼Œæ¥æ”¶æ“ä½œé‡Šæ”¾é˜Ÿåˆ—çš„ç©ºé—´ï¼›</li>
<li>æ¥æ”¶æ“ä½œæ˜¯ä»é˜Ÿåˆ—çš„å¤´éƒ¨è·å–å…ƒç´ å¹¶æŠŠå®ƒä»é˜Ÿåˆ—ä¸­åˆ é™¤ï¼Œå¦‚æœé˜Ÿåˆ—ä¸ºç©ºï¼Œåˆ™é˜»å¡ç­‰å¾…ï¼Œç›´åˆ°å¦ä¸€ä¸ª goroutine æ‰§è¡Œï¼Œå‘é€æ“ä½œæ’å…¥æ–°çš„å…ƒç´ ã€‚</li>
</ol>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// è·å–é˜Ÿåˆ—å®¹é‡å’Œå…ƒç´ ä¸ªæ•°ï¼š</span></span><br><span class="line">fmt.Println(<span class="string">&quot;cacheChå®¹é‡ä¸º:&quot;</span>,<span class="built_in">cap</span>(cacheCh),<span class="string">&quot;,å…ƒç´ ä¸ªæ•°ä¸ºï¼š&quot;</span>,<span class="built_in">len</span>(cacheCh))</span><br><span class="line"></span><br><span class="line"><span class="comment">// å…³é—­ channel</span></span><br><span class="line"><span class="built_in">close</span>(cacheCh)</span><br></pre></td></tr></table></figure>

<p>å¦‚æœä¸€ä¸ª channel è¢«å…³é—­äº†ï¼Œå°±ä¸èƒ½å‘é‡Œé¢å‘é€æ•°æ®äº†ï¼Œå¦‚æœå‘é€çš„è¯ï¼Œä¼šå¼•èµ· painc å¼‚å¸¸ã€‚ä½†æ˜¯è¿˜å¯ä»¥æ¥æ”¶ channel é‡Œçš„æ•°æ®ï¼Œå¦‚æœ channel é‡Œæ²¡æœ‰æ•°æ®çš„è¯ï¼Œæ¥æ”¶çš„æ•°æ®æ˜¯å…ƒç´ ç±»å‹çš„é›¶å€¼ã€‚</p>
<h3 id="å•å‘-channel"><a href="#å•å‘-channel" class="headerlink" title="å•å‘ channel"></a>å•å‘ channel</h3><p>æœ‰æ—¶å€™ï¼Œæˆ‘ä»¬æœ‰ä¸€äº›ç‰¹æ®Šçš„ä¸šåŠ¡éœ€æ±‚ï¼Œæ¯”å¦‚é™åˆ¶ä¸€ä¸ª channel åªå¯ä»¥æ¥æ”¶ä½†æ˜¯ä¸èƒ½å‘é€ï¼Œæˆ–è€…é™åˆ¶ä¸€ä¸ª channel åªèƒ½å‘é€ä½†ä¸èƒ½æ¥æ”¶ï¼Œè¿™ç§ channel ç§°ä¸ºå•å‘ channelã€‚</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line">onlySend := <span class="built_in">make</span>(<span class="keyword">chan</span>&lt;- <span class="type">int</span>)</span><br><span class="line">onlyReceive:=<span class="built_in">make</span>(&lt;-<span class="keyword">chan</span> <span class="type">int</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="select-å¤šè·¯å¤ç”¨"><a href="#select-å¤šè·¯å¤ç”¨" class="headerlink" title="select å¤šè·¯å¤ç”¨"></a>select å¤šè·¯å¤ç”¨</h3><blockquote>
<p>å°æç¤ºï¼šå¤šè·¯å¤ç”¨å¯ä»¥ç®€å•åœ°ç†è§£ä¸ºï¼ŒN ä¸ª channel ä¸­ï¼Œä»»æ„ä¸€ä¸ª channel æœ‰æ•°æ®äº§ç”Ÿï¼Œselect éƒ½å¯ä»¥ç›‘å¬åˆ°ï¼Œç„¶åæ‰§è¡Œç›¸åº”çš„åˆ†æ”¯ï¼Œæ¥æ”¶æ•°æ®å¹¶å¤„ç†ã€‚</p>
</blockquote>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> &#123;</span><br><span class="line">   <span class="keyword">case</span> i1 = &lt;-c1:</span><br><span class="line">     <span class="comment">//todo</span></span><br><span class="line">   <span class="keyword">case</span> c2 &lt;- i2:</span><br><span class="line">     <span class="comment">//todo</span></span><br><span class="line">   <span class="keyword">default</span>:</span><br><span class="line">     <span class="comment">// default todo</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="sync-åŒ…"><a href="#sync-åŒ…" class="headerlink" title="sync åŒ…"></a>sync åŒ…</h2><blockquote>
<p>å°æŠ€å·§ï¼šä½¿ç”¨ go buildã€go runã€go test è¿™äº› Go è¯­è¨€å·¥å…·é“¾æä¾›çš„å‘½ä»¤æ—¶ï¼Œæ·»åŠ  <code>-race</code> æ ‡è¯†å¯ä»¥å¸®ä½ æ£€æŸ¥ Go è¯­è¨€ä»£ç æ˜¯å¦å­˜åœ¨èµ„æºç«äº‰ã€‚</p>
</blockquote>
<h3 id="sync-Mutex"><a href="#sync-Mutex" class="headerlink" title="sync.Mutex"></a><strong>sync.Mutex</strong></h3><p>äº’æ–¥é”ï¼Œé¡¾åæ€ä¹‰ï¼ŒæŒ‡çš„æ˜¯åœ¨åŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªåç¨‹æ‰§è¡ŒæŸæ®µä»£ç ï¼Œå…¶ä»–åç¨‹éƒ½è¦ç­‰å¾…è¯¥åç¨‹æ‰§è¡Œå®Œæ¯•åæ‰èƒ½ç»§ç»­æ‰§è¡Œã€‚</p>
<p>Mutex çš„ <code>Lock</code> å’Œ <code>Unlock</code> æ–¹æ³•æ€»æ˜¯æˆå¯¹å‡ºç°ï¼Œè€Œä¸”è¦ç¡®ä¿ Lock è·å¾—é”åï¼Œä¸€å®šæ‰§è¡Œ UnLock é‡Šæ”¾é”</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span>(</span><br><span class="line">   sum <span class="type">int</span></span><br><span class="line">   mutex sync.Mutex</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">add</span><span class="params">(i <span class="type">int</span>)</span></span> &#123;</span><br><span class="line">   mutex.Lock()</span><br><span class="line">   sum += i</span><br><span class="line">   mutex.Unlock()</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>å°æç¤ºï¼šä»¥ä¸Šè¢«åŠ é”ä¿æŠ¤çš„ sum+&#x3D;i ä»£ç ç‰‡æ®µåˆç§°ä¸º<strong>ä¸´ç•ŒåŒº</strong>ã€‚åœ¨åŒæ­¥çš„ç¨‹åºè®¾è®¡ä¸­ï¼Œä¸´ç•ŒåŒºæ®µæŒ‡çš„æ˜¯ä¸€ä¸ªè®¿é—®å…±äº«èµ„æºçš„ç¨‹åºç‰‡æ®µï¼Œè€Œè¿™äº›å…±äº«èµ„æºåˆæœ‰æ— æ³•åŒæ—¶è¢«å¤šä¸ªåç¨‹è®¿é—®çš„ç‰¹æ€§ã€‚</p>
</blockquote>
<h3 id="sync-RWMutex"><a href="#sync-RWMutex" class="headerlink" title="sync.RWMutex"></a>sync.RWMutex</h3><p>goä¸­çš„è¯»å†™é”ã€‚ä½¿ç”¨ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> mutex sync.RWMutex</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">readSum</span><span class="params">()</span></span> <span class="type">int</span> &#123;</span><br><span class="line"></span><br><span class="line">   <span class="comment">//åªè·å–è¯»é”</span></span><br><span class="line">   mutex.RLock()</span><br><span class="line">   <span class="keyword">defer</span> mutex.RUnlock()</span><br><span class="line">   b:=sum</span><br><span class="line"></span><br><span class="line">   <span class="keyword">return</span> b</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="sync-WaitGroup"><a href="#sync-WaitGroup" class="headerlink" title="sync.WaitGroup"></a>sync.WaitGroup</h3><p>ç›¸å½“äºJavaä¸­çš„***<code>CountDownLatch</code>** *ï¼Œç”¨äºæœ€ç»ˆå®Œæˆçš„åœºæ™¯ï¼Œå…³é”®ç‚¹åœ¨äºä¸€å®šè¦ç­‰å¾…æ‰€æœ‰åç¨‹éƒ½æ‰§è¡Œå®Œæ¯•ã€‚</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">run</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">var</span> wg sync.WaitGroup</span><br><span class="line"></span><br><span class="line">   <span class="comment">//å› ä¸ºè¦ç›‘æ§110ä¸ªåç¨‹ï¼Œæ‰€ä»¥è®¾ç½®è®¡æ•°å™¨ä¸º110</span></span><br><span class="line">   wg.Add(<span class="number">110</span>)</span><br><span class="line">   <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">100</span>; i++ &#123;</span><br><span class="line">      <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">         <span class="comment">//è®¡æ•°å™¨å€¼å‡1</span></span><br><span class="line">         <span class="keyword">defer</span> wg.Done()</span><br><span class="line">         add(<span class="number">10</span>)</span><br><span class="line">      &#125;()</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">for</span> i:=<span class="number">0</span>; i&lt;<span class="number">10</span>;i++ &#123;</span><br><span class="line">      <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">         <span class="comment">//è®¡æ•°å™¨å€¼å‡1</span></span><br><span class="line">         <span class="keyword">defer</span> wg.Done()</span><br><span class="line">         fmt.Println(<span class="string">&quot;å’Œä¸º:&quot;</span>,readSum())</span><br><span class="line">      &#125;()</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">//ä¸€ç›´ç­‰å¾…ï¼Œç›´åˆ°è®¡æ•°å™¨å€¼ä¸º0</span></span><br><span class="line">   wg.Wait()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="sync-Once"><a href="#sync-Once" class="headerlink" title="sync.Once"></a>sync.Once</h3><p>è®©ä»£ç åªæ‰§è¡Œä¸€æ¬¡ï¼Œå“ªæ€•æ˜¯åœ¨é«˜å¹¶å‘çš„æƒ…å†µä¸‹ï¼Œæ¯”å¦‚åˆ›å»ºä¸€ä¸ªå•ä¾‹ã€‚</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   doOnce()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">doOnce</span><span class="params">()</span></span> &#123;</span><br><span class="line">   <span class="keyword">var</span> once sync.Once</span><br><span class="line">   onceBody := <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">      fmt.Println(<span class="string">&quot;Only once&quot;</span>)</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">//ç”¨äºç­‰å¾…åç¨‹æ‰§è¡Œå®Œæ¯•</span></span><br><span class="line">   done := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">bool</span>)</span><br><span class="line"></span><br><span class="line">   <span class="comment">//å¯åŠ¨10ä¸ªåç¨‹æ‰§è¡Œonce.Do(onceBody)</span></span><br><span class="line">   <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10</span>; i++ &#123;</span><br><span class="line">      <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">         <span class="comment">//æŠŠè¦æ‰§è¡Œçš„å‡½æ•°(æ–¹æ³•)ä½œä¸ºå‚æ•°ä¼ ç»™once.Doæ–¹æ³•å³å¯</span></span><br><span class="line">         once.Do(onceBody)</span><br><span class="line">         done &lt;- <span class="literal">true</span></span><br><span class="line">      &#125;()</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10</span>; i++ &#123;</span><br><span class="line">      &lt;-done</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="sync-Cond"><a href="#sync-Cond" class="headerlink" title="sync.Cond"></a>sync.Cond</h3><p>sync.Cond å¯ä»¥ç”¨äºå‘å·æ–½ä»¤ï¼Œä¸€å£°ä»¤ä¸‹æ‰€æœ‰åç¨‹éƒ½å¯ä»¥å¼€å§‹æ‰§è¡Œï¼Œå…³é”®ç‚¹åœ¨äºåç¨‹å¼€å§‹çš„æ—¶å€™æ˜¯ç­‰å¾…çš„ï¼Œè¦ç­‰å¾… sync.Cond å”¤é†’æ‰èƒ½æ‰§è¡Œã€‚</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">//10ä¸ªäººèµ›è·‘ï¼Œ1ä¸ªè£åˆ¤å‘å·æ–½ä»¤</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">race</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">   cond :=sync.NewCond(&amp;sync.Mutex&#123;&#125;)</span><br><span class="line">   <span class="keyword">var</span> wg sync.WaitGroup</span><br><span class="line">   wg.Add(<span class="number">11</span>)</span><br><span class="line"></span><br><span class="line">   <span class="keyword">for</span> i:=<span class="number">0</span>;i&lt;<span class="number">10</span>; i++ &#123;</span><br><span class="line">      <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">(num <span class="type">int</span>)</span></span> &#123;</span><br><span class="line">         <span class="keyword">defer</span>  wg.Done()</span><br><span class="line">         fmt.Println(num,<span class="string">&quot;å·å·²ç»å°±ä½&quot;</span>)</span><br><span class="line">         cond.L.Lock()</span><br><span class="line">         cond.Wait()<span class="comment">//ç­‰å¾…å‘ä»¤æªå“</span></span><br><span class="line">         fmt.Println(num,<span class="string">&quot;å·å¼€å§‹è·‘â€¦â€¦&quot;</span>)</span><br><span class="line">         cond.L.Unlock()</span><br><span class="line">      &#125;(i)</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">//ç­‰å¾…æ‰€æœ‰goroutineéƒ½è¿›å…¥waitçŠ¶æ€</span></span><br><span class="line">   time.Sleep(<span class="number">2</span>*time.Second)</span><br><span class="line"></span><br><span class="line">   <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">      <span class="keyword">defer</span>  wg.Done()</span><br><span class="line">      fmt.Println(<span class="string">&quot;è£åˆ¤å·²ç»å°±ä½ï¼Œå‡†å¤‡å‘ä»¤æª&quot;</span>)</span><br><span class="line">      fmt.Println(<span class="string">&quot;æ¯”èµ›å¼€å§‹ï¼Œå¤§å®¶å‡†å¤‡è·‘&quot;</span>)</span><br><span class="line">      cond.Broadcast()<span class="comment">//å‘ä»¤æªå“</span></span><br><span class="line">   &#125;()</span><br><span class="line">   <span class="comment">//é˜²æ­¢å‡½æ•°æå‰è¿”å›é€€å‡º</span></span><br><span class="line">   wg.Wait()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol>
<li><strong>Wait</strong>ï¼Œé˜»å¡å½“å‰åç¨‹ï¼Œç›´åˆ°è¢«å…¶ä»–åç¨‹è°ƒç”¨ Broadcast æˆ–è€… Signal æ–¹æ³•å”¤é†’ï¼Œä½¿ç”¨çš„æ—¶å€™éœ€è¦åŠ é”ï¼Œä½¿ç”¨ sync.Cond ä¸­çš„é”å³å¯ï¼Œä¹Ÿå°±æ˜¯ L å­—æ®µã€‚</li>
<li><strong>Signal</strong>ï¼Œå”¤é†’ä¸€ä¸ªç­‰å¾…æ—¶é—´æœ€é•¿çš„åç¨‹ã€‚</li>
<li><strong>Broadcast</strong>ï¼Œå”¤é†’æ‰€æœ‰ç­‰å¾…çš„åç¨‹ã€‚</li>
</ol>
<blockquote>
<p>æ³¨æ„ï¼šåœ¨è°ƒç”¨ Signal æˆ–è€… Broadcast ä¹‹å‰ï¼Œè¦ç¡®ä¿ç›®æ ‡åç¨‹å¤„äº Wait é˜»å¡çŠ¶æ€ï¼Œä¸ç„¶ä¼šå‡ºç°æ­»é”é—®é¢˜ã€‚</p>
</blockquote>
<p>å¦‚æœä½ ä»¥å‰å­¦è¿‡ Javaï¼Œä¼šå‘ç° sync.Cond å’Œ Java çš„ç­‰å¾…å”¤é†’æœºåˆ¶å¾ˆåƒï¼Œå®ƒçš„ä¸‰ä¸ªæ–¹æ³• Waitã€Signalã€Broadcast å°±åˆ†åˆ«å¯¹åº” Java ä¸­çš„ waitã€notifyã€notifyAllã€‚</p>
<h2 id="Context"><a href="#Context" class="headerlink" title="Context"></a>Context</h2><blockquote>
<p>ä¸€ä¸ªä»»åŠ¡ä¼šæœ‰å¾ˆå¤šä¸ªåç¨‹åä½œå®Œæˆï¼Œä¸€æ¬¡ HTTP è¯·æ±‚ä¹Ÿä¼šè§¦å‘å¾ˆå¤šä¸ªåç¨‹çš„å¯åŠ¨ï¼Œè€Œè¿™äº›åç¨‹æœ‰å¯èƒ½ä¼šå¯åŠ¨æ›´å¤šçš„å­åç¨‹ï¼Œå¹¶ä¸”æ— æ³•é¢„çŸ¥æœ‰å¤šå°‘å±‚åç¨‹ã€æ¯ä¸€å±‚æœ‰å¤šå°‘ä¸ªåç¨‹ã€‚</p>
<p>å¦‚æœå› ä¸ºæŸäº›åŸå› å¯¼è‡´ä»»åŠ¡ç»ˆæ­¢äº†ï¼ŒHTTP è¯·æ±‚å–æ¶ˆäº†ï¼Œé‚£ä¹ˆå®ƒä»¬å¯åŠ¨çš„åç¨‹æ€ä¹ˆåŠï¼Ÿè¯¥å¦‚ä½•å–æ¶ˆå‘¢ï¼Ÿå› ä¸ºå–æ¶ˆè¿™äº›åç¨‹å¯ä»¥èŠ‚çº¦å†…å­˜ï¼Œæå‡æ€§èƒ½ï¼ŒåŒæ—¶é¿å…ä¸å¯é¢„æ–™çš„ Bugã€‚</p>
<p>Context å°±æ˜¯ç”¨æ¥ç®€åŒ–è§£å†³è¿™äº›é—®é¢˜çš„ï¼Œå¹¶ä¸”æ˜¯å¹¶å‘å®‰å…¨çš„ã€‚Context æ˜¯ä¸€ä¸ªæ¥å£ï¼Œå®ƒå…·å¤‡æ‰‹åŠ¨ã€å®šæ—¶ã€è¶…æ—¶å‘å‡ºå–æ¶ˆä¿¡å·ã€ä¼ å€¼ç­‰åŠŸèƒ½ï¼Œä¸»è¦ç”¨äºæ§åˆ¶å¤šä¸ªåç¨‹ä¹‹é—´çš„åä½œï¼Œå°¤å…¶æ˜¯å–æ¶ˆæ“ä½œã€‚ä¸€æ—¦å–æ¶ˆæŒ‡ä»¤ä¸‹è¾¾ï¼Œé‚£ä¹ˆè¢« Context è·Ÿè¸ªçš„è¿™äº›åç¨‹éƒ½ä¼šæ”¶åˆ°å–æ¶ˆä¿¡å·ï¼Œå°±å¯ä»¥åšæ¸…ç†å’Œé€€å‡ºæ“ä½œã€‚</p>
</blockquote>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> Context <span class="keyword">interface</span> &#123;</span><br><span class="line"></span><br><span class="line">   Deadline() (deadline time.Time, ok <span class="type">bool</span>)</span><br><span class="line">   Done() &lt;-<span class="keyword">chan</span> <span class="keyword">struct</span>&#123;&#125;</span><br><span class="line">   Err() <span class="type">error</span></span><br><span class="line">   Value(key <span class="keyword">interface</span>&#123;&#125;) <span class="keyword">interface</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Context-æ ‘"><a href="#Context-æ ‘" class="headerlink" title="Context æ ‘"></a>Context æ ‘</h3><p>Go è¯­è¨€æä¾›äº†å‡½æ•°å¯ä»¥å¸®åŠ©æˆ‘ä»¬ç”Ÿæˆä¸åŒçš„ Contextï¼Œé€šè¿‡è¿™äº›å‡½æ•°å¯ä»¥ç”Ÿæˆä¸€é¢— Context æ ‘ï¼Œè¿™æ · Context æ‰å¯ä»¥å…³è”èµ·æ¥ï¼Œçˆ¶ Context å‘å‡ºå–æ¶ˆä¿¡å·çš„æ—¶å€™ï¼Œå­ Context ä¹Ÿä¼šå‘å‡ºï¼Œè¿™æ ·å°±å¯ä»¥æ§åˆ¶ä¸åŒå±‚çº§çš„åç¨‹é€€å‡ºã€‚</p>
<p>ä»ä½¿ç”¨åŠŸèƒ½ä¸Šåˆ†ï¼Œæœ‰å››ç§å®ç°å¥½çš„ Contextã€‚</p>
<ol>
<li><strong>ç©º Context</strong>ï¼šä¸å¯å–æ¶ˆï¼Œæ²¡æœ‰æˆªæ­¢æ—¶é—´ï¼Œä¸»è¦ç”¨äº Context æ ‘çš„æ ¹èŠ‚ç‚¹ã€‚</li>
<li><strong>å¯å–æ¶ˆçš„ Context</strong>ï¼šç”¨äºå‘å‡ºå–æ¶ˆä¿¡å·ï¼Œå½“å–æ¶ˆçš„æ—¶å€™ï¼Œå®ƒçš„å­ Context ä¹Ÿä¼šå–æ¶ˆã€‚</li>
<li><strong>å¯å®šæ—¶å–æ¶ˆçš„ Context</strong>ï¼šå¤šäº†ä¸€ä¸ªå®šæ—¶çš„åŠŸèƒ½ã€‚</li>
<li><strong>å€¼ Context</strong>ï¼šç”¨äºå­˜å‚¨ä¸€ä¸ª key-value é”®å€¼å¯¹ã€‚</li>
</ol>
<p><img src="/../images/CgqCHl_EyHOARbBqAAKzKmhclWo807_A5KZtclRKo.png"></p>
<p><code> context.Background()</code>è·å–ä¸€ä¸ªæ ¹èŠ‚ç‚¹ Contextã€‚</p>
<hr>
<p>&#x20;Context æ ‘è¦æ€ä¹ˆç”Ÿæˆå‘¢ï¼Ÿ</p>
<ol>
<li>**<code>WithCancel(parent Context)</code>**ï¼šç”Ÿæˆä¸€ä¸ªå¯å–æ¶ˆçš„ Contextã€‚<ol>
<li>**<code>WithDeadline(parent Context, d time.Time)</code>**ï¼šç”Ÿæˆä¸€ä¸ªå¯å®šæ—¶å–æ¶ˆçš„ Contextï¼Œå‚æ•° d ä¸ºå®šæ—¶å–æ¶ˆçš„å…·ä½“æ—¶é—´ã€‚<ol>
<li>**<code>WithTimeout(parent Context, timeout time.Duration)</code>**ï¼šç”Ÿæˆä¸€ä¸ªå¯è¶…æ—¶å–æ¶ˆçš„ Contextï¼Œå‚æ•° timeout ç”¨äºè®¾ç½®å¤šä¹…åå–æ¶ˆ</li>
</ol>
</li>
</ol>
</li>
<li>**<code>WithValue(parent Context, key, val interface&#123;&#125;)</code>**ï¼šç”Ÿæˆä¸€ä¸ªå¯æºå¸¦ key-value é”®å€¼å¯¹çš„ Contextã€‚</li>
</ol>
<p>ä»¥ä¸Šå››ä¸ªç”Ÿæˆ Context çš„å‡½æ•°ä¸­ï¼Œå‰ä¸‰ä¸ªéƒ½å±äºå¯å–æ¶ˆçš„ Contextï¼Œå®ƒä»¬æ˜¯ä¸€ç±»å‡½æ•°ï¼Œæœ€åä¸€ä¸ªæ˜¯å€¼ Contextï¼Œç”¨äºå­˜å‚¨ä¸€ä¸ª key-value é”®å€¼å¯¹ã€‚</p>
<h1 id="æŒ‡é’ˆ"><a href="#æŒ‡é’ˆ" class="headerlink" title="æŒ‡é’ˆ"></a>æŒ‡é’ˆ</h1><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    name:=<span class="string">&quot;xiaoming&quot;</span></span><br><span class="line">    <span class="keyword">var</span> nameP *<span class="type">string</span> = &amp;name</span><br><span class="line">    fmt.Println(*nameP)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>è·å–ä¸€ä¸ªå˜é‡çš„æŒ‡é’ˆéå¸¸å®¹æ˜“ï¼Œä½¿ç”¨å–åœ°å€ç¬¦ &amp; å°±å¯ä»¥</p>
</li>
<li><p>æŒ‡é’ˆç±»å‹å°±æ˜¯åœ¨å¯¹åº”çš„ç±»å‹å‰åŠ  * å·</p>
</li>
<li><p>æŒ‡é’ˆç±»å‹éå¸¸å»‰ä»·ï¼Œåªå ç”¨ 4 ä¸ªæˆ–è€… 8 ä¸ªå­—èŠ‚çš„å†…å­˜å¤§å°ã€‚</p>
</li>
<li><p><em><strong>é€šè¿‡ var å£°æ˜çš„æŒ‡é’ˆå˜é‡è¿˜æ²¡æœ‰åˆ†é…å†…å­˜</strong></em>ï¼Œå› ä¸ºè¿™æ—¶å€™å®ƒä»…ä»…æ˜¯ä¸ªå˜é‡ï¼Œæ˜¯ä¸èƒ½ç›´æ¥èµ‹å€¼å’Œå–å€¼çš„ï¼Œå®ƒçš„å€¼æ˜¯ nil&#x20;</p>
<p><img src="/../images/image_t8e3mEYUbE.png" alt="ç›´æ¥èµ‹å€¼å’Œå–å€¼" title="ç›´æ¥èµ‹å€¼å’Œå–å€¼"></p>
<p>è§£å†³æ–¹æ³•ï¼šå°†ä¸€å—å†…å­˜åœ°å€<code>&amp;m</code>èµ‹å€¼ç»™æŒ‡é’ˆå˜é‡<code>*p</code></p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> p *<span class="type">int</span></span><br><span class="line"><span class="keyword">var</span> m <span class="type">int</span></span><br><span class="line">p = &amp;m</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</li>
<li><p>é€šè¿‡newåˆ›å»ºçš„æŒ‡é’ˆæ˜¯å­˜åœ¨å†…å­˜åœ°å€çš„ï¼Œå¯ä»¥ç›´æ¥èµ‹å€¼</p>
<ul>
<li><code>var intP *int = new(int)</code></li>
</ul>
</li>
</ul>
<h1 id="å‚æ•°ä¼ é€’"><a href="#å‚æ•°ä¼ é€’" class="headerlink" title="å‚æ•°ä¼ é€’"></a>å‚æ•°ä¼ é€’</h1><p><strong>ä¸¥æ ¼æ¥è¯´ï¼ŒGo è¯­è¨€æ²¡æœ‰å¼•ç”¨ç±»å‹</strong>ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥æŠŠ mapã€chan ç§°ä¸ºå¼•ç”¨ç±»å‹ï¼Œè¿™æ ·ä¾¿äºç†è§£ã€‚é™¤äº† mapã€chan ä¹‹å¤–ï¼ŒGo è¯­è¨€ä¸­çš„å‡½æ•°ã€æ¥å£ã€slice åˆ‡ç‰‡ã€æŒ‡é’ˆéƒ½å¯ä»¥ç§°ä¸ºå¼•ç”¨ç±»å‹ã€‚</p>
<p><img src="/../images/image_trx0_Qi29q.png"></p>
<p>æ€»ç»“ï¼š</p>
<p>åœ¨ Go è¯­è¨€ä¸­ï¼Œ<strong>å‡½æ•°çš„å‚æ•°ä¼ é€’åªæœ‰å€¼ä¼ é€’</strong>ï¼Œè€Œä¸”ä¼ é€’çš„å®å‚éƒ½æ˜¯åŸå§‹æ•°æ®çš„ä¸€ä»½æ‹·è´ã€‚</p>
<p>å¦‚æœæ‹·è´çš„å†…å®¹æ˜¯å€¼ç±»å‹çš„ï¼Œé‚£ä¹ˆåœ¨å‡½æ•°ä¸­å°±æ— æ³•ä¿®æ”¹åŸå§‹æ•°æ®ï¼›</p>
<p>å¦‚æœæ‹·è´çš„å†…å®¹æ˜¯æŒ‡é’ˆï¼ˆæˆ–è€…å¯ä»¥ç†è§£ä¸ºå¼•ç”¨ç±»å‹ mapã€chan ç­‰ï¼‰ï¼Œé‚£ä¹ˆå°±å¯ä»¥åœ¨å‡½æ•°ä¸­ä¿®æ”¹åŸå§‹æ•°æ®ã€‚</p>
<h1 id="å†…å­˜åˆ†é…"><a href="#å†…å­˜åˆ†é…" class="headerlink" title="å†…å­˜åˆ†é…"></a>å†…å­˜åˆ†é…</h1><ul>
<li>æŒ‡é’ˆç±»å‹çš„å˜é‡å¦‚æœæ²¡æœ‰åˆ†é…å†…å­˜ï¼Œå°±é»˜è®¤æ˜¯é›¶å€¼ nilï¼Œå®ƒæ²¡æœ‰æŒ‡å‘çš„å†…å­˜ï¼Œæ‰€ä»¥æ— æ³•ä½¿ç”¨ï¼Œå¼ºè¡Œä½¿ç”¨å°±ä¼šå¾—åˆ°ä»¥ä¸Š nil æŒ‡é’ˆé”™è¯¯</li>
<li>å¯¹äºå€¼ç±»å‹æ¥è¯´ï¼Œå³ä½¿åªå£°æ˜ä¸€ä¸ªå˜é‡ï¼Œæ²¡æœ‰å¯¹å…¶åˆå§‹åŒ–ï¼Œè¯¥å˜é‡ä¹Ÿä¼šæœ‰åˆ†é…å¥½çš„å†…å­˜ã€‚</li>
<li>ä¸¤ä¸ªå…³é”®å‡½æ•°ï¼šnewå’Œmake</li>
</ul>
<h2 id="new"><a href="#new" class="headerlink" title="new"></a>new</h2><p>new å‡½æ•°åªç”¨äºåˆ†é…å†…å­˜ï¼Œå¹¶ä¸”æŠŠå†…å­˜æ¸…é›¶ï¼Œä¹Ÿå°±æ˜¯è¿”å›ä¸€ä¸ªæŒ‡å‘å¯¹åº”ç±»å‹é›¶å€¼çš„æŒ‡é’ˆã€‚new å‡½æ•°ä¸€èˆ¬ç”¨äºéœ€è¦æ˜¾å¼åœ°è¿”å›æŒ‡é’ˆçš„æƒ…å†µï¼Œä¸æ˜¯å¤ªå¸¸ç”¨ã€‚</p>
<h2 id="make"><a href="#make" class="headerlink" title="make"></a>make</h2><p>make å‡½æ•°åªç”¨äº sliceã€chan å’Œ map è¿™ä¸‰ç§å†…ç½®ç±»å‹çš„åˆ›å»ºå’Œåˆå§‹åŒ–ï¼Œå› ä¸ºè¿™ä¸‰ç§ç±»å‹çš„ç»“æ„æ¯”è¾ƒå¤æ‚ï¼Œæ¯”å¦‚ slice è¦æå‰åˆå§‹åŒ–å¥½å†…éƒ¨å…ƒç´ çš„ç±»å‹ï¼Œslice çš„é•¿åº¦å’Œå®¹é‡ç­‰ï¼Œè¿™æ ·æ‰å¯ä»¥æ›´å¥½åœ°ä½¿ç”¨å®ƒä»¬ã€‚</p>
<h1 id="åå°„"><a href="#åå°„" class="headerlink" title="åå°„"></a>åå°„</h1><ul>
<li><p><strong><code>reflect.Value</code></strong> å’Œ**<code>reflect.Type</code>**</p>
<p>åœ¨ Go è¯­è¨€çš„åå°„å®šä¹‰ä¸­ï¼Œä»»ä½•æ¥å£éƒ½ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼šæ¥å£çš„å…·ä½“ç±»å‹ï¼Œä»¥åŠå…·ä½“ç±»å‹å¯¹åº”çš„å€¼ã€‚æ¯”å¦‚ var i int &#x3D; 3ï¼Œå› ä¸º <code>interface&#123;&#125;</code> å¯ä»¥è¡¨ç¤ºä»»ä½•ç±»å‹ï¼Œæ‰€ä»¥å˜é‡ i å¯ä»¥è½¬ä¸º interface{}ã€‚å…¶ä¸­ Value ä¸ºå˜é‡çš„å€¼ï¼Œå³ 3ï¼Œè€Œ Type ä¸ºå˜é‡çš„ç±»å‹ï¼Œå³ intã€‚</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line">i:=<span class="number">3</span></span><br><span class="line">iv:=reflect.ValueOf(i)</span><br><span class="line">it:=reflect.TypeOf(i)</span><br></pre></td></tr></table></figure>
</li>
<li><p>ä¿®æ”¹å˜é‡</p>
<p>è¦ä¿®æ”¹ä¸€ä¸ªå˜é‡çš„å€¼ï¼Œæœ‰å‡ ä¸ªå…³é”®ç‚¹ï¼šä¼ é€’æŒ‡é’ˆï¼ˆå¯å¯»å€ï¼‰ï¼Œé€šè¿‡ Elem æ–¹æ³•è·å–æŒ‡å‘çš„å€¼ï¼Œæ‰å¯ä»¥ä¿è¯å€¼å¯ä»¥è¢«ä¿®æ”¹ï¼Œreflect.Value ä¸ºæˆ‘ä»¬æä¾›äº† CanSet æ–¹æ³•åˆ¤æ–­æ˜¯å¦å¯ä»¥ä¿®æ”¹è¯¥å˜é‡ã€‚</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line">ipv := reflect.ValueOf(&amp;i)</span><br><span class="line">ipv.Elem().SetInt(<span class="number">4</span>)</span><br><span class="line">fmt.Println(i)</span><br></pre></td></tr></table></figure>
</li>
<li><p>åå°„çš„ä¸‰å¤§å®šå¾‹</p>
<ol>
<li>ä»»ä½•æ¥å£å€¼ <code>interface&#123;&#125;</code> éƒ½å¯ä»¥åå°„å‡ºåå°„å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯ reflect.Value å’Œ reflect.Typeï¼Œé€šè¿‡å‡½æ•° reflect.ValueOf å’Œ reflect.TypeOf è·å¾—ã€‚</li>
<li>åå°„å¯¹è±¡ä¹Ÿå¯ä»¥è¿˜åŸä¸º interface{} å˜é‡ï¼Œä¹Ÿå°±æ˜¯ç¬¬ 1 æ¡å®šå¾‹çš„å¯é€†æ€§ï¼Œé€šè¿‡ reflect.Value ç»“æ„ä½“çš„ Interface æ–¹æ³•è·å¾—ã€‚</li>
<li>è¦ä¿®æ”¹åå°„çš„å¯¹è±¡ï¼Œè¯¥å€¼å¿…é¡»å¯è®¾ç½®ï¼Œä¹Ÿå°±æ˜¯å¯å¯»å€ï¼Œå‚è€ƒä¸ŠèŠ‚è¯¾ä¿®æ”¹å˜é‡çš„å€¼é‚£ä¸€èŠ‚çš„å†…å®¹ç†è§£ã€‚</li>
</ol>
</li>
</ul>
<h1 id="SliceHeader"><a href="#SliceHeader" class="headerlink" title="SliceHeader"></a>SliceHeader</h1><ul>
<li><p>åœ¨ Go è¯­è¨€ä¸­ï¼Œåˆ‡ç‰‡å…¶å®æ˜¯ä¸€ä¸ªç»“æ„ä½“ï¼Œå®šä¹‰å¦‚ä¸‹ï¼š</p>
<p><img src="/../images/image_X_Cyk8TKPo.png"></p>
<p>SliceHeader æ˜¯åˆ‡ç‰‡åœ¨è¿è¡Œæ—¶çš„è¡¨ç°å½¢å¼ï¼Œå®ƒæœ‰ä¸‰ä¸ªå­—æ®µ Dataã€Len å’Œ Capã€‚</p>
<ol>
<li>Data ç”¨æ¥æŒ‡å‘å­˜å‚¨åˆ‡ç‰‡å…ƒç´ çš„æ•°ç»„ã€‚</li>
<li>Len ä»£è¡¨åˆ‡ç‰‡çš„é•¿åº¦ã€‚</li>
<li>Cap ä»£è¡¨åˆ‡ç‰‡çš„å®¹é‡ã€‚</li>
</ol>
</li>
<li><p>ä¼˜ç‚¹</p>
<ol>
<li>æ”¯æŒåŠ¨æ€æ‰©å®¹</li>
<li>åˆ‡ç‰‡çš„æœ¬è´¨æ˜¯ SliceHeaderï¼Œåˆå› ä¸ºå‡½æ•°çš„å‚æ•°æ˜¯å€¼ä¼ é€’ï¼Œæ‰€ä»¥ä¼ é€’çš„æ˜¯ SliceHeader çš„å‰¯æœ¬ï¼Œè€Œä¸æ˜¯åº•å±‚æ•°ç»„çš„å‰¯æœ¬ã€‚è¿™æ—¶å€™åˆ‡ç‰‡çš„ä¼˜åŠ¿å°±ä½“ç°å‡ºæ¥äº†ï¼Œå› ä¸º SliceHeader çš„å‰¯æœ¬å†…å­˜å ç”¨éå¸¸å°‘ï¼Œå³ä½¿æ˜¯ä¸€ä¸ªéå¸¸å¤§çš„åˆ‡ç‰‡ï¼Œä¹Ÿé¡¶å¤šå ç”¨ 24 ä¸ªå­—èŠ‚çš„å†…å­˜ï¼Œè¿™å°±è§£å†³äº†å¤§æ•°ç»„åœ¨ä¼ å‚æ—¶å†…å­˜æµªè´¹çš„é—®é¢˜ã€‚</li>
</ol>
</li>
</ul>
<h1 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h1><ul>
<li>æµ‹è¯•æ–‡ä»¶ä»¥_test.goç»“å°¾</li>
<li>æµ‹è¯•å‡½æ•°ä»¥Testxxxï¼ˆxxxä¸ºæµ‹è¯•å‡½æ•°åï¼‰å¼€å¤´</li>
</ul>
<p>å‡è®¾ç¼–å†™çš„å‡½æ•°åœ¨<em>ch18&#x2F;main.go</em>ä¸­ï¼š<code>go test -v ./ch18</code></p>
<hr>
<ul>
<li>go test -v â€“coverprofile&#x3D;ch18.cover .&#x2F;ch18ï¼šå¾—åˆ°ä¸€ä¸ªå•å…ƒæµ‹è¯•è¦†ç›–ç‡æ–‡ä»¶</li>
</ul>
<h2 id="åŸºå‡†æµ‹è¯•"><a href="#åŸºå‡†æµ‹è¯•" class="headerlink" title="åŸºå‡†æµ‹è¯•"></a>åŸºå‡†æµ‹è¯•</h2><p>è¡¡é‡ä»£ç çš„æ€§èƒ½</p>
<ul>
<li><p>å‡½æ•°å¿…é¡»ä»¥ Benchmark å¼€å¤´</p>
</li>
<li><p>å‡½æ•°çš„ç­¾åå¿…é¡»æ¥æ”¶ä¸€ä¸ªæŒ‡å‘ testing.B ç±»å‹çš„æŒ‡é’ˆï¼Œå¹¶ä¸”ä¸èƒ½è¿”å›ä»»ä½•å€¼ï¼›</p>
</li>
<li><p>æœ€åçš„ for å¾ªç¯å¾ˆé‡è¦ï¼Œè¢«æµ‹è¯•çš„ä»£ç è¦æ”¾åˆ°å¾ªç¯é‡Œï¼›</p>
</li>
<li><p>b.N æ˜¯åŸºå‡†æµ‹è¯•æ¡†æ¶æä¾›çš„ï¼Œè¡¨ç¤ºå¾ªç¯çš„æ¬¡æ•°ï¼Œå› ä¸ºéœ€è¦åå¤è°ƒç”¨æµ‹è¯•çš„ä»£ç ï¼Œæ‰å¯ä»¥è¯„ä¼°æ€§èƒ½ã€‚</p>
</li>
<li><p>è¿è¡Œï¼š<code>go test -bench=. ./ch18</code></p>
<p><img src="/../images/image_JlVijZWatR.png"></p>
</li>
<li><p>è®¡æ—¶æ–¹æ³•</p>
<p><img src="/../images/image_01f3cRZXVK.png"></p>
</li>
<li><p>å†…å­˜ç»Ÿè®¡</p>
<p><img src="/../images/image_0VABPfND_h.png"></p>
</li>
<li><p>å¹¶å‘åŸºå‡†æµ‹è¯•</p>
<p><img src="/../images/image_KLlXB9vavX.png"></p>
</li>
</ul>
<h1 id="æ³›å‹"><a href="#æ³›å‹" class="headerlink" title="æ³›å‹"></a>æ³›å‹</h1><p>Goçš„æ³›å‹ä½¿ç”¨<code>interface</code>å®ç°</p>
<ul>
<li>an approximation element <code>~T</code> restricts to all types whose underlying type is T: ä»£è¡¨åº•å±‚ç±»å‹æ˜¯<code>T</code></li>
<li>a union element <code>T1 | T2 | ...</code> restricts to any of the listed elements: ä»£è¡¨<code>æˆ–</code>,ç±»å‹åˆ—è¡¨ä¹‹ä¸€ã€‚</li>
</ul>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ä»»æ„ç±»å‹ any</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">f</span>[<span class="title">T1</span>, <span class="title">T2</span> <span class="title">any</span>]<span class="params">(x <span class="type">int</span>, y T1)</span></span> T2 &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Integer <span class="keyword">interface</span> &#123;</span><br><span class="line">  Signed | Unsigned</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Signed <span class="keyword">interface</span> &#123;</span><br><span class="line">  ~<span class="type">int</span> | ~<span class="type">int8</span> | ~<span class="type">int16</span> | ~<span class="type">int32</span> | ~<span class="type">int64</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Unsigned <span class="keyword">interface</span> &#123;</span><br><span class="line">  ~<span class="type">uint</span> | ~<span class="type">uint8</span> | ~<span class="type">uint16</span> | ~<span class="type">uint32</span> | ~<span class="type">uint64</span> | ~<span class="type">uintptr</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ³›å‹æŠ½è±¡</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Abs</span>[<span class="title">T</span> <span class="title">Integer</span>]<span class="params">(input T)</span></span> T &#123;</span><br><span class="line">  <span class="keyword">if</span> input &lt; <span class="number">0</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> -input</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> input</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
]]></content>
  </entry>
  <entry>
    <title>Spring Lazy-init è¸©å‘è®°å½•</title>
    <url>/2023/11/01/Spring%20Lazy-init%20%E8%B8%A9%E5%9D%91%E8%AE%B0%E5%BD%95/</url>
    <content><![CDATA[<blockquote>
<p>èµ·å› ï¼šåœ¨å†™ä¸€ä¸ªSpringbooté¡¹ç›®æ—¶ï¼Œé˜Ÿå‹å°†é¡¹ç›®åŠ è½½æ–¹å¼æ”¹ä¸º<code>lazy-init</code>ï¼Œç†ç”±æ˜¯èƒ½åŠ å¿«é‡å¯çš„é€Ÿåº¦ï¼Œä½†æ˜¯å¯¼è‡´äº†Bug</p>
</blockquote>
<p><img src="/../images/289b54f1b37819da340708c7cfb9e261_rfYNVwE36_.png"></p>
<p><img src="/../images/1551908c7fb3dddbbc2d3b1e90a48cf1_gLwVbcWEG6.png"></p>
<p>Springåœ¨Beanåˆå§‹åŒ–é˜¶æ®µä¼šå¯¹æ‰€æœ‰ç»§æ‰¿äº†<code>ApplicationContextAware</code>æ¥å£çš„ç±»æ³¨å…¥<code>ApplicationContext</code></p>
<p>ä½†æ˜¯å¦‚æœè®¾ç½®äº†<code>lazy-init</code>ï¼ŒbeanåŠ è½½é¡ºåºå˜äº†ï¼Œ<code>setApplicationContext</code>å°±ä¸æ‰§è¡Œäº†</p>
]]></content>
  </entry>
  <entry>
    <title>Go generic VS Java generic</title>
    <url>/2024/02/14/Go%20generic%20VS%20Java%20generic/</url>
    <content><![CDATA[<p>éšç€Go 1.18ç‰ˆæœ¬çš„å‘å¸ƒï¼ŒGoè¯­è¨€æ­£å¼å¼•å…¥äº†æ³›å‹è¿™ä¸€é‡è¦ç‰¹æ€§ã€‚æœ¬æ–‡å°†å¯¹Goæ³›å‹ä¸Javaæ³›å‹è¿›è¡Œå¯¹æ¯”åˆ†æï¼Œæ¢è®¨å®ƒä»¬ä¹‹é—´çš„å¼‚åŒã€‚</p>
<h2 id="Goæ³›å‹æ¦‚è¿°"><a href="#Goæ³›å‹æ¦‚è¿°" class="headerlink" title="Goæ³›å‹æ¦‚è¿°"></a>Goæ³›å‹æ¦‚è¿°</h2><h3 id="å…³é”®æ¦‚å¿µ"><a href="#å…³é”®æ¦‚å¿µ" class="headerlink" title="å…³é”®æ¦‚å¿µ"></a>å…³é”®æ¦‚å¿µ</h3><h4 id="ç±»å‹å‚æ•°"><a href="#ç±»å‹å‚æ•°" class="headerlink" title="ç±»å‹å‚æ•°"></a>ç±»å‹å‚æ•°</h4><p>ç±»å‹å‚æ•°æ˜¯æ³›å‹å‡½æ•°æˆ–ç±»å‹ä¸­çš„å ä½ç¬¦ï¼Œè¡¨ç¤ºä¸€ä¸ªæœªçŸ¥çš„å…·ä½“ç±»å‹ã€‚ç±»å‹å‚æ•°ä½¿ç”¨æ–¹æ‹¬å·<code>[]</code>æ‹¬èµ·æ¥ï¼Œå¹¶æ”¾åœ¨å‡½æ•°åæˆ–ç±»å‹åä¹‹åã€‚ä¾‹å¦‚ï¼Œåœ¨<code>func MyFunc[T any](a T) &#123;&#125;</code>ä¸­ï¼Œ<code>T</code>å°±æ˜¯ä¸€ä¸ªç±»å‹å‚æ•°ã€‚</p>
<h4 id="çº¦æŸ"><a href="#çº¦æŸ" class="headerlink" title="çº¦æŸ"></a>çº¦æŸ</h4><p>çº¦æŸæ˜¯ç”¨æ¥é™åˆ¶ç±»å‹å‚æ•°çš„æ–¹å¼ï¼ŒæŒ‡å®šäº†ç±»å‹å‚æ•°å¿…é¡»æ»¡è¶³çš„æ¡ä»¶ã€‚çº¦æŸå¯ä»¥æ˜¯æ¥å£ç±»å‹æˆ–å…¶ä»–å¸¦æœ‰ç±»å‹å‚æ•°çš„ç±»å‹ã€‚ä¾‹å¦‚ï¼Œ<code>func MyFunc[T io.Reader](a T) &#123;&#125;</code>ä¸­çš„<code>io.Reader</code>å°±æ˜¯ä¸€ä¸ªçº¦æŸï¼Œè¡¨ç¤ºç±»å‹å‚æ•°<code>T</code>å¿…é¡»å®ç°<code>io.Reader</code>æ¥å£ã€‚</p>
<h4 id="é¢„å®šä¹‰çº¦æŸ"><a href="#é¢„å®šä¹‰çº¦æŸ" class="headerlink" title="é¢„å®šä¹‰çº¦æŸ"></a>é¢„å®šä¹‰çº¦æŸ</h4><p>Go 1.18æä¾›äº†ä¸€äº›é¢„å®šä¹‰çš„çº¦æŸï¼Œç”¨äºè¡¨ç¤ºå¸¸è§çš„ç±»å‹é›†åˆã€‚ä¾‹å¦‚ï¼Œ<code>any</code>çº¦æŸè¡¨ç¤ºä»»ä½•ç±»å‹ï¼Œè€Œ<code>comparable</code>çº¦æŸè¡¨ç¤ºå¯æ¯”è¾ƒçš„ç±»å‹ï¼ˆæ”¯æŒ<code>==</code>å’Œ<code>!=</code>æ“ä½œç¬¦ï¼‰ã€‚</p>
<h4 id="æ³›å‹å‡½æ•°"><a href="#æ³›å‹å‡½æ•°" class="headerlink" title="æ³›å‹å‡½æ•°"></a>æ³›å‹å‡½æ•°</h4><p>æ³›å‹å‡½æ•°æ˜¯ä¸€ç§ä½¿ç”¨ç±»å‹å‚æ•°çš„å‡½æ•°ï¼Œå¯ä»¥å¤„ç†ä¸åŒç±»å‹çš„å‚æ•°ã€‚æ³›å‹å‡½æ•°çš„å®šä¹‰ç±»ä¼¼äºæ™®é€šå‡½æ•°ï¼Œåªæ˜¯åœ¨å‡½æ•°ååé¢æ·»åŠ äº†ç±»å‹å‚æ•°åˆ—è¡¨ã€‚ä¾‹å¦‚ï¼Œ<code>func MyFunc[T any](a, b T) T &#123;&#125;</code>ã€‚</p>
<h4 id="æ³›å‹ç±»å‹"><a href="#æ³›å‹ç±»å‹" class="headerlink" title="æ³›å‹ç±»å‹"></a>æ³›å‹ç±»å‹</h4><p>æ³›å‹ç±»å‹æ˜¯ä¸€ç§ä½¿ç”¨ç±»å‹å‚æ•°çš„ç±»å‹ï¼Œå¯ä»¥è¡¨ç¤ºä¸åŒç±»å‹çš„æ•°æ®ç»“æ„ã€‚æ³›å‹ç±»å‹çš„å®šä¹‰ç±»ä¼¼äºæ™®é€šç±»å‹ï¼Œåªæ˜¯åœ¨ç±»å‹ååé¢æ·»åŠ äº†ç±»å‹å‚æ•°åˆ—è¡¨ã€‚ä¾‹å¦‚ï¼Œ<code>type MySlice[T any] []T</code>ã€‚</p>
<h3 id="é™åˆ¶"><a href="#é™åˆ¶" class="headerlink" title="é™åˆ¶"></a>é™åˆ¶</h3><ul>
<li>åŒ¿åå‡½æ•°ä¸æ”¯æŒæ³›å‹ï¼Œä½†å¯ä»¥ä½¿ç”¨åˆ«å¤„å®šä¹‰å¥½çš„ç±»å‹ä½œä¸ºå®å‚ã€‚</li>
<li>ä¸æ”¯æŒæ³›å‹æ–¹æ³•ã€‚</li>
</ul>
<h3 id="ä¸¾ä¾‹"><a href="#ä¸¾ä¾‹" class="headerlink" title="ä¸¾ä¾‹"></a>ä¸¾ä¾‹</h3><p>Goçš„æ³›å‹ä½¿ç”¨<code>interface</code>å®ç°</p>
<ul>
<li>an approximation element <code>~T</code> restricts to all types whose underlying type is T: ä»£è¡¨åº•å±‚ç±»å‹æ˜¯<code>T</code></li>
<li>a union element <code>T1 | T2 | ...</code> restricts to any of the listed elements: ä»£è¡¨<code>æˆ–</code>,ç±»å‹åˆ—è¡¨ä¹‹ä¸€ã€‚</li>
</ul>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ä»»æ„ç±»å‹ any</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">f</span>[<span class="title">T1</span>, <span class="title">T2</span> <span class="title">any</span>]<span class="params">(x <span class="type">int</span>, y T1)</span></span> T2 &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Integer <span class="keyword">interface</span> &#123;</span><br><span class="line">  Signed | Unsigned</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Signed <span class="keyword">interface</span> &#123;</span><br><span class="line">  ~<span class="type">int</span> | ~<span class="type">int8</span> | ~<span class="type">int16</span> | ~<span class="type">int32</span> | ~<span class="type">int64</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Unsigned <span class="keyword">interface</span> &#123;</span><br><span class="line">  ~<span class="type">uint</span> | ~<span class="type">uint8</span> | ~<span class="type">uint16</span> | ~<span class="type">uint32</span> | ~<span class="type">uint64</span> | ~<span class="type">uintptr</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ³›å‹æŠ½è±¡</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Abs</span>[<span class="title">T</span> <span class="title">Integer</span>]<span class="params">(input T)</span></span> T &#123;</span><br><span class="line">  <span class="keyword">if</span> input &lt; <span class="number">0</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> -input</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> input</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Javaæ³›å‹æ¦‚è¿°"><a href="#Javaæ³›å‹æ¦‚è¿°" class="headerlink" title="Javaæ³›å‹æ¦‚è¿°"></a>Javaæ³›å‹æ¦‚è¿°</h2><p>Javaçš„æ³›å‹æ˜¯åœ¨JDK 5ä¸­å¼•å…¥çš„ï¼Œå®ƒçš„è®¾è®¡ç›®æ ‡æ˜¯ä¸ºäº†æé«˜ç±»å‹å®‰å…¨æ€§å’Œä»£ç é‡ç”¨æ€§ã€‚</p>
<h3 id="å…³é”®æ¦‚å¿µ-1"><a href="#å…³é”®æ¦‚å¿µ-1" class="headerlink" title="å…³é”®æ¦‚å¿µ"></a>å…³é”®æ¦‚å¿µ</h3><ul>
<li><strong>æ³›å‹ç±»å‹</strong>ï¼šå®šä¹‰äº†ä¸€ä¸ªç±»å‹å‚æ•°ï¼Œå¦‚<code>List&lt;T&gt;</code>ã€‚</li>
<li><strong>æ³›å‹æ–¹æ³•</strong>ï¼šå¯ä»¥åœ¨æ–¹æ³•çº§åˆ«ä½¿ç”¨ç±»å‹å‚æ•°ï¼Œå¦‚<code>public &lt;T&gt; void method(T t)</code>ã€‚</li>
<li><strong>ç±»å‹æ“¦é™¤</strong>ï¼šJavaç¼–è¯‘å™¨ä¼šåœ¨ç¼–è¯‘é˜¶æ®µæ¶ˆé™¤ç±»å‹å‚æ•°ï¼Œæ›¿æ¢ä¸ºå®é™…ç±»å‹ï¼Œè¿™ä¿è¯äº†å‘åå…¼å®¹æ€§ã€‚</li>
</ul>
<h3 id="é™åˆ¶-1"><a href="#é™åˆ¶-1" class="headerlink" title="é™åˆ¶"></a>é™åˆ¶</h3><ul>
<li>Javaæ³›å‹æ”¯æŒæ³›å‹æ–¹æ³•ã€‚</li>
<li>Javaæ³›å‹æœ‰ç±»å‹æ“¦é™¤çš„æ¦‚å¿µï¼Œè¿™æ„å‘³ç€åœ¨è¿è¡Œæ—¶æ— æ³•è·å–ç±»å‹å‚æ•°çš„å®é™…ç±»å‹ã€‚</li>
</ul>
<h2 id="å¯¹æ¯”åˆ†æ"><a href="#å¯¹æ¯”åˆ†æ" class="headerlink" title="å¯¹æ¯”åˆ†æ"></a>å¯¹æ¯”åˆ†æ</h2><h3 id="æ³›å‹å®šä¹‰"><a href="#æ³›å‹å®šä¹‰" class="headerlink" title="æ³›å‹å®šä¹‰"></a>æ³›å‹å®šä¹‰</h3><ul>
<li><strong>Go</strong>ï¼šç±»å‹å‚æ•°ã€çº¦æŸå’Œé¢„å®šä¹‰çº¦æŸæä¾›äº†æ˜ç¡®çš„ç±»å‹çº¦æŸæœºåˆ¶ã€‚</li>
<li><strong>Java</strong>ï¼šç±»å‹å‚æ•°å’Œæ³›å‹æ–¹æ³•æä¾›äº†çµæ´»çš„ç±»å‹æŠ½è±¡ã€‚</li>
</ul>
<h3 id="æ³›å‹æ“¦é™¤"><a href="#æ³›å‹æ“¦é™¤" class="headerlink" title="æ³›å‹æ“¦é™¤"></a>æ³›å‹æ“¦é™¤</h3><ul>
<li><strong>Go</strong>ï¼šæ²¡æœ‰ç±»å‹æ“¦é™¤ï¼Œæ³›å‹ç±»å‹åœ¨è¿è¡Œæ—¶ä¿ç•™ç±»å‹ä¿¡æ¯ã€‚</li>
<li><strong>Java</strong>ï¼šå­˜åœ¨ç±»å‹æ“¦é™¤ï¼Œç¼–è¯‘åçš„å­—èŠ‚ç ä¸åŒ…å«ç±»å‹å‚æ•°ä¿¡æ¯ã€‚</li>
</ul>
<h3 id="å…¶ä»–ç‰¹ç‚¹"><a href="#å…¶ä»–ç‰¹ç‚¹" class="headerlink" title="å…¶ä»–ç‰¹ç‚¹"></a>å…¶ä»–ç‰¹ç‚¹</h3><ul>
<li><strong>Go</strong>ï¼šä¸æ”¯æŒæ³›å‹æ–¹æ³•ï¼ŒåŒ¿åå‡½æ•°ä¸æ”¯æŒæ³›å‹ã€‚</li>
<li><strong>Java</strong>ï¼šæ”¯æŒæ³›å‹æ–¹æ³•ï¼ŒåŒ¿åå†…éƒ¨ç±»å¯ä»¥ä½¿ç”¨æ³›å‹ã€‚</li>
</ul>
<hr>
<h3 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h3><ul>
<li><a href="https://www.kunkkawu.com/archives/shen-ru-li-jie-golang-de-fan-xing">æ·±å…¥ç†è§£Goçš„æ³›å‹</a></li>
<li><a href="https://tonybai.com/2022/03/25/intro-generics/">Go 1.18 æ³›å‹å…¥é—¨</a></li>
</ul>
]]></content>
  </entry>
  <entry>
    <title>Spingboot3.0 å‡çº§è®°å½•</title>
    <url>/2024/06/21/Spingboot3.0%20%E5%8D%87%E7%BA%A7%E8%AE%B0%E5%BD%95/</url>
    <content><![CDATA[<blockquote>
<p><strong>èƒŒæ™¯</strong>ï¼šåœ¨åŸæ¥ä¸€ä¸ªåŸºäº Spring Boot 2.6.11 çš„é¡¹ç›®ä¸­ï¼Œå¼•å…¥äº†ä¸€ä¸ªç¬¬ä¸‰æ–¹åº“åï¼Œå‘ç°æ— æ³•æ­£å¸¸åŠ è½½å…¶è‡ªåŠ¨è£…é…çš„ Beanã€‚ç»è¿‡æ’æŸ¥ï¼Œå‘ç°ç¬¬ä¸‰æ–¹åº“åŸºäº Spring Boot 3.2.4 ç‰ˆæœ¬å¼€å‘ï¼Œå­˜åœ¨ä¾èµ–æ³¨å…¥æ–¹å¼ä¸Šçš„å·®å¼‚ã€‚ä¸ºäº†å…¼å®¹æ€§ï¼Œå†³å®šå°†åŸé¡¹ç›®å‡çº§è‡³ Spring Boot 3.2.4ã€‚é‰´äº Spring Boot 3.0 çš„é‡å¤§å˜åŒ–ï¼Œæœ¬æ–‡è¯¦ç»†è®°å½•äº†è¿ç§»è¿‡ç¨‹ä¸­é‡åˆ°çš„å…³é”®æ”¹åŠ¨åŠè§£å†³æ–¹æ¡ˆã€‚</p>
</blockquote>
<h2 id="Spring-Boot-3-0-ä¸»è¦æ”¹åŠ¨"><a href="#Spring-Boot-3-0-ä¸»è¦æ”¹åŠ¨" class="headerlink" title="Spring Boot 3.0 ä¸»è¦æ”¹åŠ¨"></a>Spring Boot 3.0 ä¸»è¦æ”¹åŠ¨</h2><p>ä»¥ä¸‹æ˜¯ Spring Boot 3.0 ä¸­æœ€é‡è¦çš„å˜åŠ¨ï¼š</p>
<ul>
<li><strong>æœ€ä½ Java ç‰ˆæœ¬è¦æ±‚</strong>ï¼šå‡çº§è‡³ Java 17ã€‚</li>
<li><strong>ç§»é™¤å†…ç½®é…ç½®</strong>ï¼šä¾‹å¦‚ï¼ŒMySQL é©±åŠ¨ç­‰é…ç½®è¢«ç§»é™¤ï¼Œå®˜æ–¹æä¾›è¿ç§»å·¥å…·ååŠ©å‡çº§ï¼š</li>
</ul>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-properties-migrator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li><strong>Jakarta EE æ›¿ä»£ Java EE</strong>ï¼šæ‰€æœ‰ <code>javax</code> åŒ…è¢«æ›¿æ¢ä¸º <code>jakarta</code> åŒ…ï¼š</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">javax.persistence.*   -&gt; jakarta.persistence.*</span><br><span class="line">javax.validation.*    -&gt; jakarta.validation.*</span><br><span class="line">javax.servlet.*       -&gt; jakarta.servlet.*</span><br><span class="line">javax.annotation.*    -&gt; jakarta.annotation.*</span><br><span class="line">javax.transaction.*   -&gt; jakarta.transaction.*</span><br></pre></td></tr></table></figure>

<p>æ›´å¤šæ”¹åŠ¨è¯¦æƒ…ï¼Œå‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼š<a href="https://github.com/spring-projects/spring-boot/wiki/Spring-Boot-3.0-Release-Notes">Spring Boot 3.0 å‘å¸ƒè¯´æ˜</a></p>
<h2 id="é¡¹ç›®è¿ç§»ä¸­å‘ç°çš„é—®é¢˜"><a href="#é¡¹ç›®è¿ç§»ä¸­å‘ç°çš„é—®é¢˜" class="headerlink" title="é¡¹ç›®è¿ç§»ä¸­å‘ç°çš„é—®é¢˜"></a>é¡¹ç›®è¿ç§»ä¸­å‘ç°çš„é—®é¢˜</h2><h3 id="è‡ªå®šä¹‰-Starter-ä¸å…¼å®¹"><a href="#è‡ªå®šä¹‰-Starter-ä¸å…¼å®¹" class="headerlink" title="è‡ªå®šä¹‰ Starter ä¸å…¼å®¹"></a>è‡ªå®šä¹‰ Starter ä¸å…¼å®¹</h3><p>åŸç‰ˆæœ¬ä¸­è‡ªå®šä¹‰ Starter çš„æ–¹å¼ä¸ºï¼šåœ¨æ‰«æç±»ä¸Šä½¿ç”¨ <code>@Configuration</code> æ³¨è§£ï¼Œå¹¶åœ¨ <code>META-INF/spring.factories</code> æ–‡ä»¶ä¸­å£°æ˜è¯¥æ‰«æç±»ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">org.springframework.boot.autoconfigure.EnableAutoConfiguration=\</span><br><span class="line">&#123;&#123;å¯åŠ¨ç±»è·¯å¾„&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>æ–°ç‰ˆä¸­ï¼Œè‡ªå®šä¹‰ Starter åº”é‡‡ç”¨ <code>@AutoConfiguration</code> æ³¨è§£ï¼Œå¹¶åœ¨ <code>META-INF/spring/org.springframework.boot.autoconfigure.AutoConfiguration.imports</code> æ–‡ä»¶ä¸­å£°æ˜æ‰«æç±»ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&#123;&#123;å¯åŠ¨ç±»è·¯å¾„&#125;&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Mybatis-å…¼å®¹æ€§é—®é¢˜"><a href="#Mybatis-å…¼å®¹æ€§é—®é¢˜" class="headerlink" title="Mybatis å…¼å®¹æ€§é—®é¢˜"></a>Mybatis å…¼å®¹æ€§é—®é¢˜</h3><p><img src="/../images/Secure2%20Image.png" alt="Secure2 Image"></p>
<p><strong>åŸå› </strong>ï¼šMybatis æ—§ç‰ˆæœ¬ä¸ Spring Boot 3.0 ä¸å…¼å®¹ï¼Œéœ€å‡çº§è‡³ Mybatis 3.x ç‰ˆæœ¬æˆ–æ›´é«˜ã€‚</p>
]]></content>
  </entry>
  <entry>
    <title>LangChainå­¦ä¹ ç¬”è®°</title>
    <url>/2024/03/27/LangChain%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/</url>
    <content><![CDATA[<p>åŸºæœ¬æ¶æ„</p>
<p><img src="/../images/langchain_stack_dark_NdLaDhZn28.svg"></p>
<h1 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h1><blockquote>
<p>LangChainæ˜¯ä¸€ä¸ªç”¨äºå¼€å‘ç”±è¯­è¨€æ¨¡å‹é©±åŠ¨çš„åº”ç”¨ç¨‹åºçš„æ¡†æ¶ã€‚</p>
<p>ä¸»è¦åŠŸèƒ½ï¼š</p>
<ul>
<li><p>è°ƒç”¨è¯­è¨€æ¨¡å‹</p>
</li>
<li><p>å°†ä¸åŒæ•°æ®æºæ¥å…¥åˆ°è¯­è¨€æ¨¡å‹çš„äº¤äº’ä¸­</p>
</li>
<li><p>å…è®¸è¯­è¨€æ¨¡å‹ä¸è¿è¡Œç¯å¢ƒäº¤äº’</p>
</li>
</ul>
<p>LangChainä¸­æä¾›çš„æ¨¡å—</p>
<ul>
<li><p>Modulesï¼šæ”¯æŒçš„æ¨¡å‹ç±»å‹å’Œé›†æˆã€‚</p>
</li>
<li><p>Promptï¼šæç¤ºè¯ç®¡ç†ã€ä¼˜åŒ–å’Œåºåˆ—åŒ–ã€‚</p>
</li>
<li><p>Memoryï¼šå†…å­˜æ˜¯æŒ‡åœ¨é“¾&#x2F;ä»£ç†è°ƒç”¨ä¹‹é—´æŒç»­å­˜åœ¨çš„çŠ¶æ€ã€‚</p>
</li>
<li><p>Indexesï¼šå½“è¯­è¨€æ¨¡å‹ä¸ç‰¹å®šäºåº”ç”¨ç¨‹åºçš„æ•°æ®ç›¸ç»“åˆæ—¶ï¼Œä¼šå˜å¾—æ›´åŠ å¼ºå¤§-æ­¤æ¨¡å—åŒ…å«ç”¨äºåŠ è½½ã€æŸ¥è¯¢å’Œæ›´æ–°å¤–éƒ¨æ•°æ®çš„æ¥å£å’Œé›†æˆã€‚</p>
</li>
<li><p>Chainï¼šé“¾æ˜¯ç»“æ„åŒ–çš„è°ƒç”¨åºåˆ—ï¼ˆå¯¹LLMæˆ–å…¶ä»–å®ç”¨ç¨‹åºï¼‰ã€‚</p>
</li>
<li><p>Agentsï¼šä»£ç†æ˜¯ä¸€ä¸ªé“¾ï¼Œå…¶ä¸­LLMåœ¨ç»™å®šé«˜çº§æŒ‡ä»¤å’Œä¸€ç»„å·¥å…·çš„æƒ…å†µä¸‹ï¼Œåå¤å†³å®šæ“ä½œï¼Œæ‰§è¡Œæ“ä½œå¹¶è§‚å¯Ÿç»“æœï¼Œç›´åˆ°é«˜çº§æŒ‡ä»¤å®Œæˆã€‚</p>
</li>
<li><p>Callbacksï¼šå›è°ƒå…è®¸æ‚¨è®°å½•å’Œæµå¼ä¼ è¾“ä»»ä½•é“¾çš„ä¸­é—´æ­¥éª¤ï¼Œä»è€Œè½»æ¾è§‚å¯Ÿã€è°ƒè¯•å’Œè¯„ä¼°åº”ç”¨<br>ç¨‹åºçš„å†…éƒ¨ã€‚</p>
</li>
</ul>
</blockquote>
<p>åº”ç”¨åœºæ™¯ï¼š</p>
<ul>
<li>æ–‡æ¡£é—®ç­”</li>
<li>ä¸ªäººåŠ©ç†</li>
<li>æŸ¥è¯¢æ•°æ®è¡¨æ ¼ï¼ˆCSVã€SQLã€DataFrameç­‰ï¼‰</li>
<li>ä¸APIäº¤äº’</li>
<li>ä¿¡æ¯æå–</li>
<li>æ–‡æ¡£æ€»ç»“</li>
</ul>
<h1 id="Model-I-O"><a href="#Model-I-O" class="headerlink" title="Model I&#x2F;O"></a>Model I&#x2F;O</h1><p>å››ä¸ªæ ¸å¿ƒç»„ä»¶ï¼š</p>
<ul>
<li>Prompts æç¤ºè¯</li>
<li>Chat Models èŠå¤©æ¨¡å‹<ul>
<li>æ“…é•¿å¯¹è¯</li>
</ul>
</li>
<li>LLMs çº¯æ–‡æœ¬æ¨¡å‹<ul>
<li>æ“…é•¿ç†è§£å’Œåˆæˆæ–‡æœ¬æ–¹é¢ï¼Œä¾‹å¦‚æ€»ç»“æ–‡æ¡£ã€PDFã€æ¦‚å¿µé¡µé¢ç­‰</li>
</ul>
</li>
<li>Output parsers è¾“å‡ºè½¬æ¢å™¨</li>
</ul>
<blockquote>
<p>ğŸ“ŒChat Models å’Œ LLMs çš„åŒºåˆ«ï¼š</p>
<p>Chat modelså’ŒLLMséƒ½æ˜¯LangChainä¸­çš„è¯­è¨€æ¨¡å‹æŠ½è±¡ï¼Œä½†æ˜¯LLMsæ˜¯çº¯è¯­è¨€æ¨¡å‹ï¼ŒChat modelsæ˜¯é’ˆå¯¹å¯¹è¯åšäº†ä¼˜åŒ–çš„èŠå¤©æ¨¡å‹</p>
</blockquote>
<h1 id="Agents"><a href="#Agents" class="headerlink" title="Agents"></a>Agents</h1><blockquote>
<p>å¤§å‹è¯­è¨€æ¨¡å‹ï¼ˆLLMsï¼‰éå¸¸å¼ºå¤§ï¼Œä½†å®ƒä»¬ç¼ºä¹â€œæœ€ç¬¨â€çš„è®¡ç®—æœºç¨‹åºå¯ä»¥è½»æ¾å¤„ç†çš„ç‰¹å®šèƒ½åŠ›ã€‚LLM å¯¹é€»è¾‘æ¨ç†ã€è®¡ç®—å’Œæ£€ç´¢å¤–éƒ¨ä¿¡æ¯çš„èƒ½åŠ›è¾ƒå¼±ï¼Œè¿™ä¸æœ€ç®€å•çš„è®¡ç®—æœºç¨‹åºå½¢æˆå¯¹æ¯”ã€‚ä¾‹å¦‚ï¼Œè¯­è¨€æ¨¡å‹æ— æ³•å‡†ç¡®å›ç­”ç®€å•çš„è®¡ç®—é—®é¢˜ï¼Œè¿˜æœ‰å½“è¯¢é—®æœ€è¿‘å‘ç”Ÿçš„äº‹ä»¶æ—¶ï¼Œå…¶å›ç­”ä¹Ÿå¯èƒ½è¿‡æ—¶æˆ–é”™è¯¯ï¼Œå› ä¸ºæ— æ³•ä¸»åŠ¨è·å–<br>æœ€æ–°ä¿¡æ¯ã€‚è¿™æ˜¯ç”±äºå½“å‰è¯­è¨€æ¨¡å‹ä»…ä¾èµ–é¢„è®­ç»ƒæ•°æ®ï¼Œä¸å¤–ç•Œâ€œæ–­å¼€â€ã€‚è¦å…‹æœè¿™ä¸€ç¼ºé™·ï¼Œ LangChain æ¡†<br>æ¶æå‡ºäº† â€œä»£ç†â€(Agent) çš„è§£å†³æ–¹æ¡ˆã€‚</p>
</blockquote>
<p>Agentä½œä¸ºè¯­è¨€æ¨¡å‹çš„å¤–éƒ¨æ¨¡å—ï¼Œå¯æä¾›è®¡ç®—ã€é€»è¾‘ã€æ£€ç´¢ç­‰åŠŸèƒ½çš„æ”¯æŒï¼Œä½¿è¯­è¨€æ¨¡å‹è·å¾—å¼‚å¸¸å¼ºå¤§çš„æ¨ç†å’Œè·å–ä¿¡æ¯çš„è¶…èƒ½åŠ›ã€‚</p>
<hr>
<p>Agentsçš„æ ¸å¿ƒæ€æƒ³æ˜¯ä½¿ç”¨è¯­è¨€æ¨¡å‹æ¥é€‰æ‹©è¦é‡‡å–çš„ä¸€ç³»åˆ—Action</p>
<p>åœ¨langchainä¸­ï¼Œä¸€ç³»åˆ—Actionè¢«ç¡¬ç¼–ç ï¼ˆåœ¨ä»£ç ä¸­ï¼‰ã€‚</p>
<p>åœ¨Agentsä¸­ï¼Œè¯­è¨€æ¨¡å‹è¢«ç”¨ä½œæ¨ç†å¼•æ“æ¥ç¡®å®šè¦é‡‡å–å“ªäº›æ“ä½œä»¥åŠæŒ‰ä»€ä¹ˆé¡ºåºã€‚</p>
<p>ä¸åŒAgentsçš„åŒºåˆ«ï¼šä¸åŒçš„æ¨ç†æç¤ºé£æ ¼ã€ä¸åŒçš„ç¼–ç è¾“å…¥æ–¹å¼ä»¥åŠä¸åŒçš„è§£æè¾“å‡ºæ–¹å¼ã€‚</p>
<h2 id="åŸºæœ¬æ¦‚å¿µ"><a href="#åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="åŸºæœ¬æ¦‚å¿µ"></a>åŸºæœ¬æ¦‚å¿µ</h2><h3 id="Schema"><a href="#Schema" class="headerlink" title="Schema"></a>Schema</h3><p>æ„å»ºä»£ç†çš„æ ¸å¿ƒç»„ä»¶</p>
<ul>
<li><code>AgentAction</code> å³Actionï¼Œè¡¨ç¤ºä»£ç†æ‰§è¡Œçš„æ“ä½œï¼Œé€šå¸¸è¡¨ç¤ºè°ƒç”¨tools<ul>
<li>æˆ‘ä»¬å°†æƒ³è®©å¯¹Agentsçš„æ“ä½œå°è£…æˆActionï¼ˆtoolsï¼‰ï¼Œå†è®©Agentsåœ¨è¢«è°ƒç”¨æ—¶é€‰æ‹©åº”è¯¥ä½¿ç”¨å“ªäº›tools</li>
<li>åœ¨<code>AgentAction</code>ä¸­æœ‰ä¸¤ä¸ªå±æ€§ï¼š<code>tool</code>å’Œ<code>tool_input</code>ï¼Œåˆ†åˆ«ä»£è¡¨å·¥å…·çš„åå­—å’Œå·¥å…·è¾“å…¥</li>
</ul>
</li>
<li><code>AgentFinish</code>  Agentsè¿”å›çš„æœ€ç»ˆç»“æœ</li>
<li><code>Intermediate Steps</code> ä¸­é—´æ­¥éª¤ã€‚ä»£è¡¨<code>AgentAction</code>ä»¥åŠå½“å‰Agentsè¿è¡Œçš„ç›¸åº”è¾“å‡º</li>
</ul>
<h3 id="Agent"><a href="#Agent" class="headerlink" title="Agent"></a>Agent</h3><ul>
<li><code>Agent Inputs</code> Agentsçš„è¾“å…¥ï¼Œé”®å€¼å¯¹ç±»å‹<ul>
<li>requiredï¼š<code>intermediate_steps</code></li>
</ul>
</li>
<li><code>Agent Outputs</code> Agentsçš„å“åº”ï¼Œåˆ†ä¸º<code>Union[AgentAction, List[AgentAction], AgentFinish]</code><ul>
<li>è¾“å‡ºè§£æå™¨è´Ÿè´£è·å–åŸå§‹ LLM è¾“å‡ºå¹¶å°†å…¶è½¬æ¢ä¸ºè¿™ä¸‰ç§ç±»å‹ä¹‹ä¸€</li>
</ul>
</li>
</ul>
<p>demoï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">agent = (</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&quot;input&quot;</span>: <span class="keyword">lambda</span> x: x[<span class="string">&quot;input&quot;</span>],</span><br><span class="line">        <span class="string">&quot;agent_scratchpad&quot;</span>: <span class="keyword">lambda</span> x: format_to_openai_tool_messages(</span><br><span class="line">            x[<span class="string">&quot;intermediate_steps&quot;</span>]</span><br><span class="line">        ),</span><br><span class="line">    &#125;</span><br><span class="line">    | prompt</span><br><span class="line">    | llm_with_tools</span><br><span class="line">    | OpenAIToolsAgentOutputParser()</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h4 id="Agents-API"><a href="#Agents-API" class="headerlink" title="Agents API"></a>Agents API</h4><ul>
<li><code>AgentExecutor</code> é‡å¤è°ƒç”¨Agentså¹¶æ‰§è¡Œå·¥å…·<ul>
<li>å°è£…äº†å„ç§é”™è¯¯å¤„ç†ã€æ—¥å¿—ç­‰</li>
</ul>
</li>
</ul>
<h3 id="Tools"><a href="#Tools" class="headerlink" title="Tools"></a>Tools</h3><p>å·¥å…·æ˜¯ä»£ç†å¯ä»¥è°ƒç”¨â€‹â€‹çš„åŠŸèƒ½ã€‚ <code>Tool</code> æŠ½è±¡ç”±ä¸¤ä¸ªç»„ä»¶ç»„æˆï¼š</p>
<p>å·¥å…· API çš„ç›®æ ‡æ˜¯æ¯”ä½¿ç”¨é€šç”¨æ–‡æœ¬å®Œæˆæˆ–èŠå¤© API æ›´å¯é åœ°è¿”å›æœ‰æ•ˆä¸”æœ‰ç”¨çš„å·¥å…·è°ƒç”¨ã€‚</p>
<ul>
<li>schema</li>
<li>function</li>
</ul>
<p>è®¾è®¡Agentsçš„å…³é”®ï¼š</p>
<ul>
<li>è®©Agentsæ­£ç¡®çš„ä½¿ç”¨tools</li>
<li>ä»¥å¯¹ä»£ç†æœ€æœ‰å¸®åŠ©çš„æ–¹å¼æè¿°å·¥å…·</li>
</ul>
<h2 id="Agent-Type"><a href="#Agent-Type" class="headerlink" title="Agent Type"></a>Agent Type</h2><p>ä»‹ç»å‡ ä¸ªå¸¸ç”¨çš„Agent Type</p>
<p>ReActï¼šLLM å¯ä»¥å¾ªç¯è¿›è¡Œ Reasoning å’Œ Action æ­¥éª¤çš„è¿‡ç¨‹ã€‚å®ƒå¯ç”¨äº†ä¸€ä¸ªå¤šæ­¥éª¤çš„è¿‡ç¨‹æ¥è¯†åˆ«ç­”æ¡ˆã€‚</p>
<h1 id="Prompt"><a href="#Prompt" class="headerlink" title="Prompt"></a>Prompt</h1><p>æç¤ºè¯å·¥ç¨‹å’Œæ¨¡å‹å¾®è°ƒçš„åŒºåˆ«ï¼š</p>
<ul>
<li><p>å¾®è°ƒ</p>
<ul>
<li>å®šä¹‰ï¼šé’ˆå¯¹é¢„å…ˆè®­ç»ƒçš„è¯­è¨€æ¨¡å‹ï¼Œåœ¨ç‰¹å®šä»»åŠ¡çš„å°‘é‡æ•°æ®é›†ä¸Šå¯¹å…¶è¿›è¡Œè¿›ä¸€æ­¥è®­ç»ƒ</li>
<li>é€‚ç”¨åœºæ™¯ï¼šå½“ä»»åŠ¡æˆ–åŸŸå®šä¹‰æ˜ç¡®ï¼Œå¹¶ä¸”æœ‰è¶³å¤Ÿçš„æ ‡è®°æ•°æ®å¯ä¾›è®­ç»ƒæ—¶ï¼Œé€šå¸¸ä½¿ç”¨å¾®è°ƒè¿‡ç¨‹</li>
</ul>
</li>
<li><p>æç¤ºè¯å·¥ç¨‹</p>
<ul>
<li>æ¶‰åŠè®¾è®¡è‡ªç„¶è¯­è¨€æç¤ºæˆ–æŒ‡ä»¤ï¼Œå¯ä»¥æŒ‡å¯¼è¯­è¨€æ¨¡å‹æ‰§è¡Œç‰¹å®šä»»åŠ¡</li>
<li>æœ€é€‚åˆéœ€è¦é«˜ç²¾åº¦å’Œæ˜ç¡®è¾“å‡ºçš„ä»»åŠ¡ã€‚æç¤ºå·¥ç¨‹å¯ç”¨äºåˆ¶ä½œå¼•å‘æ‰€éœ€è¾“å‡ºçš„æŸ¥è¯¢</li>
</ul>
</li>
</ul>
<h1 id="Memory"><a href="#Memory" class="headerlink" title="Memory"></a>Memory</h1><p><img src="/../images/memory_diagram-0627c68230aa438f9b5419064d63cbbc_eZ.png"></p>
<p>å››ç§ä¸»è¦å‚¨å­˜æ¨¡å—ï¼š</p>
<ul>
<li><code>ConversationBufferMemory</code>å¯¹è¯ç¼“å­˜</li>
<li><code>ConversationTokenBufferMemory</code>æŒ‰çª—å£ç¼“å­˜</li>
<li><code>ConversationTokenBufferMemory</code>æŒ‰ä»¤ç‰Œç¼“å­˜</li>
<li><code>ConversationSummaryBufferMemory</code>æŒ‰æ‘˜è¦ç¼“å­˜</li>
</ul>
<p>æœ€å¸¸è§çš„å†…å­˜ç±»å‹ä¹‹ä¸€æ¶‰åŠè¿”å›èŠå¤©æ¶ˆæ¯åˆ—è¡¨ã€‚è¿™äº›å¯ä»¥ä½œä¸ºå•ä¸ªå­—ç¬¦ä¸²è¿”å›ï¼Œå…¨éƒ¨è¿æ¥åœ¨ä¸€èµ·ï¼ˆå½“å®ƒä»¬è¢«ä¼ é€’åˆ° LLMs æ—¶æœ‰ç”¨ï¼‰æˆ– ChatMessages åˆ—è¡¨ï¼ˆå½“ä¼ é€’åˆ° ChatModels æ—¶æœ‰ç”¨ï¼‰ã€‚</p>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒä»¬ä½œä¸ºå•ä¸ªå­—ç¬¦ä¸²è¿”å›ã€‚ä¸ºäº†ä½œä¸ºæ¶ˆæ¯åˆ—è¡¨è¿”å›ï¼Œæ‚¨å¯ä»¥è®¾ç½® <code>return_messages=True</code></p>
<p><img src="/../images/image_96cXegtOz-.png"></p>
<h1 id="Chains"><a href="#Chains" class="headerlink" title="Chains"></a>Chains</h1><p>é“¾æ˜¯æŒ‡è°ƒç”¨åºåˆ— - å³ LLMã€Toolsè¿˜æ˜¯æ•°æ®é¢„å¤„ç†æ­¥éª¤çš„å…ˆåé¡ºåºã€‚ä¸»è¦æ”¯æŒçš„æ–¹æ³•æ˜¯ä½¿ç”¨ LCELã€‚</p>
<h2 id="LCEL-Chains"><a href="#LCEL-Chains" class="headerlink" title="LCEL Chains"></a>LCEL Chains</h2><p>LangChain Expression Languageï¼ˆLCELï¼‰å¯ä»¥è½»æ¾åœ°ä»åŸºæœ¬ç»„ä»¶æ„å»ºå¤æ‚çš„é“¾ï¼Œå¹¶æ”¯æŒå¼€ç®±å³ç”¨çš„åŠŸèƒ½ï¼Œä¾‹å¦‚æµå¼ä¼ è¾“ã€å¹¶è¡Œæ€§å’Œæ—¥å¿—è®°å½•ï¼Œæœ€åŸºæœ¬å’Œå¸¸è§çš„ç”¨ä¾‹æ˜¯å°†Promptå’ŒLLMé“¾æ¥åœ¨ä¸€èµ·ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">chain = prompt | model | output_parser</span><br></pre></td></tr></table></figure>

<p><a href="https://python.langchain.com/v0.1/docs/expression_language/get_started/" title="https://python.langchain.com/v0.1/docs/expression_language/get_started/">https://python.langchain.com/v0.1/docs/expression_language&#x2F;get_started&#x2F;</a></p>
<p>æ„ä¹‰ï¼šç»„åˆå¤§æ¨¡å‹è°ƒç”¨ä¸­ä¸ç›¸å…³çš„éƒ¨åˆ†ï¼Œè®©å¼€å‘è€…çœå»èƒ¶æ°´ä»£ç </p>
<p>ä¸‹é¢ä¸¾ä¸€äº›ç®€å•çš„æ —å­ï¼š</p>
<p>æ¨¡å‹è°ƒç”¨ï¼š</p>
<p><img src="/../images/image_tamQ_03vHR.png"></p>
<p>Streamæµï¼š</p>
<p><img src="/../images/image_UPmDNoWd_p.png"></p>
<p>Batchæ‰¹å¤„ç†ï¼š</p>
<p><img src="/../images/image_JliK3KA3oM.png"></p>
<p>å¼‚æ­¥è°ƒç”¨ï¼š</p>
<p><img src="/../images/image_Gf01np9mh3.png"></p>
<h1 id="RAG"><a href="#RAG" class="headerlink" title="RAG"></a>RAG</h1><p>å…¨ç§°Retrieval Augmented Generation (RAG)</p>
<p><img src="/../images/data_connection-95ff2033a8faa5f3ba41376c0f6dd32a_P.jpg"></p>
<p>æ ¸å¿ƒç»„ä»¶ï¼š</p>
<ul>
<li><strong>Document loaders</strong>æ–‡æ¡£åŠ è½½å™¨</li>
<li>Text Splittingæ–‡æœ¬åˆ†å‰²å™¨ï¼Œå°†å¤§æ–‡æ¡£åˆ†å‰²ï¼ˆæˆ–åˆ†å—ï¼‰ä¸ºæ›´å°çš„å—ã€‚</li>
<li>Text Embedding modelsåµŒå…¥æ¨¡å‹ï¼Œç”¨äºå°†æ–‡æ¡£åµŒå…¥åˆ°Vector storesä¸­ï¼Œä¸»è¦æœ‰ä¸¤ç§å¸¸ç”¨æ–¹å¼ï¼š<ul>
<li>text2vector</li>
<li>llm</li>
</ul>
</li>
<li>Retrieversæ£€ç´¢å™¨ï¼Œç”¨äºåœ¨æ•°æ®æºä¸­æ£€ç´¢ç›¸å…³ä¿¡æ¯</li>
<li>Indexingæ•°æ®åº“ç´¢å¼•ï¼Œç”¨äºæ£€ç´¢</li>
</ul>
<h2 id="Retrieversæ£€ç´¢"><a href="#Retrieversæ£€ç´¢" class="headerlink" title="Retrieversæ£€ç´¢"></a>Retrieversæ£€ç´¢</h2><p>ç›¸å…³ç®—æ³•ï¼š</p>
<ul>
<li><p>åŸºæœ¬è¯­ä¹‰ç›¸ä¼¼åº¦ï¼ˆBasicsemanticsimilarity)</p>
</li>
<li><p>æœ€å¤§è¾¹é™…ç›¸å…³æ€§ï¼ˆMaximummarginalrelevanceï¼ŒMMR)</p>
</li>
<li><p>è¿‡æ»¤å…ƒæ•°æ®</p>
</li>
<li><p>LLMè¾…åŠ©æ£€ç´¢ SelfQueryRetriever</p>
</li>
<li><p>å‹ç¼© ContextualCompressionRetriever</p>
<ul>
<li>å·¥ä½œåŸç†ï¼šå…ˆä½¿ç”¨æ ‡å‡†å‘é‡æ£€ç´¢è·å¾—å€™é€‰æ–‡æ¡£ï¼Œç„¶ååŸºäºæŸ¥è¯¢è¯­å¥çš„è¯­ä¹‰ï¼Œä½¿ç”¨è¯­è¨€æ¨¡å‹å‹ç¼©è¿™äº›æ–‡æ¡£,åªä¿ç•™ä¸é—®é¢˜ç›¸å…³çš„éƒ¨åˆ†<br><img src="/../images/image_cehTwhXkXE.png"></li>
</ul>
</li>
</ul>
<p>å…¶ä»–ç±»å‹çš„æ£€ç´¢ï¼š</p>
<p>vetordb å¹¶ä¸æ˜¯å”¯ä¸€ä¸€ç§æ£€ç´¢æ–‡æ¡£çš„å·¥å…·ã€‚ LangChain è¿˜æä¾›äº†å…¶ä»–æ£€ç´¢æ–‡æ¡£çš„æ–¹å¼ï¼Œä¾‹å¦‚ï¼š TF-IDF æˆ– SVM ã€‚</p>
<h2 id="å¯¹è¯æ£€ç´¢é“¾"><a href="#å¯¹è¯æ£€ç´¢é“¾" class="headerlink" title="å¯¹è¯æ£€ç´¢é“¾"></a>å¯¹è¯æ£€ç´¢é“¾</h2><h3 id="æ£€ç´¢é“¾ç±»å‹"><a href="#æ£€ç´¢é“¾ç±»å‹" class="headerlink" title="æ£€ç´¢é“¾ç±»å‹"></a>æ£€ç´¢é“¾ç±»å‹</h3><p>é€šè¿‡LangChainåˆ›å»ºä¸€ä¸ªæ£€ç´¢é—®ç­”é“¾ï¼Œå¯¹æ£€ç´¢åˆ°çš„æ–‡æ¡£è¿›è¡Œé—®é¢˜å›ç­”ã€‚æ£€ç´¢é—®ç­”é“¾çš„è¾“å…¥åŒ…å«ä»¥ä¸‹</p>
<ul>
<li>llmå¤§è¯­è¨€æ¨¡å‹</li>
<li><code>chain_type</code>æŒ‡å®šä¼ å…¥é“¾ï¼ˆç”¨äºå°†æ–‡æ¡£ä¼ é€’åˆ° LLM çš„ä¸Šä¸‹æ–‡çª—å£ä¸­ï¼‰ç±»å‹<ul>
<li><strong>Stuff</strong>ï¼šåªéœ€å°†æ‰€æœ‰æ–‡æ¡£â€œå¡â€åˆ°ä¸€ä¸ªæç¤ºä¸­å³å¯ï¼Œè¿™æ˜¯æœ€ç®€å•çš„æ–¹æ³•<ul>
<li>APIï¼šcreate_stuff_documents_chain</li>
</ul>
</li>
<li><strong>Map-reduce</strong>ï¼šå°†æ‰€æœ‰å—ä¸é—®é¢˜ä¸€èµ·ä¼ é€’ç»™è¯­è¨€æ¨¡å‹ï¼Œè·å–å›å¤ï¼Œä½¿ç”¨å¦ä¸€ä¸ªè¯­è¨€æ¨¡å‹è°ƒç”¨å°†æ‰€æœ‰å•ç‹¬çš„å›å¤æ€»ç»“æˆæœ€ç»ˆç­”æ¡ˆï¼Œå®ƒå¯ä»¥åœ¨ä»»æ„æ•°é‡çš„æ–‡æ¡£ä¸Šè¿è¡Œã€‚å¯ä»¥å¹¶è¡Œå¤„ç†å•ä¸ªé—®é¢˜ï¼ŒåŒæ—¶ä¹Ÿéœ€è¦æ›´å¤šçš„è°ƒç”¨ã€‚å®ƒå°†æ‰€æœ‰æ–‡æ¡£è§†ä¸ºç‹¬ç«‹çš„<ul>
<li>MapReduceDocumentsChain</li>
</ul>
</li>
<li><strong>Refine</strong><ul>
<li>å¾ªç¯è®¸å¤šæ–‡æ¡£ï¼Œå®é™…ä¸Šæ˜¯è¿­ä»£çš„ï¼Œå»ºç«‹åœ¨å…ˆå‰æ–‡æ¡£çš„ç­”æ¡ˆä¹‹ä¸Šï¼Œéå¸¸é€‚åˆå‰åå› æœä¿¡æ¯å¹¶éšæ—¶é—´é€æ­¥æ„å»ºç­”æ¡ˆï¼Œä¾èµ–äºå…ˆå‰è°ƒç”¨çš„ç»“æœã€‚</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><img src="/../images/summarization_use_case_2-f2a4d5d60980a79140085fb7f.png" alt="Stuffå’ŒMapReduceåŒºåˆ«" title="Stuffå’ŒMapReduceåŒºåˆ«"></p>
<p><img src="/../images/image_kuqREZwJrr.png"></p>
<h3 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain.chains.combine_documents.stuff <span class="keyword">import</span> StuffDocumentsChain</span><br><span class="line"><span class="keyword">from</span> langchain.chains.llm <span class="keyword">import</span> LLMChain</span><br><span class="line"><span class="keyword">from</span> langchain_core.prompts <span class="keyword">import</span> PromptTemplate</span><br><span class="line"></span><br><span class="line"><span class="comment"># Define prompt</span></span><br><span class="line">prompt_template = <span class="string">&quot;&quot;&quot;Write a concise summary of the following:</span></span><br><span class="line"><span class="string">&quot;&#123;text&#125;&quot;</span></span><br><span class="line"><span class="string">CONCISE SUMMARY:&quot;&quot;&quot;</span></span><br><span class="line">prompt = PromptTemplate.from_template(prompt_template)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Define LLM chain</span></span><br><span class="line">llm = ChatOpenAI(temperature=<span class="number">0</span>, model_name=<span class="string">&quot;gpt-3.5-turbo-16k&quot;</span>)</span><br><span class="line">llm_chain = LLMChain(llm=llm, prompt=prompt)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Define StuffDocumentsChain</span></span><br><span class="line">stuff_chain = StuffDocumentsChain(llm_chain=llm_chain, document_variable_name=<span class="string">&quot;text&quot;</span>)</span><br><span class="line"></span><br><span class="line">docs = loader.load()</span><br><span class="line"><span class="built_in">print</span>(stuff_chain.run(docs))</span><br></pre></td></tr></table></figure>
]]></content>
  </entry>
</search>
