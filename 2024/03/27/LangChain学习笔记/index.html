<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
<meta name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">

    <meta name="author" content="qing-wq">



    <meta name="description" content="Qing's Blog">



<title>LangChainå…¥é—¨ç¬”è®° | Qing&#39;s Blog</title>



    <link rel="icon" href="/favicon.ico">




    <!-- stylesheets list from _config.yml -->
    
    <link rel="stylesheet" href="/css/style.css">
    



    <!-- scripts list from _config.yml -->
    
    <script src="/js/script.js"></script>
    
    <script src="/js/tocbot.min.js"></script>
    



    
    
        
    


<meta name="generator" content="Hexo 7.3.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
</head>

<body>
    <script>
        // this function is used to check current theme before page loaded.
        (() => {
            const currentTheme = window.localStorage && window.localStorage.getItem('theme') || '';
            const isDark = currentTheme === 'dark';
            const pagebody = document.getElementsByTagName('body')[0]
            if (isDark) {
                pagebody.classList.add('dark-theme');
                // mobile
                document.getElementById("mobile-toggle-theme").innerText = "Â· Dark"
            } else {
                pagebody.classList.remove('dark-theme');
                // mobile
                document.getElementById("mobile-toggle-theme").innerText = "Â· Light"
            }
        })();
    </script>

    <div class="wrapper">
        <header>
    <nav class="navbar">
        <div class="container">
            <div class="navbar-header header-logo"><a href="/">Qing&#39;s Blog</a></div>
            <div class="menu navbar-right">
                
                    <a class="menu-item" href="/archives">Posts</a>
                
                    <a class="menu-item" href="/categories">Categories</a>
                
                    <a class="menu-item" href="/tags">Tags</a>
                
                    <a class="menu-item" href="/about">About</a>
                
                <input id="switch_default" type="checkbox" class="switch_default">
                <label for="switch_default" class="toggleBtn"></label>
            </div>
        </div>
    </nav>

    
    <nav class="navbar-mobile" id="nav-mobile">
        <div class="container">
            <div class="navbar-header">
                <div>
                    <a href="/">Qing&#39;s Blog</a><a id="mobile-toggle-theme">Â·&nbsp;Light</a>
                </div>
                <div class="menu-toggle" onclick="mobileBtn()">&#9776; Menu</div>
            </div>
            <div class="menu" id="mobile-menu">
                
                    <a class="menu-item" href="/archives">Posts</a>
                
                    <a class="menu-item" href="/categories">Categories</a>
                
                    <a class="menu-item" href="/tags">Tags</a>
                
                    <a class="menu-item" href="/about">About</a>
                
            </div>
        </div>
    </nav>

</header>
<script>
    var mobileBtn = function f() {
        var toggleMenu = document.getElementsByClassName("menu-toggle")[0];
        var mobileMenu = document.getElementById("mobile-menu");
        if(toggleMenu.classList.contains("active")){
           toggleMenu.classList.remove("active")
            mobileMenu.classList.remove("active")
        }else{
            toggleMenu.classList.add("active")
            mobileMenu.classList.add("active")
        }
    }
</script>
            <div class="main">
                <div class="container">
    
    
        <div class="post-toc">
    <div class="tocbot-list">
    </div>
    <div class="tocbot-list-menu">
        <a class="tocbot-toc-expand" onclick="expand_toc()">Expand all</a>
        <a onclick="go_top()">Back to top</a>
        <a onclick="go_bottom()">Go to bottom</a>
    </div>
</div>

<script>
    var tocbot_timer;
    var DEPTH_MAX = 6; // ä¸º 6 æ—¶å±•å¼€æ‰€æœ‰
    var tocbot_default_config = {
        tocSelector: '.tocbot-list',
        contentSelector: '.post-content',
        headingSelector: 'h1, h2, h3, h4, h5',
        orderedList: false,
        scrollSmooth: true,
        onClick: extend_click,
    };

    function extend_click() {
        clearTimeout(tocbot_timer);
        tocbot_timer = setTimeout(function() {
            tocbot.refresh(obj_merge(tocbot_default_config, {
                hasInnerContainers: true
            }));
        }, 420); // è¿™ä¸ªå€¼æ˜¯ç”± tocbot æºç é‡Œå®šä¹‰çš„ scrollSmoothDuration å¾—æ¥çš„
    }

    document.ready(function() {
        tocbot.init(obj_merge(tocbot_default_config, {
            collapseDepth: 1
        }));
    });

    function expand_toc() {
        var b = document.querySelector('.tocbot-toc-expand');
        var expanded = b.getAttribute('data-expanded');
        expanded ? b.removeAttribute('data-expanded') : b.setAttribute('data-expanded', true);
        tocbot.refresh(obj_merge(tocbot_default_config, {
            collapseDepth: expanded ? 1 : DEPTH_MAX
        }));
        b.innerText = expanded ? 'Expand all' : 'Collapse all';
    }

    function go_top() {
        window.scrollTo(0, 0);
    }

    function go_bottom() {
        window.scrollTo(0, document.body.scrollHeight);
    }

    function obj_merge(target, source) {
        for (var item in source) {
            if (source.hasOwnProperty(item)) {
                target[item] = source[item];
            }
        }
        return target;
    }
</script>
    

    
    <article class="post-wrap">
        <header class="post-header">
            <h1 class="post-title">LangChainå…¥é—¨ç¬”è®°</h1>
            
                <div class="post-meta">
                    
                        ğŸ‘¨â€ğŸ“Author: <a itemprop="author" rel="author" href="/">qing-wq</a>
                    

                    
                        <span class="post-time">
                        ğŸ“…Date: <a href="#">ä¸‰æœˆ 27, 2024</a>
                        </span>
                    
                    <br/>
                    
                        <span class="post-category">
                            ğŸ“šCategory:
                            
                                <a href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">å­¦ä¹ ç¬”è®°</a>
                            
                        </span>
                    
                    
                    
                        <span class="post-count">
                            ğŸ“‘Words:
                            <a href="">2.1k</a> 
                        </span>
                    
                    
                        <span class="post-count">
                            â±ï¸Time:
                            <a href="">7min</a> 
                        </span>
                                            
                </div>
            
        </header>

        <div class="post-content">
            <p>åŸºæœ¬æ¶æ„</p>
<p><img src="/../images/langchain_stack_dark_NdLaDhZn28.svg"></p>
<span id="more"></span>

<h1 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h1><blockquote>
<p>LangChainæ˜¯ä¸€ä¸ªç”¨äºå¼€å‘ç”±è¯­è¨€æ¨¡å‹é©±åŠ¨çš„åº”ç”¨ç¨‹åºçš„æ¡†æ¶ã€‚</p>
<p>ä¸»è¦åŠŸèƒ½ï¼š</p>
<ul>
<li><p>è°ƒç”¨è¯­è¨€æ¨¡å‹</p>
</li>
<li><p>å°†ä¸åŒæ•°æ®æºæ¥å…¥åˆ°è¯­è¨€æ¨¡å‹çš„äº¤äº’ä¸­</p>
</li>
<li><p>å…è®¸è¯­è¨€æ¨¡å‹ä¸è¿è¡Œç¯å¢ƒäº¤äº’</p>
</li>
</ul>
<p>LangChainä¸­æä¾›çš„æ¨¡å—</p>
<ul>
<li><p>Modulesï¼šæ”¯æŒçš„æ¨¡å‹ç±»å‹å’Œé›†æˆã€‚</p>
</li>
<li><p>Promptï¼šæç¤ºè¯ç®¡ç†ã€ä¼˜åŒ–å’Œåºåˆ—åŒ–ã€‚</p>
</li>
<li><p>Memoryï¼šå†…å­˜æ˜¯æŒ‡åœ¨é“¾/ä»£ç†è°ƒç”¨ä¹‹é—´æŒç»­å­˜åœ¨çš„çŠ¶æ€ã€‚</p>
</li>
<li><p>Indexesï¼šå½“è¯­è¨€æ¨¡å‹ä¸ç‰¹å®šäºåº”ç”¨ç¨‹åºçš„æ•°æ®ç›¸ç»“åˆæ—¶ï¼Œä¼šå˜å¾—æ›´åŠ å¼ºå¤§-æ­¤æ¨¡å—åŒ…å«ç”¨äºåŠ è½½ã€æŸ¥è¯¢å’Œæ›´æ–°å¤–éƒ¨æ•°æ®çš„æ¥å£å’Œé›†æˆã€‚</p>
</li>
<li><p>Chainï¼šé“¾æ˜¯ç»“æ„åŒ–çš„è°ƒç”¨åºåˆ—ï¼ˆå¯¹LLMæˆ–å…¶ä»–å®ç”¨ç¨‹åºï¼‰ã€‚</p>
</li>
<li><p>Agentsï¼šä»£ç†æ˜¯ä¸€ä¸ªé“¾ï¼Œå…¶ä¸­LLMåœ¨ç»™å®šé«˜çº§æŒ‡ä»¤å’Œä¸€ç»„å·¥å…·çš„æƒ…å†µä¸‹ï¼Œåå¤å†³å®šæ“ä½œï¼Œæ‰§è¡Œæ“ä½œå¹¶è§‚å¯Ÿç»“æœï¼Œç›´åˆ°é«˜çº§æŒ‡ä»¤å®Œæˆã€‚</p>
</li>
<li><p>Callbacksï¼šå›è°ƒå…è®¸æ‚¨è®°å½•å’Œæµå¼ä¼ è¾“ä»»ä½•é“¾çš„ä¸­é—´æ­¥éª¤ï¼Œä»è€Œè½»æ¾è§‚å¯Ÿã€è°ƒè¯•å’Œè¯„ä¼°åº”ç”¨<br>ç¨‹åºçš„å†…éƒ¨ã€‚</p>
</li>
</ul>
</blockquote>
<p>åº”ç”¨åœºæ™¯ï¼š</p>
<ul>
<li>æ–‡æ¡£é—®ç­”</li>
<li>ä¸ªäººåŠ©ç†</li>
<li>æŸ¥è¯¢æ•°æ®è¡¨æ ¼ï¼ˆCSVã€SQLã€DataFrameç­‰ï¼‰</li>
<li>ä¸APIäº¤äº’</li>
<li>ä¿¡æ¯æå–</li>
<li>æ–‡æ¡£æ€»ç»“</li>
</ul>
<h1 id="Model-I-O"><a href="#Model-I-O" class="headerlink" title="Model I/O"></a>Model I/O</h1><p>å››ä¸ªæ ¸å¿ƒç»„ä»¶ï¼š</p>
<ul>
<li>Prompts æç¤ºè¯</li>
<li>Chat Models èŠå¤©æ¨¡å‹<ul>
<li>æ“…é•¿å¯¹è¯</li>
</ul>
</li>
<li>LLMs çº¯æ–‡æœ¬æ¨¡å‹<ul>
<li>æ“…é•¿ç†è§£å’Œåˆæˆæ–‡æœ¬æ–¹é¢ï¼Œä¾‹å¦‚æ€»ç»“æ–‡æ¡£ã€PDFã€æ¦‚å¿µé¡µé¢ç­‰</li>
</ul>
</li>
<li>Output parsers è¾“å‡ºè½¬æ¢å™¨</li>
</ul>
<blockquote>
<p>ğŸ“ŒChat Models å’Œ LLMs çš„åŒºåˆ«ï¼š</p>
<p>Chat modelså’ŒLLMséƒ½æ˜¯LangChainä¸­çš„è¯­è¨€æ¨¡å‹æŠ½è±¡ï¼Œä½†æ˜¯LLMsæ˜¯çº¯è¯­è¨€æ¨¡å‹ï¼ŒChat modelsæ˜¯é’ˆå¯¹å¯¹è¯åšäº†ä¼˜åŒ–çš„èŠå¤©æ¨¡å‹</p>
</blockquote>
<h1 id="Agents"><a href="#Agents" class="headerlink" title="Agents"></a>Agents</h1><blockquote>
<p>å¤§å‹è¯­è¨€æ¨¡å‹ï¼ˆLLMsï¼‰éå¸¸å¼ºå¤§ï¼Œä½†å®ƒä»¬ç¼ºä¹â€œæœ€ç¬¨â€çš„è®¡ç®—æœºç¨‹åºå¯ä»¥è½»æ¾å¤„ç†çš„ç‰¹å®šèƒ½åŠ›ã€‚LLM å¯¹é€»è¾‘æ¨ç†ã€è®¡ç®—å’Œæ£€ç´¢å¤–éƒ¨ä¿¡æ¯çš„èƒ½åŠ›è¾ƒå¼±ï¼Œè¿™ä¸æœ€ç®€å•çš„è®¡ç®—æœºç¨‹åºå½¢æˆå¯¹æ¯”ã€‚ä¾‹å¦‚ï¼Œè¯­è¨€æ¨¡å‹æ— æ³•å‡†ç¡®å›ç­”ç®€å•çš„è®¡ç®—é—®é¢˜ï¼Œè¿˜æœ‰å½“è¯¢é—®æœ€è¿‘å‘ç”Ÿçš„äº‹ä»¶æ—¶ï¼Œå…¶å›ç­”ä¹Ÿå¯èƒ½è¿‡æ—¶æˆ–é”™è¯¯ï¼Œå› ä¸ºæ— æ³•ä¸»åŠ¨è·å–<br>æœ€æ–°ä¿¡æ¯ã€‚è¿™æ˜¯ç”±äºå½“å‰è¯­è¨€æ¨¡å‹ä»…ä¾èµ–é¢„è®­ç»ƒæ•°æ®ï¼Œä¸å¤–ç•Œâ€œæ–­å¼€â€ã€‚è¦å…‹æœè¿™ä¸€ç¼ºé™·ï¼Œ LangChain æ¡†<br>æ¶æå‡ºäº† â€œä»£ç†â€(Agent) çš„è§£å†³æ–¹æ¡ˆã€‚</p>
</blockquote>
<p>Agentä½œä¸ºè¯­è¨€æ¨¡å‹çš„å¤–éƒ¨æ¨¡å—ï¼Œå¯æä¾›è®¡ç®—ã€é€»è¾‘ã€æ£€ç´¢ç­‰åŠŸèƒ½çš„æ”¯æŒï¼Œä½¿è¯­è¨€æ¨¡å‹è·å¾—å¼‚å¸¸å¼ºå¤§çš„æ¨ç†å’Œè·å–ä¿¡æ¯çš„è¶…èƒ½åŠ›ã€‚</p>
<hr>
<p>Agentsçš„æ ¸å¿ƒæ€æƒ³æ˜¯ä½¿ç”¨è¯­è¨€æ¨¡å‹æ¥é€‰æ‹©è¦é‡‡å–çš„ä¸€ç³»åˆ—Action</p>
<p>åœ¨langchainä¸­ï¼Œä¸€ç³»åˆ—Actionè¢«ç¡¬ç¼–ç ï¼ˆåœ¨ä»£ç ä¸­ï¼‰ã€‚</p>
<p>åœ¨Agentsä¸­ï¼Œè¯­è¨€æ¨¡å‹è¢«ç”¨ä½œæ¨ç†å¼•æ“æ¥ç¡®å®šè¦é‡‡å–å“ªäº›æ“ä½œä»¥åŠæŒ‰ä»€ä¹ˆé¡ºåºã€‚</p>
<p>ä¸åŒAgentsçš„åŒºåˆ«ï¼šä¸åŒçš„æ¨ç†æç¤ºé£æ ¼ã€ä¸åŒçš„ç¼–ç è¾“å…¥æ–¹å¼ä»¥åŠä¸åŒçš„è§£æè¾“å‡ºæ–¹å¼ã€‚</p>
<h2 id="åŸºæœ¬æ¦‚å¿µ"><a href="#åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="åŸºæœ¬æ¦‚å¿µ"></a>åŸºæœ¬æ¦‚å¿µ</h2><h3 id="Schema"><a href="#Schema" class="headerlink" title="Schema"></a>Schema</h3><p>æ„å»ºä»£ç†çš„æ ¸å¿ƒç»„ä»¶</p>
<ul>
<li><code>AgentAction</code> å³Actionï¼Œè¡¨ç¤ºä»£ç†æ‰§è¡Œçš„æ“ä½œï¼Œé€šå¸¸è¡¨ç¤ºè°ƒç”¨tools<ul>
<li>æˆ‘ä»¬å°†æƒ³è®©å¯¹Agentsçš„æ“ä½œå°è£…æˆActionï¼ˆtoolsï¼‰ï¼Œå†è®©Agentsåœ¨è¢«è°ƒç”¨æ—¶é€‰æ‹©åº”è¯¥ä½¿ç”¨å“ªäº›tools</li>
<li>åœ¨<code>AgentAction</code>ä¸­æœ‰ä¸¤ä¸ªå±æ€§ï¼š<code>tool</code>å’Œ<code>tool_input</code>ï¼Œåˆ†åˆ«ä»£è¡¨å·¥å…·çš„åå­—å’Œå·¥å…·è¾“å…¥</li>
</ul>
</li>
<li><code>AgentFinish</code>  Agentsè¿”å›çš„æœ€ç»ˆç»“æœ</li>
<li><code>Intermediate Steps</code> ä¸­é—´æ­¥éª¤ã€‚ä»£è¡¨<code>AgentAction</code>ä»¥åŠå½“å‰Agentsè¿è¡Œçš„ç›¸åº”è¾“å‡º</li>
</ul>
<h3 id="Agent"><a href="#Agent" class="headerlink" title="Agent"></a>Agent</h3><ul>
<li><code>Agent Inputs</code> Agentsçš„è¾“å…¥ï¼Œé”®å€¼å¯¹ç±»å‹<ul>
<li>requiredï¼š<code>intermediate_steps</code></li>
</ul>
</li>
<li><code>Agent Outputs</code> Agentsçš„å“åº”ï¼Œåˆ†ä¸º<code>Union[AgentAction, List[AgentAction], AgentFinish]</code><ul>
<li>è¾“å‡ºè§£æå™¨è´Ÿè´£è·å–åŸå§‹ LLM è¾“å‡ºå¹¶å°†å…¶è½¬æ¢ä¸ºè¿™ä¸‰ç§ç±»å‹ä¹‹ä¸€</li>
</ul>
</li>
</ul>
<p>demoï¼š</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">agent = (</span><br><span class="line">    {</span><br><span class="line">        <span class="string">"input"</span>: <span class="keyword">lambda</span> x: x[<span class="string">"input"</span>],</span><br><span class="line">        <span class="string">"agent_scratchpad"</span>: <span class="keyword">lambda</span> x: format_to_openai_tool_messages(</span><br><span class="line">            x[<span class="string">"intermediate_steps"</span>]</span><br><span class="line">        ),</span><br><span class="line">    }</span><br><span class="line">    | prompt</span><br><span class="line">    | llm_with_tools</span><br><span class="line">    | OpenAIToolsAgentOutputParser()</span><br><span class="line">)</span><br></pre></td></tr></tbody></table></figure>

<h4 id="Agents-API"><a href="#Agents-API" class="headerlink" title="Agents API"></a>Agents API</h4><ul>
<li><code>AgentExecutor</code> é‡å¤è°ƒç”¨Agentså¹¶æ‰§è¡Œå·¥å…·<ul>
<li>å°è£…äº†å„ç§é”™è¯¯å¤„ç†ã€æ—¥å¿—ç­‰</li>
</ul>
</li>
</ul>
<h3 id="Tools"><a href="#Tools" class="headerlink" title="Tools"></a>Tools</h3><p>å·¥å…·æ˜¯ä»£ç†å¯ä»¥è°ƒç”¨â€‹â€‹çš„åŠŸèƒ½ã€‚ <code>Tool</code> æŠ½è±¡ç”±ä¸¤ä¸ªç»„ä»¶ç»„æˆï¼š</p>
<p>å·¥å…· API çš„ç›®æ ‡æ˜¯æ¯”ä½¿ç”¨é€šç”¨æ–‡æœ¬å®Œæˆæˆ–èŠå¤© API æ›´å¯é åœ°è¿”å›æœ‰æ•ˆä¸”æœ‰ç”¨çš„å·¥å…·è°ƒç”¨ã€‚</p>
<ul>
<li>schema</li>
<li>function</li>
</ul>
<p>è®¾è®¡Agentsçš„å…³é”®ï¼š</p>
<ul>
<li>è®©Agentsæ­£ç¡®çš„ä½¿ç”¨tools</li>
<li>ä»¥å¯¹ä»£ç†æœ€æœ‰å¸®åŠ©çš„æ–¹å¼æè¿°å·¥å…·</li>
</ul>
<h2 id="Agent-Type"><a href="#Agent-Type" class="headerlink" title="Agent Type"></a>Agent Type</h2><p>ä»‹ç»å‡ ä¸ªå¸¸ç”¨çš„Agent Type</p>
<p>ReActï¼šLLM å¯ä»¥å¾ªç¯è¿›è¡Œ Reasoning å’Œ Action æ­¥éª¤çš„è¿‡ç¨‹ã€‚å®ƒå¯ç”¨äº†ä¸€ä¸ªå¤šæ­¥éª¤çš„è¿‡ç¨‹æ¥è¯†åˆ«ç­”æ¡ˆã€‚</p>
<h1 id="Prompt"><a href="#Prompt" class="headerlink" title="Prompt"></a>Prompt</h1><p>æç¤ºè¯å·¥ç¨‹å’Œæ¨¡å‹å¾®è°ƒçš„åŒºåˆ«ï¼š</p>
<ul>
<li><p>å¾®è°ƒ</p>
<ul>
<li>å®šä¹‰ï¼šé’ˆå¯¹é¢„å…ˆè®­ç»ƒçš„è¯­è¨€æ¨¡å‹ï¼Œåœ¨ç‰¹å®šä»»åŠ¡çš„å°‘é‡æ•°æ®é›†ä¸Šå¯¹å…¶è¿›è¡Œè¿›ä¸€æ­¥è®­ç»ƒ</li>
<li>é€‚ç”¨åœºæ™¯ï¼šå½“ä»»åŠ¡æˆ–åŸŸå®šä¹‰æ˜ç¡®ï¼Œå¹¶ä¸”æœ‰è¶³å¤Ÿçš„æ ‡è®°æ•°æ®å¯ä¾›è®­ç»ƒæ—¶ï¼Œé€šå¸¸ä½¿ç”¨å¾®è°ƒè¿‡ç¨‹</li>
</ul>
</li>
<li><p>æç¤ºè¯å·¥ç¨‹</p>
<ul>
<li>æ¶‰åŠè®¾è®¡è‡ªç„¶è¯­è¨€æç¤ºæˆ–æŒ‡ä»¤ï¼Œå¯ä»¥æŒ‡å¯¼è¯­è¨€æ¨¡å‹æ‰§è¡Œç‰¹å®šä»»åŠ¡</li>
<li>æœ€é€‚åˆéœ€è¦é«˜ç²¾åº¦å’Œæ˜ç¡®è¾“å‡ºçš„ä»»åŠ¡ã€‚æç¤ºå·¥ç¨‹å¯ç”¨äºåˆ¶ä½œå¼•å‘æ‰€éœ€è¾“å‡ºçš„æŸ¥è¯¢</li>
</ul>
</li>
</ul>
<h1 id="Memory"><a href="#Memory" class="headerlink" title="Memory"></a>Memory</h1><p><img src="/../images/memory_diagram-0627c68230aa438f9b5419064d63cbbc_eZ.png"></p>
<p>å››ç§ä¸»è¦å‚¨å­˜æ¨¡å—ï¼š</p>
<ul>
<li><code>ConversationBufferMemory</code>å¯¹è¯ç¼“å­˜</li>
<li><code>ConversationTokenBufferMemory</code>æŒ‰çª—å£ç¼“å­˜</li>
<li><code>ConversationTokenBufferMemory</code>æŒ‰ä»¤ç‰Œç¼“å­˜</li>
<li><code>ConversationSummaryBufferMemory</code>æŒ‰æ‘˜è¦ç¼“å­˜</li>
</ul>
<p>æœ€å¸¸è§çš„å†…å­˜ç±»å‹ä¹‹ä¸€æ¶‰åŠè¿”å›èŠå¤©æ¶ˆæ¯åˆ—è¡¨ã€‚è¿™äº›å¯ä»¥ä½œä¸ºå•ä¸ªå­—ç¬¦ä¸²è¿”å›ï¼Œå…¨éƒ¨è¿æ¥åœ¨ä¸€èµ·ï¼ˆå½“å®ƒä»¬è¢«ä¼ é€’åˆ° LLMs æ—¶æœ‰ç”¨ï¼‰æˆ– ChatMessages åˆ—è¡¨ï¼ˆå½“ä¼ é€’åˆ° ChatModels æ—¶æœ‰ç”¨ï¼‰ã€‚</p>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒä»¬ä½œä¸ºå•ä¸ªå­—ç¬¦ä¸²è¿”å›ã€‚ä¸ºäº†ä½œä¸ºæ¶ˆæ¯åˆ—è¡¨è¿”å›ï¼Œæ‚¨å¯ä»¥è®¾ç½® <code>return_messages=True</code></p>
<p><img src="/../images/image_96cXegtOz-.png"></p>
<h1 id="Chains"><a href="#Chains" class="headerlink" title="Chains"></a>Chains</h1><p>é“¾æ˜¯æŒ‡è°ƒç”¨åºåˆ— - å³ LLMã€Toolsè¿˜æ˜¯æ•°æ®é¢„å¤„ç†æ­¥éª¤çš„å…ˆåé¡ºåºã€‚ä¸»è¦æ”¯æŒçš„æ–¹æ³•æ˜¯ä½¿ç”¨ LCELã€‚</p>
<h2 id="LCEL-Chains"><a href="#LCEL-Chains" class="headerlink" title="LCEL Chains"></a>LCEL Chains</h2><p>LangChain Expression Languageï¼ˆLCELï¼‰å¯ä»¥è½»æ¾åœ°ä»åŸºæœ¬ç»„ä»¶æ„å»ºå¤æ‚çš„é“¾ï¼Œå¹¶æ”¯æŒå¼€ç®±å³ç”¨çš„åŠŸèƒ½ï¼Œä¾‹å¦‚æµå¼ä¼ è¾“ã€å¹¶è¡Œæ€§å’Œæ—¥å¿—è®°å½•ï¼Œæœ€åŸºæœ¬å’Œå¸¸è§çš„ç”¨ä¾‹æ˜¯å°†Promptå’ŒLLMé“¾æ¥åœ¨ä¸€èµ·ã€‚</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chain = prompt | model | output_parser</span><br></pre></td></tr></tbody></table></figure>

<p><a target="_blank" rel="noopener" href="https://python.langchain.com/v0.1/docs/expression_language/get_started/" title="https://python.langchain.com/v0.1/docs/expression_language/get_started/">https://python.langchain.com/v0.1/docs/expression_language/get_started/</a></p>
<p>æ„ä¹‰ï¼šç»„åˆå¤§æ¨¡å‹è°ƒç”¨ä¸­ä¸ç›¸å…³çš„éƒ¨åˆ†ï¼Œè®©å¼€å‘è€…çœå»èƒ¶æ°´ä»£ç </p>
<p>ä¸‹é¢ä¸¾ä¸€äº›ç®€å•çš„æ —å­ï¼š</p>
<p>æ¨¡å‹è°ƒç”¨ï¼š</p>
<p><img src="/../images/image_tamQ_03vHR.png"></p>
<p>Streamæµï¼š</p>
<p><img src="/../images/image_UPmDNoWd_p.png"></p>
<p>Batchæ‰¹å¤„ç†ï¼š</p>
<p><img src="/../images/image_JliK3KA3oM.png"></p>
<p>å¼‚æ­¥è°ƒç”¨ï¼š</p>
<p><img src="/../images/image_Gf01np9mh3.png"></p>
<h1 id="RAG"><a href="#RAG" class="headerlink" title="RAG"></a>RAG</h1><p>å…¨ç§°Retrieval Augmented Generation (RAG)</p>
<p><img src="/../images/data_connection-95ff2033a8faa5f3ba41376c0f6dd32a_P.jpg"></p>
<p>æ ¸å¿ƒç»„ä»¶ï¼š</p>
<ul>
<li><strong>Document loaders</strong>æ–‡æ¡£åŠ è½½å™¨</li>
<li>Text Splittingæ–‡æœ¬åˆ†å‰²å™¨ï¼Œå°†å¤§æ–‡æ¡£åˆ†å‰²ï¼ˆæˆ–åˆ†å—ï¼‰ä¸ºæ›´å°çš„å—ã€‚</li>
<li>Text Embedding modelsåµŒå…¥æ¨¡å‹ï¼Œç”¨äºå°†æ–‡æ¡£åµŒå…¥åˆ°Vector storesä¸­ï¼Œä¸»è¦æœ‰ä¸¤ç§å¸¸ç”¨æ–¹å¼ï¼š<ul>
<li>text2vector</li>
<li>llm</li>
</ul>
</li>
<li>Retrieversæ£€ç´¢å™¨ï¼Œç”¨äºåœ¨æ•°æ®æºä¸­æ£€ç´¢ç›¸å…³ä¿¡æ¯</li>
<li>Indexingæ•°æ®åº“ç´¢å¼•ï¼Œç”¨äºæ£€ç´¢</li>
</ul>
<h2 id="Retrieversæ£€ç´¢"><a href="#Retrieversæ£€ç´¢" class="headerlink" title="Retrieversæ£€ç´¢"></a>Retrieversæ£€ç´¢</h2><p>ç›¸å…³ç®—æ³•ï¼š</p>
<ul>
<li><p>åŸºæœ¬è¯­ä¹‰ç›¸ä¼¼åº¦ï¼ˆBasicsemanticsimilarity)</p>
</li>
<li><p>æœ€å¤§è¾¹é™…ç›¸å…³æ€§ï¼ˆMaximummarginalrelevanceï¼ŒMMR)</p>
</li>
<li><p>è¿‡æ»¤å…ƒæ•°æ®</p>
</li>
<li><p>LLMè¾…åŠ©æ£€ç´¢ SelfQueryRetriever</p>
</li>
<li><p>å‹ç¼© ContextualCompressionRetriever</p>
<ul>
<li>å·¥ä½œåŸç†ï¼šå…ˆä½¿ç”¨æ ‡å‡†å‘é‡æ£€ç´¢è·å¾—å€™é€‰æ–‡æ¡£ï¼Œç„¶ååŸºäºæŸ¥è¯¢è¯­å¥çš„è¯­ä¹‰ï¼Œä½¿ç”¨è¯­è¨€æ¨¡å‹å‹ç¼©è¿™äº›æ–‡æ¡£,åªä¿ç•™ä¸é—®é¢˜ç›¸å…³çš„éƒ¨åˆ†<br><img src="/../images/image_cehTwhXkXE.png"></li>
</ul>
</li>
</ul>
<p>å…¶ä»–ç±»å‹çš„æ£€ç´¢ï¼š</p>
<p>vetordb å¹¶ä¸æ˜¯å”¯ä¸€ä¸€ç§æ£€ç´¢æ–‡æ¡£çš„å·¥å…·ã€‚ LangChain è¿˜æä¾›äº†å…¶ä»–æ£€ç´¢æ–‡æ¡£çš„æ–¹å¼ï¼Œä¾‹å¦‚ï¼š TF-IDF æˆ– SVM ã€‚</p>
<h2 id="å¯¹è¯æ£€ç´¢é“¾"><a href="#å¯¹è¯æ£€ç´¢é“¾" class="headerlink" title="å¯¹è¯æ£€ç´¢é“¾"></a>å¯¹è¯æ£€ç´¢é“¾</h2><h3 id="æ£€ç´¢é“¾ç±»å‹"><a href="#æ£€ç´¢é“¾ç±»å‹" class="headerlink" title="æ£€ç´¢é“¾ç±»å‹"></a>æ£€ç´¢é“¾ç±»å‹</h3><p>é€šè¿‡LangChainåˆ›å»ºä¸€ä¸ªæ£€ç´¢é—®ç­”é“¾ï¼Œå¯¹æ£€ç´¢åˆ°çš„æ–‡æ¡£è¿›è¡Œé—®é¢˜å›ç­”ã€‚æ£€ç´¢é—®ç­”é“¾çš„è¾“å…¥åŒ…å«ä»¥ä¸‹</p>
<ul>
<li>llmå¤§è¯­è¨€æ¨¡å‹</li>
<li><code>chain_type</code>æŒ‡å®šä¼ å…¥é“¾ï¼ˆç”¨äºå°†æ–‡æ¡£ä¼ é€’åˆ° LLM çš„ä¸Šä¸‹æ–‡çª—å£ä¸­ï¼‰ç±»å‹<ul>
<li><strong>Stuff</strong>ï¼šåªéœ€å°†æ‰€æœ‰æ–‡æ¡£â€œå¡â€åˆ°ä¸€ä¸ªæç¤ºä¸­å³å¯ï¼Œè¿™æ˜¯æœ€ç®€å•çš„æ–¹æ³•<ul>
<li>APIï¼šcreate_stuff_documents_chain</li>
</ul>
</li>
<li><strong>Map-reduce</strong>ï¼šå°†æ‰€æœ‰å—ä¸é—®é¢˜ä¸€èµ·ä¼ é€’ç»™è¯­è¨€æ¨¡å‹ï¼Œè·å–å›å¤ï¼Œä½¿ç”¨å¦ä¸€ä¸ªè¯­è¨€æ¨¡å‹è°ƒç”¨å°†æ‰€æœ‰å•ç‹¬çš„å›å¤æ€»ç»“æˆæœ€ç»ˆç­”æ¡ˆï¼Œå®ƒå¯ä»¥åœ¨ä»»æ„æ•°é‡çš„æ–‡æ¡£ä¸Šè¿è¡Œã€‚å¯ä»¥å¹¶è¡Œå¤„ç†å•ä¸ªé—®é¢˜ï¼ŒåŒæ—¶ä¹Ÿéœ€è¦æ›´å¤šçš„è°ƒç”¨ã€‚å®ƒå°†æ‰€æœ‰æ–‡æ¡£è§†ä¸ºç‹¬ç«‹çš„<ul>
<li>MapReduceDocumentsChain</li>
</ul>
</li>
<li><strong>Refine</strong><ul>
<li>å¾ªç¯è®¸å¤šæ–‡æ¡£ï¼Œå®é™…ä¸Šæ˜¯è¿­ä»£çš„ï¼Œå»ºç«‹åœ¨å…ˆå‰æ–‡æ¡£çš„ç­”æ¡ˆä¹‹ä¸Šï¼Œéå¸¸é€‚åˆå‰åå› æœä¿¡æ¯å¹¶éšæ—¶é—´é€æ­¥æ„å»ºç­”æ¡ˆï¼Œä¾èµ–äºå…ˆå‰è°ƒç”¨çš„ç»“æœã€‚</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><img src="/../images/summarization_use_case_2-f2a4d5d60980a79140085fb7f.png" alt="Stuffå’ŒMapReduceåŒºåˆ«" title="Stuffå’ŒMapReduceåŒºåˆ«"></p>
<p><img src="/../images/image_kuqREZwJrr.png"></p>
<h3 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h3><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain.chains.combine_documents.stuff <span class="keyword">import</span> StuffDocumentsChain</span><br><span class="line"><span class="keyword">from</span> langchain.chains.llm <span class="keyword">import</span> LLMChain</span><br><span class="line"><span class="keyword">from</span> langchain_core.prompts <span class="keyword">import</span> PromptTemplate</span><br><span class="line"></span><br><span class="line"><span class="comment"># Define prompt</span></span><br><span class="line">prompt_template = <span class="string">"""Write a concise summary of the following:</span></span><br><span class="line"><span class="string">"{text}"</span></span><br><span class="line"><span class="string">CONCISE SUMMARY:"""</span></span><br><span class="line">prompt = PromptTemplate.from_template(prompt_template)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Define LLM chain</span></span><br><span class="line">llm = ChatOpenAI(temperature=<span class="number">0</span>, model_name=<span class="string">"gpt-3.5-turbo-16k"</span>)</span><br><span class="line">llm_chain = LLMChain(llm=llm, prompt=prompt)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Define StuffDocumentsChain</span></span><br><span class="line">stuff_chain = StuffDocumentsChain(llm_chain=llm_chain, document_variable_name=<span class="string">"text"</span>)</span><br><span class="line"></span><br><span class="line">docs = loader.load()</span><br><span class="line"><span class="built_in">print</span>(stuff_chain.run(docs))</span><br></pre></td></tr></tbody></table></figure>

        </div>

        
            <section class="post-copyright">
                
                    <p class="copyright-item">
                        <span>Author:</span>
                        <span>qing-wq</span>
                    </p>
                
                
                    <p class="copyright-item">
                        <span>Permalink:</span>
                        <span><a href="https://qing-wq.github.io/2024/03/27/LangChain%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">https://qing-wq.github.io/2024/03/27/LangChain%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/</a></span>
                    </p>
                
                
                    <p class="copyright-item">
                        <span>License:</span>
                        <span>Copyright (c) 2019 <a target="_blank" rel="noopener" href="http://creativecommons.org/licenses/by-nc/4.0/">CC-BY-NC-4.0</a> LICENSE</span>
                    </p>
                
                

            </section>
        
        <section class="post-tags">
            <div>
                <span>Tag(s):</span>
                <span class="tag">
                    
                    
                        <a href="/tags/langchain/"># langchain</a>
                    
                        <a href="/tags/AI/"># AI</a>
                    
                        <a href="/tags/LLM/"># LLM</a>
                    
                        
                </span>
            </div>
            <div>
                <a href="javascript:window.history.back();">back</a>
                <span>Â· </span>
                <a href="/">home</a>
            </div>
        </section>
        <section class="post-nav">
            
                <a class="prev" rel="prev" href="/2024/03/31/Bean%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/">Beançš„ç”Ÿå‘½å‘¨æœŸ</a>
            
            
            <a class="next" rel="next" href="/2024/03/26/Mybatis%E5%AE%9E%E7%8E%B0%E5%8A%A8%E6%80%81%E6%B3%A8%E5%86%8Cbean%E7%9A%84%E4%B8%A4%E7%A7%8D%E6%96%B9%E5%BC%8F/">MyBatiså®ç°åŠ¨æ€æ³¨å†Œbeançš„ä¸¤ç§æ–¹å¼</a>
            
        </section>


    </article>
</div>

            </div>
            <footer id="footer" class="footer">
    <div class="copyright">
        <span>Â© qing-wq | Powered by <a href="https://hexo.io" target="_blank">Hexo</a> & <a href="https://github.com/Siricee/hexo-theme-Chic" target="_blank">Chic</a></span>
    </div>
</footer>

    </div>
</body>

</html>